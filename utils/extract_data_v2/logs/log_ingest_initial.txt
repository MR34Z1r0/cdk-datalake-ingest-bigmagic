=========================================================== 
[s†b. 11/10/2025 12:05:27.39] Iniciando proceso de ingesti√≥n inicial 
=========================================================== 
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_EMPLEADO... 
2025-10-11 12:05:28 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:28 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:28 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:28 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:28 - __main__ - INFO - üÜî Process GUID generado: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:28 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:28 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:28 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:28 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:28 - __main__ - INFO - ================================================================================
2025-10-11 12:05:28 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:28 - __main__ - INFO - ================================================================================
2025-10-11 12:05:28 - __main__ - INFO - üÜî Process GUID: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:28 - __main__ - INFO - üìä Table: M_EMPLEADO
2025-10-11 12:05:28 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:28 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:28 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:28 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:28 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:28 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:28 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:28 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:28 - __main__ - INFO - ================================================================================
2025-10-11 12:05:28 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:28 - __main__ - INFO - ================================================================================
2025-10-11 12:05:28 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:28 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:28 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:28 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:28 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:28 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:28 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:28 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_EMPLEADO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:28,564-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:28,564-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:28,815-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:28,815-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:28 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:29,138-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:29 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:29 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Table: M_EMPLEADO
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_empleado'
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Checking source_table: 'mpersoef'
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,sucursal,empleado,nombcompl,sexo,stscivil,tipdocident,docidentid,fecnacim,estado,feccrea,horcrea,usucrea,fecultmod,horultimod,ultusumod'
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:29 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:29 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_EMPLEADO process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:29 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_EMPLEADO
2025-10-11 12:05:29 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:29 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:29 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:29 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:29 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:29 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:29 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_EMPLEADO process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:29 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:29,367-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 1 objects across 1 pages","timestamp":"2025-10-11 12:05:29,448-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:274","message":"Deleting 1 objects from S3","timestamp":"2025-10-11 12:05:29,448-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:286","message":"Successfully deleted 1 objects","timestamp":"2025-10-11 12:05:29,489-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:29 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Table: M_EMPLEADO
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:29 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 19, Filters: 0
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(empleado)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, sucursal, empleado, nombcompl, sexo, stscivil, tipdocident, docidentid, fecnacim, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mpersoef
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(empleado)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, sucursal, empleado, nombcompl, sexo, stscivil, tipdocident, docidentid, fecnacim, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mpersoef
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.04s
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,143
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Columns: 18
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,143 rows
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç Processing chunk 1 with 1143 rows
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1143 rows - process_guid: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mpersoef/year=2025/month=10/day=11/data_thread_0_0_chunk_0_42f16c79.parquet","timestamp":"2025-10-11 12:05:29,543-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mpersoef/year=2025/month=10/day=11/data_thread_0_0_chunk_0_42f16c79.parquet","timestamp":"2025-10-11 12:05:29,839-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:29 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:29 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_EMPLEADO
2025-10-11 12:05:29 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:29 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:29 - __main__ - INFO - ================================================================================
2025-10-11 12:05:29 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:29 - __main__ - INFO - üÜî Process GUID: 58a15a80-d0f6-441c-85ea-ad90ba59dff2
2025-10-11 12:05:29 - __main__ - INFO - üìä Records: 1,143
2025-10-11 12:05:29 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:29 - __main__ - INFO - ‚è±Ô∏è Time: 0.48s
2025-10-11 12:05:29 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:29 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_PAIS... 
2025-10-11 12:05:30 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:30 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:30 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:30 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:31 - __main__ - INFO - üÜî Process GUID generado: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:31 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:31 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:31 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:31 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:31 - __main__ - INFO - ================================================================================
2025-10-11 12:05:31 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:31 - __main__ - INFO - ================================================================================
2025-10-11 12:05:31 - __main__ - INFO - üÜî Process GUID: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:31 - __main__ - INFO - üìä Table: M_PAIS
2025-10-11 12:05:31 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:31 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:31 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:31 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:31 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:31 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:31 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:31 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:31 - __main__ - INFO - ================================================================================
2025-10-11 12:05:31 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:31 - __main__ - INFO - ================================================================================
2025-10-11 12:05:31 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:31 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:31 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:31 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:31 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:31 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:31 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:31 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_PAIS', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:31,264-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:31,264-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:31,502-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:31,502-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:31 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:31,804-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:31 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:31 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Table: M_PAIS
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_pais'
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - Checking source_table: 'bubige1f'
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais,replace(replace(descrip, char(13),''), char(10),'') descrip, continente, codletr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,cast(cast(zonareg as int) as varchar(20)) zonareg'
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:31 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:31 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:31 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_PAIS process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:31 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_PAIS
2025-10-11 12:05:32 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:32 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:32 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:32 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:32 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:32 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:32 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_PAIS process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:32 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:32,047-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 1 objects across 1 pages","timestamp":"2025-10-11 12:05:32,120-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:274","message":"Deleting 1 objects from S3","timestamp":"2025-10-11 12:05:32,120-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:286","message":"Successfully deleted 1 objects","timestamp":"2025-10-11 12:05:32,160-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:32 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - Table: M_PAIS
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:32 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 19, Filters: 0
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(codletr)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, replace(replace(descrip, char(13), ''), char(10), '') descrip, continente, codletr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, cast(cast(zonareg as int) as varchar(20)) zonareg FROM bubige1f
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(codletr)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, replace(replace(descrip, char(13), ''), char(10), '') descrip, continente, codletr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, cast(cast(zonareg as int) as varchar(20)) zonareg FROM bubige1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Rows returned: 36
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Columns: 14
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 36 rows
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç Processing chunk 1 with 36 rows
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 36 rows - process_guid: 6339e04e-0de6-43af-befe-d38b361fc321
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec1952f9.parquet","timestamp":"2025-10-11 12:05:32,201-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec1952f9.parquet","timestamp":"2025-10-11 12:05:32,442-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:32 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:32 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_PAIS
2025-10-11 12:05:32 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:32 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:32 - __main__ - INFO - ================================================================================
2025-10-11 12:05:32 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:32 - __main__ - INFO - üÜî Process GUID: 6339e04e-0de6-43af-befe-d38b361fc321
2025-10-11 12:05:32 - __main__ - INFO - üìä Records: 36
2025-10-11 12:05:32 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:32 - __main__ - INFO - ‚è±Ô∏è Time: 0.40s
2025-10-11 12:05:32 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:32 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_AROMA... 
2025-10-11 12:05:33 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:33 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:33 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:33 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:33 - __main__ - INFO - üÜî Process GUID generado: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:33 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:33 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:33 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:33 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:33 - __main__ - INFO - ================================================================================
2025-10-11 12:05:33 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:33 - __main__ - INFO - ================================================================================
2025-10-11 12:05:33 - __main__ - INFO - üÜî Process GUID: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:33 - __main__ - INFO - üìä Table: M_AROMA
2025-10-11 12:05:33 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:33 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:33 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:33 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:33 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:33 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:33 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:33 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:33 - __main__ - INFO - ================================================================================
2025-10-11 12:05:33 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:33 - __main__ - INFO - ================================================================================
2025-10-11 12:05:33 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:33 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:33 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:33 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:33 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:33 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:33 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:33 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_AROMA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:33,789-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:33,789-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:34,035-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:34,035-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:34 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:34,321-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:34 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:34 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Table: M_AROMA
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_aroma'
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic10f'
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica10, descrip, cantidad, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:34 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:34 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_AROMA process_guid: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:34 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_AROMA
2025-10-11 12:05:34 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:34 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:34 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:34 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:34 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:34 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:34 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_AROMA process_guid: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:34 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:34,561-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 1 objects across 1 pages","timestamp":"2025-10-11 12:05:34,632-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:274","message":"Deleting 1 objects from S3","timestamp":"2025-10-11 12:05:34,633-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:286","message":"Successfully deleted 1 objects","timestamp":"2025-10-11 12:05:34,678-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:34 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Table: M_AROMA
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:34 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 14, Filters: 0
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(califica10)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica10, descrip, cantidad, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic10f
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(califica10)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica10, descrip, cantidad, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic10f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Rows returned: 0
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - WARNING - Query returned empty result
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:34 - core.orchestrator - INFO - üîç No watermark to save
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic10f/year=2025/month=10/day=11/data_thread_0_chunk_0_6fa956d8.parquet","timestamp":"2025-10-11 12:05:34,710-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic10f/year=2025/month=10/day=11/data_thread_0_chunk_0_6fa956d8.parquet","timestamp":"2025-10-11 12:05:34,945-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:34 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table M_AROMA
2025-10-11 12:05:34 - bigmagic-monitor - WARNING - Advertencia procesando tabla M_AROMA: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:05:34 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:34 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:05:34 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:34 - __main__ - INFO - ================================================================================
2025-10-11 12:05:34 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:34 - __main__ - INFO - üÜî Process GUID: d83099e9-edfa-41fb-a5ba-5648b1b736f8
2025-10-11 12:05:34 - __main__ - INFO - üìä Records: 0
2025-10-11 12:05:34 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:34 - __main__ - INFO - ‚è±Ô∏è Time: 0.38s
2025-10-11 12:05:34 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:34 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_CAMBIO... 
2025-10-11 12:05:35 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:35 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:35 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:35 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:36 - __main__ - INFO - üÜî Process GUID generado: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:36 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:36 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:36 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:36 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:36 - __main__ - INFO - ================================================================================
2025-10-11 12:05:36 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:36 - __main__ - INFO - ================================================================================
2025-10-11 12:05:36 - __main__ - INFO - üÜî Process GUID: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:36 - __main__ - INFO - üìä Table: M_TIPO_CAMBIO
2025-10-11 12:05:36 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:36 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:36 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:36 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:36 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:36 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:36 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:36 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:36 - __main__ - INFO - ================================================================================
2025-10-11 12:05:36 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:36 - __main__ - INFO - ================================================================================
2025-10-11 12:05:36 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:36 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:36 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:36 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:36 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:36 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:36 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:36 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_CAMBIO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:36,227-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:36,227-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:36,467-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:36,467-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:36 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:36 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:36,728-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:36 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:36 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Table: M_TIPO_CAMBIO
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_cambio'
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - Checking source_table: 'mtcamb1f'
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,rtrim(ltrim(moneda)) moneda, fecha, compra, venta, promedio,cast(cast(tccierrev as int) as varchar(20)) tccierrev,cast(cast(tccierrec as int) as varchar(20)) tccierrec, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:36 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:36 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:36 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_CAMBIO process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:36 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_CAMBIO
2025-10-11 12:05:36 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:36 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:36 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:36 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:36 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:36 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:36 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_CAMBIO process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:36 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:36,972-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:37,039-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:37 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - Table: M_TIPO_CAMBIO
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:37 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) + '|' + dbo.func_cas_todateint(fecha) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, rtrim(ltrim(moneda)) moneda, fecha, compra, venta, promedio, cast(cast(tccierrev as int) as varchar(20)) tccierrev, cast(cast(tccierrec as int) as varchar(20)) tccierrec, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mtcamb1f
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) + '|' + dbo.func_cas_todateint(fecha) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, rtrim(ltrim(moneda)) moneda, fecha, compra, venta, promedio, cast(cast(tccierrev as int) as varchar(20)) tccierrev, cast(cast(tccierrec as int) as varchar(20)) tccierrec, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mtcamb1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.91s
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Rows returned: 29,887
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Columns: 17
2025-10-11 12:05:37 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 29,887 rows
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç Processing chunk 1 with 29887 rows
2025-10-11 12:05:37 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 29887 rows - process_guid: fe975eb8-7920-40e3-9efb-c38f17247056
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mtcamb1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8864bda4.parquet","timestamp":"2025-10-11 12:05:38,105-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mtcamb1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8864bda4.parquet","timestamp":"2025-10-11 12:05:38,321-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:38 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:38 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:38 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:38 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:38 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_CAMBIO
2025-10-11 12:05:38 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:38 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:38 - __main__ - INFO - ================================================================================
2025-10-11 12:05:38 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:38 - __main__ - INFO - üÜî Process GUID: fe975eb8-7920-40e3-9efb-c38f17247056
2025-10-11 12:05:38 - __main__ - INFO - üìä Records: 29,887
2025-10-11 12:05:38 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:38 - __main__ - INFO - ‚è±Ô∏è Time: 1.35s
2025-10-11 12:05:38 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:38 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_CANAL... 
2025-10-11 12:05:39 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:39 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:39 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:39 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:39 - __main__ - INFO - üÜî Process GUID generado: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:39 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:39 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:39 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:39 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:39 - __main__ - INFO - ================================================================================
2025-10-11 12:05:39 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:39 - __main__ - INFO - ================================================================================
2025-10-11 12:05:39 - __main__ - INFO - üÜî Process GUID: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:39 - __main__ - INFO - üìä Table: M_CANAL
2025-10-11 12:05:39 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:39 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:39 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:39 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:39 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:39 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:39 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:39 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:39 - __main__ - INFO - ================================================================================
2025-10-11 12:05:39 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:39 - __main__ - INFO - ================================================================================
2025-10-11 12:05:39 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:39 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:39 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:39 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:39 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:39 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:39 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:39 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_CANAL', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:39,893-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:39,893-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:40,117-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:40,117-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:40 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:40,431-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:40 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:40 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Table: M_CANAL
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_canal'
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Checking source_table: 'tcandis1f'
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Checking columns: 'compania, canal,replace(replace(descripcion, char(13),''), char(10),'') descripcion, centrocost, estado'
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:40 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:40 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_CANAL process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:40 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_CANAL
2025-10-11 12:05:40 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:40 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:40 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:40 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:40 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:40 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:40 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_CANAL process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:40 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:40,664-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:40,727-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:40 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Table: M_CANAL
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:40 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 10, Filters: 0
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(canal)) as id, compania, canal, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, centrocost, estado FROM tcandis1f
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(canal)) as id, compania, canal, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, centrocost, estado FROM tcandis1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Rows returned: 36
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Columns: 6
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 36 rows
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç Processing chunk 1 with 36 rows
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 36 rows - process_guid: d15167d7-a3c0-4242-868a-6c3568c861e9
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcandis1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_b2491735.parquet","timestamp":"2025-10-11 12:05:40,742-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcandis1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_b2491735.parquet","timestamp":"2025-10-11 12:05:40,805-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:40 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:40 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_CANAL
2025-10-11 12:05:40 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:40 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:40 - __main__ - INFO - ================================================================================
2025-10-11 12:05:40 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:40 - __main__ - INFO - üÜî Process GUID: d15167d7-a3c0-4242-868a-6c3568c861e9
2025-10-11 12:05:40 - __main__ - INFO - üìä Records: 36
2025-10-11 12:05:40 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:40 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:05:40 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:40 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_GIRO... 
2025-10-11 12:05:41 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:41 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:41 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:41 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:41 - __main__ - INFO - üÜî Process GUID generado: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:42 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:42 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:42 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:42 - __main__ - INFO - ================================================================================
2025-10-11 12:05:42 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:42 - __main__ - INFO - ================================================================================
2025-10-11 12:05:42 - __main__ - INFO - üÜî Process GUID: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - __main__ - INFO - üìä Table: M_GIRO
2025-10-11 12:05:42 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:42 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:42 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:42 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:42 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:42 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:42 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:42 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:42 - __main__ - INFO - ================================================================================
2025-10-11 12:05:42 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:42 - __main__ - INFO - ================================================================================
2025-10-11 12:05:42 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:42 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:42 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:42 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:42 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:42 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:42 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_GIRO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:42,088-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:42,088-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:42,301-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:42,301-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:42 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:42,631-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:42 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:42 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Table: M_GIRO
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_giro'
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Checking source_table: 'bgirotf'
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecmodi,horamodi) lastmodifydate, compania, giro, girdnom, estado, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi'
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:42 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:42 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_GIRO process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_GIRO
2025-10-11 12:05:42 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:42 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:42 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:42 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:42 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:42 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:42 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_GIRO process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:42,875-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:42,953-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:42 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Table: M_GIRO
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:42 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 13, Filters: 0
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(giro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, giro, girdnom, estado, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM bgirotf
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(giro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, giro, girdnom, estado, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM bgirotf
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Rows returned: 420
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:05:42 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 420 rows
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç Processing chunk 1 with 420 rows
2025-10-11 12:05:42 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 420 rows - process_guid: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bgirotf/year=2025/month=10/day=11/data_thread_0_0_chunk_0_33a5ebbb.parquet","timestamp":"2025-10-11 12:05:42,985-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bgirotf/year=2025/month=10/day=11/data_thread_0_0_chunk_0_33a5ebbb.parquet","timestamp":"2025-10-11 12:05:43,044-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:43 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:43 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:43 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:43 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:43 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_GIRO
2025-10-11 12:05:43 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:43 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:43 - __main__ - INFO - ================================================================================
2025-10-11 12:05:43 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:43 - __main__ - INFO - üÜî Process GUID: 8d78c67f-08b5-4e53-96e8-b897d4ddb5f4
2025-10-11 12:05:43 - __main__ - INFO - üìä Records: 420
2025-10-11 12:05:43 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:43 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:05:43 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:43 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_CATEGORIA... 
2025-10-11 12:05:44 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:44 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:44 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:44 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:44 - __main__ - INFO - üÜî Process GUID generado: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:44 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:44 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:44 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:44 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:44 - __main__ - INFO - ================================================================================
2025-10-11 12:05:44 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:44 - __main__ - INFO - ================================================================================
2025-10-11 12:05:44 - __main__ - INFO - üÜî Process GUID: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:44 - __main__ - INFO - üìä Table: M_CATEGORIA
2025-10-11 12:05:44 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:44 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:44 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:44 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:44 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:44 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:44 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:44 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:44 - __main__ - INFO - ================================================================================
2025-10-11 12:05:44 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:44 - __main__ - INFO - ================================================================================
2025-10-11 12:05:44 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:44 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:44 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:44 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:44 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:44 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:44 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:44 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_CATEGORIA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:44,489-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:44,489-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:44,738-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:44,738-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:44 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:44 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:45,023-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:45 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:45 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Table: M_CATEGORIA
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_categoria'
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic5f'
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica5,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp'
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:45 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:45 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_CATEGORIA process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:45 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_CATEGORIA
2025-10-11 12:05:45 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:45 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:45 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:45 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:45 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:45 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:45 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_CATEGORIA process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:45 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:45,266-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:45,336-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:45 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Table: M_CATEGORIA
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:45 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica5)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica5, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp FROM bartic5f
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica5)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica5, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp FROM bartic5f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.05s
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Rows returned: 940
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 940 rows
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç Processing chunk 1 with 940 rows
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 940 rows - process_guid: 2ae9595f-bf13-43f8-a650-5ec8a707095d
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic5f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_2c08d54b.parquet","timestamp":"2025-10-11 12:05:45,397-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic5f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_2c08d54b.parquet","timestamp":"2025-10-11 12:05:45,461-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:45 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:45 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_CATEGORIA
2025-10-11 12:05:45 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:45 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:45 - __main__ - INFO - ================================================================================
2025-10-11 12:05:45 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:45 - __main__ - INFO - üÜî Process GUID: 2ae9595f-bf13-43f8-a650-5ec8a707095d
2025-10-11 12:05:45 - __main__ - INFO - üìä Records: 940
2025-10-11 12:05:45 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:45 - __main__ - INFO - ‚è±Ô∏è Time: 0.20s
2025-10-11 12:05:45 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:45 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_MONEDA... 
2025-10-11 12:05:46 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:46 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:46 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:46 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:46 - __main__ - INFO - üÜî Process GUID generado: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:46 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:46 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:46 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:46 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:46 - __main__ - INFO - ================================================================================
2025-10-11 12:05:46 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:46 - __main__ - INFO - ================================================================================
2025-10-11 12:05:46 - __main__ - INFO - üÜî Process GUID: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:46 - __main__ - INFO - üìä Table: M_MONEDA
2025-10-11 12:05:46 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:46 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:46 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:46 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:46 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:46 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:46 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:46 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:46 - __main__ - INFO - ================================================================================
2025-10-11 12:05:46 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:46 - __main__ - INFO - ================================================================================
2025-10-11 12:05:46 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:46 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:46 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:46 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:46 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:46 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:46 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:46 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_MONEDA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:46,866-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:46,867-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:47,103-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:47,103-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:47 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:47,415-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:47 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:47 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Table: M_MONEDA
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_moneda'
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Checking source_table: 'mmoned1f'
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea'
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:47 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:47 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_MONEDA process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:47 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_MONEDA
2025-10-11 12:05:47 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:47 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:47 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:47 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:47 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:47 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:47 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_MONEDA process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:47 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:47,634-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:47,696-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:47 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Table: M_MONEDA
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:47 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea FROM mmoned1f
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea FROM mmoned1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Columns: 17
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 50 rows
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç Processing chunk 1 with 50 rows
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 50 rows - process_guid: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmoned1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_324a5f4f.parquet","timestamp":"2025-10-11 12:05:47,728-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmoned1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_324a5f4f.parquet","timestamp":"2025-10-11 12:05:47,790-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:47 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:47 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_MONEDA
2025-10-11 12:05:47 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:47 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:47 - __main__ - INFO - ================================================================================
2025-10-11 12:05:47 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:47 - __main__ - INFO - üÜî Process GUID: 24219ae8-7739-4a1f-8603-1bfb893ad9e2
2025-10-11 12:05:47 - __main__ - INFO - üìä Records: 50
2025-10-11 12:05:47 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:47 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:05:47 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:47 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla I_RELACION_CONSUMO... 
2025-10-11 12:05:48 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:48 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:48 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:48 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:48 - __main__ - INFO - üÜî Process GUID generado: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:49 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:49 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:49 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:49 - __main__ - INFO - ================================================================================
2025-10-11 12:05:49 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:49 - __main__ - INFO - ================================================================================
2025-10-11 12:05:49 - __main__ - INFO - üÜî Process GUID: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - __main__ - INFO - üìä Table: I_RELACION_CONSUMO
2025-10-11 12:05:49 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:49 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:49 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:49 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:49 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:49 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:49 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:49 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:49 - __main__ - INFO - ================================================================================
2025-10-11 12:05:49 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:49 - __main__ - INFO - ================================================================================
2025-10-11 12:05:49 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:49 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:49 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:49 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:49 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:49 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:49 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-I_RELACION_CONSUMO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:49,124-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:49,124-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:49,340-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:49,341-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:49 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:49,633-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:49 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:49 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Table: I_RELACION_CONSUMO
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'i_relacion_consumo'
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Checking source_table: 'trelcons1f'
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecmodi,horamodi) lastmodifydate, compania, codocas, canal, giro, subgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi'
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:49 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:49 - core.orchestrator - INFO - üöÄ Starting extraction - table: I_RELACION_CONSUMO process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla I_RELACION_CONSUMO
2025-10-11 12:05:49 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:49 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:49 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:49 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:49 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:49 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:49 - core.orchestrator - INFO - üìä Executing fullload strategy - table: I_RELACION_CONSUMO process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:49,869-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:49,941-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:49 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Table: I_RELACION_CONSUMO
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:49 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 15, Filters: 0
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(subgiro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, codocas, canal, giro, subgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM trelcons1f
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(subgiro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, codocas, canal, giro, subgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM trelcons1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.05s
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,196
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Columns: 14
2025-10-11 12:05:49 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,196 rows
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç Processing chunk 1 with 1196 rows
2025-10-11 12:05:49 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1196 rows - process_guid: 253f6aa2-a5de-4593-af9a-801526c21c8b
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/trelcons1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_c4b11ef0.parquet","timestamp":"2025-10-11 12:05:50,007-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/trelcons1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_c4b11ef0.parquet","timestamp":"2025-10-11 12:05:50,061-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:50 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:50 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:50 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:50 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:50 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla I_RELACION_CONSUMO
2025-10-11 12:05:50 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:50 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:50 - __main__ - INFO - ================================================================================
2025-10-11 12:05:50 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:50 - __main__ - INFO - üÜî Process GUID: 253f6aa2-a5de-4593-af9a-801526c21c8b
2025-10-11 12:05:50 - __main__ - INFO - üìä Records: 1,196
2025-10-11 12:05:50 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:50 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:05:50 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:50 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla I_RELACION_PROCED_VENTA... 
2025-10-11 12:05:51 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:51 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:51 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:51 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:51 - __main__ - INFO - üÜî Process GUID generado: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:51 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:51 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:51 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:51 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:51 - __main__ - INFO - ================================================================================
2025-10-11 12:05:51 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:51 - __main__ - INFO - ================================================================================
2025-10-11 12:05:51 - __main__ - INFO - üÜî Process GUID: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:51 - __main__ - INFO - üìä Table: I_RELACION_PROCED_VENTA
2025-10-11 12:05:51 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:51 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:51 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:51 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:51 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:51 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:51 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:51 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:51 - __main__ - INFO - ================================================================================
2025-10-11 12:05:51 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:51 - __main__ - INFO - ================================================================================
2025-10-11 12:05:51 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:51 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:51 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:51 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:51 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:51 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:51 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:51 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-I_RELACION_PROCED_VENTA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:51,415-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:51,415-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:51,658-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:51,658-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:51 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:51 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:51,930-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:51 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:51 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Table: I_RELACION_PROCED_VENTA
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'i_relacion_proced_venta'
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - Checking source_table: 'brelpro1f'
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecmodifi,hormodifi) lastmodifydate, compania, docuorig, tipdocori, procorige, docudest, procdest, operdest, estado, feccreacio, horcreacio, usucreacio, fecmodifi, hormodifi, usumodifi'
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:51 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:51 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:51 - core.orchestrator - INFO - üöÄ Starting extraction - table: I_RELACION_PROCED_VENTA process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:51 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla I_RELACION_PROCED_VENTA
2025-10-11 12:05:52 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:52 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:52 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:52 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:52 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:52 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:52 - core.orchestrator - INFO - üìä Executing fullload strategy - table: I_RELACION_PROCED_VENTA process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:52 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:52,164-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:52,243-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:52 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - Table: I_RELACION_PROCED_VENTA
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:52 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(docuorig)) + '|' + ltrim(rtrim(tipdocori)) + '|' + ltrim(rtrim(procorige)) + '|' + ltrim(rtrim(docudest)) + '|' + ltrim(rtrim(procdest)) + '|' + ltrim(rtrim(operdest)) as id, dbo.func_cas_todatetime(fecmodifi, hormodifi) lastmodifydate, compania, docuorig, tipdocori, procorige, docudest, procdest, operdest, estado, feccreacio, horcreacio, usucreacio, fecmodifi, hormodifi, usumodifi FROM brelpro1f
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(docuorig)) + '|' + ltrim(rtrim(tipdocori)) + '|' + ltrim(rtrim(procorige)) + '|' + ltrim(rtrim(docudest)) + '|' + ltrim(rtrim(procdest)) + '|' + ltrim(rtrim(operdest)) as id, dbo.func_cas_todatetime(fecmodifi, hormodifi) lastmodifydate, compania, docuorig, tipdocori, procorige, docudest, procdest, operdest, estado, feccreacio, horcreacio, usucreacio, fecmodifi, hormodifi, usumodifi FROM brelpro1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Rows returned: 380
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Columns: 16
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 380 rows
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç Processing chunk 1 with 380 rows
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 380 rows - process_guid: b196fc8a-3680-41a4-9a70-c8a59cabc159
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/brelpro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e3f83ef4.parquet","timestamp":"2025-10-11 12:05:52,274-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/brelpro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e3f83ef4.parquet","timestamp":"2025-10-11 12:05:52,352-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:52 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:52 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla I_RELACION_PROCED_VENTA
2025-10-11 12:05:52 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:52 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:52 - __main__ - INFO - ================================================================================
2025-10-11 12:05:52 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:52 - __main__ - INFO - üÜî Process GUID: b196fc8a-3680-41a4-9a70-c8a59cabc159
2025-10-11 12:05:52 - __main__ - INFO - üìä Records: 380
2025-10-11 12:05:52 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:52 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:05:52 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:52 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_ALMACEN... 
2025-10-11 12:05:53 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:53 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:53 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:53 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:53 - __main__ - INFO - üÜî Process GUID generado: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:53 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:53 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:53 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:53 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:53 - __main__ - INFO - ================================================================================
2025-10-11 12:05:53 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:53 - __main__ - INFO - ================================================================================
2025-10-11 12:05:53 - __main__ - INFO - üÜî Process GUID: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:53 - __main__ - INFO - üìä Table: M_ALMACEN
2025-10-11 12:05:53 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:53 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:53 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:53 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:53 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:53 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:53 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:53 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:53 - __main__ - INFO - ================================================================================
2025-10-11 12:05:53 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:53 - __main__ - INFO - ================================================================================
2025-10-11 12:05:53 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:53 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:53 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:53 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:53 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:53 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:53 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:53 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_ALMACEN', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:53,735-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:53,735-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:53,963-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:53,963-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:53 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:53 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:54,258-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:54 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:54 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Table: M_ALMACEN
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_almacen'
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Checking source_table: 'memiso1f'
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,replace(replace(descemisor, char(13),''), char(10),'') descemisor,rtrim(ltrim(ccosemisor)) ccosemisor,case when flgconexi = 0x46 then 'F' when flgconexi = 0x54 then 'T' end flgconexi,cast(cast(tipartpro as int) as varchar(20)) tipartpro, tipstock,case when flgcajcom = 0x46 then 'F' when flgcajcom = 0x54 then 'T' end flgcajcom, fecprevta, fecdistrib, fecliquida, fecalmacen, feccaja, feccajaent,cast(cast(diasplazop as int) as varchar(20)) diasplazop, stsemisor, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, tipartic, lugar, tpedido,case when flganula = 0x46 then 'F' when flganula = 0x54 then 'T' end flganula,case when ctrlreq = 0x46 then 'F' when ctrlreq = 0x54 then 'T' end ctrlreq, ctaccreq, maxgpls,case when flgomle = 0x46 then 'F' when flgomle = 0x54 then 'T' end flgomle,case when ctrllote = 0x46 then 'F' when ctrllote = 0x54 then 'T' end ctrllote,case when manrepstk = 0x46 then 'F' when manrepstk = 0x54 then 'T' end manrepstk,case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo,case when esdeconsignacion = 0x46 then 'F' when esdeconsignacion = 0x54 then 'T' end esdeconsignacion,case when stklinea = 0x46 then 'F' when stklinea = 0x54 then 'T' end stklinea, freccie, distancia, cappalets,replace(replace(direccion, char(13),''), char(10),'') direccion, zonapostal, flgnoinvent'
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:54 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:54 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_ALMACEN process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:54 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_ALMACEN
2025-10-11 12:05:54 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:54 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:54 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:54 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:54 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:54 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:54 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_ALMACEN process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:54 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:54,524-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:54,602-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:54 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Table: M_ALMACEN
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:54 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 53, Filters: 0
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, rtrim(ltrim(emisor)) emisor, replace(replace(descemisor, char(13), ''), char(10), '') descemisor, rtrim(ltrim(ccosemisor)) ccosemisor, case when flgconexi = 0x46 then 'F' when flgconexi = 0x54 then 'T' end flgconexi, cast(cast(tipartpro as int) as varchar(20)) tipartpro, tipstock, case when flgcajcom = 0x46 then 'F' when flgcajcom = 0x54 then 'T' end flgcajcom, fecprevta, fecdistrib, fecliquida, fecalmacen, feccaja, feccajaent, cast(cast(diasplazop as int) as varchar(20)) diasplazop, stsemisor, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, tipartic, lugar, tpedido, case when flganula = 0x46 then 'F' when flganula = 0x54 then 'T' end flganula, case when ctrlreq = 0x46 then 'F' when ctrlreq = 0x54 then 'T' end ctrlreq, ctaccreq, maxgpls, case when flgomle = 0x46 then 'F' when flgomle = 0x54 then 'T' end flgomle, case when ctrllote = 0x46 then 'F' when ctrllote = 0x54 then 'T' end ctrllote, case when manrepstk = 0x46 then 'F' when manrepstk = 0x54 then 'T' end manrepstk, case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo, case when esdeconsignacion = 0x46 then 'F' when esdeconsignacion = 0x54 then 'T' end esdeconsignacion, case when stklinea = 0x46 then 'F' when stklinea = 0x54 then 'T' end stklinea, freccie, distancia, cappalets, replace(replace(direccion, char(13), ''), char(10), '') direccion, zonapostal, flgnoinvent FROM memiso1f
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, rtrim(ltrim(emisor)) emisor, replace(replace(descemisor, char(13), ''), char(10), '') descemisor, rtrim(ltrim(ccosemisor)) ccosemisor, case when flgconexi = 0x46 then 'F' when flgconexi = 0x54 then 'T' end flgconexi, cast(cast(tipartpro as int) as varchar(20)) tipartpro, tipstock, case when flgcajcom = 0x46 then 'F' when flgcajcom = 0x54 then 'T' end flgcajcom, fecprevta, fecdistrib, fecliquida, fecalmacen, feccaja, feccajaent, cast(cast(diasplazop as int) as varchar(20)) diasplazop, stsemisor, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, tipartic, lugar, tpedido, case when flganula = 0x46 then 'F' when flganula = 0x54 then 'T' end flganula, case when ctrlreq = 0x46 then 'F' when ctrlreq = 0x54 then 'T' end ctrlreq, ctaccreq, maxgpls, case when flgomle = 0x46 then 'F' when flgomle = 0x54 then 'T' end flgomle, case when ctrllote = 0x46 then 'F' when ctrllote = 0x54 then 'T' end ctrllote, case when manrepstk = 0x46 then 'F' when manrepstk = 0x54 then 'T' end manrepstk, case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo, case when esdeconsignacion = 0x46 then 'F' when esdeconsignacion = 0x54 then 'T' end esdeconsignacion, case when stklinea = 0x46 then 'F' when stklinea = 0x54 then 'T' end stklinea, freccie, distancia, cappalets, replace(replace(direccion, char(13), ''), char(10), '') direccion, zonapostal, flgnoinvent FROM memiso1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.08s
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,322
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Columns: 44
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,322 rows
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç Processing chunk 1 with 1322 rows
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1322 rows - process_guid: b79cba60-0f9f-4b09-a4ee-6740abe478f9
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/memiso1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_82f7c226.parquet","timestamp":"2025-10-11 12:05:54,716-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/memiso1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_82f7c226.parquet","timestamp":"2025-10-11 12:05:54,787-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:05:54 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:05:54 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_ALMACEN
2025-10-11 12:05:54 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:54 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:05:54 - __main__ - INFO - ================================================================================
2025-10-11 12:05:54 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:05:54 - __main__ - INFO - üÜî Process GUID: b79cba60-0f9f-4b09-a4ee-6740abe478f9
2025-10-11 12:05:54 - __main__ - INFO - üìä Records: 1,322
2025-10-11 12:05:54 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:05:54 - __main__ - INFO - ‚è±Ô∏è Time: 0.26s
2025-10-11 12:05:54 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:05:54 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_ARTICULO... 
2025-10-11 12:05:55 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:05:55 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:05:55 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:05:55 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:05:55 - __main__ - INFO - üÜî Process GUID generado: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:56 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:56 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:05:56 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:05:56 - __main__ - INFO - ================================================================================
2025-10-11 12:05:56 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:05:56 - __main__ - INFO - ================================================================================
2025-10-11 12:05:56 - __main__ - INFO - üÜî Process GUID: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - __main__ - INFO - üìä Table: M_ARTICULO
2025-10-11 12:05:56 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:05:56 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:05:56 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:05:56 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:05:56 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:05:56 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:05:56 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:05:56 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:05:56 - __main__ - INFO - ================================================================================
2025-10-11 12:05:56 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:05:56 - __main__ - INFO - ================================================================================
2025-10-11 12:05:56 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:05:56 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:05:56 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:05:56 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:05:56 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:05:56 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:05:56 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_ARTICULO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:56,093-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:56,093-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:05:56,330-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:05:56,330-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:05:56 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:56,602-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:56 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:05:56 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Table: M_ARTICULO
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_articulo'
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Checking source_table: 'martic1f'
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,cast(cast(articulo as bigint) as varchar(20)) articulo, codenlace, linea, familia, subfamilia, flglinea,replace(replace(descrip1, char(13),''), char(10),'') descrip1,replace(replace(descrip2, char(13),''), char(10),'') descrip2,replace(replace(descrip3, char(13),''), char(10),'') descrip3,replace(replace(descrip4, char(13),''), char(10),'') descrip4,replace(replace(descrip5, char(13),''), char(10),'') descrip5, unipeso, qpeso, univolumen, qtotal, unicompra, qminimacom, unidcosto, unimanejo, unidadcont, qcontenido, cajaxpalet, lugentrega, vtoregsani, fecapertur, fecultcomp, monultcomp, preultcomp, linfabric, tipartcome,cast(cast(tipartprod as int) as varchar(20)) tipartprod, articalif1, articalif2, articalif3, articalif4, articalif5, articalif6, articalif7, articalif8, articalif9, articalif10, flgtipenva, artenvase, grupoarti, flgtipcomp, orden1, orden2, stockmin, stockmax, qrepos, tamlote,replace(replace(diastkmin, char(13),''), char(10),'') diastkmin,replace(replace(diavidutil, char(13),''), char(10),'') diavidutil,replace(replace(diareposic, char(13),''), char(10),'') diareposic, procedenc, flgabastec, porcadicio,case when flgmanelot = 0x46 then 'F' when flgmanelot = 0x54 then 'T' end flgmanelot,case when flgnecepro = 0x46 then 'F' when flgnecepro = 0x54 then 'T' end flgnecepro,case when flglotemin = 0x46 then 'F' when flglotemin = 0x54 then 'T' end flglotemin,case when flgprodfis = 0x46 then 'F' when flgprodfis = 0x54 then 'T' end flgprodfis,case when flgsubuni = 0x46 then 'F' when flgsubuni = 0x54 then 'T' end flgsubuni, rendimient,case when flgstsprev = 0x46 then 'F' when flgstsprev = 0x54 then 'T' end flgstsprev, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codfabr, almdfcuar, almdfdispo, almdfrech, granel, stkcompr, stkdispo,replace(replace(desctecnic, char(13),''), char(10),'') desctecnic, tipartic, almcuaren, maenvas, cajaenv, articalif11, paqxcaj, conceptogasto, cbarras, ubica, arteqnac,case when manstkcomp = 0x46 then 'F' when manstkcomp = 0x54 then 'T' end manstkcomp,case when compsuger = 0x46 then 'F' when compsuger = 0x54 then 'T' end compsuger, genreqcomp, cantcaj, nrocamas, cattributa, precioval, regsanit, tipalmop,case when flgvaloriza = 0x46 then 'F' when flgvaloriza = 0x54 then 'T' end flgvaloriza,case when novaloriza = 0x46 then 'F' when novaloriza = 0x54 then 'T' end novaloriza, origmerser, tribicms, qtotalfor,cast(cast(articulo_corp as bigint) as varchar(20)) articulo_corp,replace(replace(descrip1_corp, char(13),''), char(10),'') descrip1_corp, qpesoneto,case when flgventa = 0x46 then 'F' when flgventa = 0x54 then 'T' end flgventa, flgprestamo, transactionid, artrelac, case when flgexplosion = 0x46 then 'F' when flgexplosion = 0x54 then 'T' end flgexplosion, case when flgskuplan = 0x46 then 'F' when flgskuplan = 0x54 then 'T' end flgskuplan, qalto, qlargo, '' as undneg, null as qvolumen'
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:05:56 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:05:56 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_ARTICULO process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_ARTICULO
2025-10-11 12:05:56 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:05:56 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:05:56 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:05:56 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:05:56 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:05:56 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:05:56 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_ARTICULO process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:05:56,821-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:05:56,899-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:05:56 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Table: M_ARTICULO
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:05:56 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 160, Filters: 0
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:05:56 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(cast(articulo as bigint) as varchar(100)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, cast(cast(articulo as bigint) as varchar(20)) articulo, codenlace, linea, familia, subfamilia, flglinea, replace(replace(descrip1, char(13), ''), char(10), '') descrip1, replace(replace(descrip2, char(13), ''), char(10), '') descrip2, replace(replace(descrip3, char(13), ''), char(10), '') descrip3, replace(replace(descrip4, char(13), ''), char(10), '') descrip4, replace(replace(descrip5, char(13), ''), char(10), '') descrip5, unipeso, qpeso, univolumen, qtotal, unicompra, qminimacom, unidcosto, unimanejo, unidadcont, qcontenido, cajaxpalet, lugentrega, vtoregsani, fecapertur, fecultcomp, monultcomp, preultcomp, linfabric, tipartcome, cast(cast(tipartprod as int) as varchar(20)) tipartprod, articalif1, articalif2, articalif3, articalif4, articalif5, articalif6, articalif7, articalif8, articalif9, articalif10, flgtipenva, artenvase, grupoarti, flgtipcomp, orden1, orden2, stockmin, stockmax, qrepos, tamlote, replace(replace(diastkmin, char(13), ''), char(10), '') diastkmin, replace(replace(diavidutil, char(13), ''), char(10), '') diavidutil, replace(replace(diareposic, char(13), ''), char(10), '') diareposic, procedenc, flgabastec, porcadicio, case when flgmanelot = 0x46 then 'F' when flgmanelot = 0x54 then 'T' end flgmanelot, case when flgnecepro = 0x46 then 'F' when flgnecepro = 0x54 then 'T' end flgnecepro, case when flglotemin = 0x46 then 'F' when flglotemin = 0x54 then 'T' end flglotemin, case when flgprodfis = 0x46 then 'F' when flgprodfis = 0x54 then 'T' end flgprodfis, case when flgsubuni = 0x46 then 'F' when flgsubuni = 0x54 then 'T' end flgsubuni, rendimient, case when flgstsprev = 0x46 then 'F' when flgstsprev = 0x54 then 'T' end flgstsprev, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codfabr, almdfcuar, almdfdispo, almdfrech, granel, stkcompr, stkdispo, replace(replace(desctecnic, char(13), ''), char(10), '') desctecnic, tipartic, almcuaren, maenvas, cajaenv, articalif11, paqxcaj, conceptogasto, cbarras, ubica, arteqnac, case when manstkcomp = 0x46 then 'F' when manstkcomp = 0x54 then 'T' end manstkcomp, case when compsuger = 0x46 then 'F' when compsuger = 0x54 then 'T' end compsuger, genreqcomp, cantcaj, nrocamas, cattributa, precioval, regsanit, tipalmop, case when flgvaloriza = 0x46 then 'F' when flgvaloriza = 0x54 then 'T' end flgvaloriza, case when novaloriza = 0x46 then 'F' when novaloriza = 0x54 then 'T' end novaloriza, origmerser, tribicms, qtotalfor, cast(cast(articulo_corp as bigint) as varchar(20)) articulo_corp, replace(replace(descrip1_corp, char(13), ''), char(10), '') descrip1_corp, qpesoneto, case when flgventa = 0x46 then 'F' when flgventa = 0x54 then 'T' end flgventa, flgprestamo, transactionid, artrelac, case when flgexplosion = 0x46 then 'F' when flgexplosion = 0x54 then 'T' end flgexplosion, case when flgskuplan = 0x46 then 'F' when flgskuplan = 0x54 then 'T' end flgskuplan, qalto, qlargo, '' as undneg, null as qvolumen FROM martic1f
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:05:56 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(cast(articulo as bigint) as varchar(100)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, cast(cast(articulo as bigint) as varchar(20)) articulo, codenlace, linea, familia, subfamilia, flglinea, replace(replace(descrip1, char(13), ''), char(10), '') descrip1, replace(replace(descrip2, char(13), ''), char(10), '') descrip2, replace(replace(descrip3, char(13), ''), char(10), '') descrip3, replace(replace(descrip4, char(13), ''), char(10), '') descrip4, replace(replace(descrip5, char(13), ''), char(10), '') descrip5, unipeso, qpeso, univolumen, qtotal, unicompra, qminimacom, unidcosto, unimanejo, unidadcont, qcontenido, cajaxpalet, lugentrega, vtoregsani, fecapertur, fecultcomp, monultcomp, preultcomp, linfabric, tipartcome, cast(cast(tipartprod as int) as varchar(20)) tipartprod, articalif1, articalif2, articalif3, articalif4, articalif5, articalif6, articalif7, articalif8, articalif9, articalif10, flgtipenva, artenvase, grupoarti, flgtipcomp, orden1, orden2, stockmin, stockmax, qrepos, tamlote, replace(replace(diastkmin, char(13), ''), char(10), '') diastkmin, replace(replace(diavidutil, char(13), ''), char(10), '') diavidutil, replace(replace(diareposic, char(13), ''), char(10), '') diareposic, procedenc, flgabastec, porcadicio, case when flgmanelot = 0x46 then 'F' when flgmanelot = 0x54 then 'T' end flgmanelot, case when flgnecepro = 0x46 then 'F' when flgnecepro = 0x54 then 'T' end flgnecepro, case when flglotemin = 0x46 then 'F' when flglotemin = 0x54 then 'T' end flglotemin, case when flgprodfis = 0x46 then 'F' when flgprodfis = 0x54 then 'T' end flgprodfis, case when flgsubuni = 0x46 then 'F' when flgsubuni = 0x54 then 'T' end flgsubuni, rendimient, case when flgstsprev = 0x46 then 'F' when flgstsprev = 0x54 then 'T' end flgstsprev, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codfabr, almdfcuar, almdfdispo, almdfrech, granel, stkcompr, stkdispo, replace(replace(desctecnic, char(13), ''), char(10), '') desctecnic, tipartic, almcuaren, maenvas, cajaenv, articalif11, paqxcaj, conceptogasto, cbarras, ubica, arteqnac, case when manstkcomp = 0x46 then 'F' when manstkcomp = 0x54 then 'T' end manstkcomp, case when compsuger = 0x46 then 'F' when compsuger = 0x54 then 'T' end compsuger, genreqcomp, cantcaj, nrocamas, cattributa, precioval, regsanit, tipalmop, case when flgvaloriza = 0x46 then 'F' when flgvaloriza = 0x54 then 'T' end flgvaloriza, case when novaloriza = 0x46 then 'F' when novaloriza = 0x54 then 'T' end novaloriza, origmerser, tribicms, qtotalfor, cast(cast(articulo_corp as bigint) as varchar(20)) articulo_corp, replace(replace(descrip1_corp, char(13), ''), char(10), '') descrip1_corp, qpesoneto, case when flgventa = 0x46 then 'F' when flgventa = 0x54 then 'T' end flgventa, flgprestamo, transactionid, artrelac, case when flgexplosion = 0x46 then 'F' when flgexplosion = 0x54 then 'T' end flgexplosion, case when flgskuplan = 0x46 then 'F' when flgskuplan = 0x54 then 'T' end flgskuplan, qalto, qlargo, '' as undneg, null as qvolumen FROM martic1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:06:00 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:06:00 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.40s
2025-10-11 12:06:00 - extract.extractors.sql_server_extractor - INFO - Rows returned: 28,484
2025-10-11 12:06:00 - extract.extractors.sql_server_extractor - INFO - Columns: 119
2025-10-11 12:06:00 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 28,484 rows
2025-10-11 12:06:00 - core.orchestrator - INFO - üîç Processing chunk 1 with 28484 rows
2025-10-11 12:06:00 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 28484 rows - process_guid: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/martic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ad579497.parquet","timestamp":"2025-10-11 12:06:01,176-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/martic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ad579497.parquet","timestamp":"2025-10-11 12:06:01,385-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:01 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:06:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:01 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:06:01 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:06:01 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:06:01 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_ARTICULO
2025-10-11 12:06:01 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:01 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:06:01 - __main__ - INFO - ================================================================================
2025-10-11 12:06:01 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:06:01 - __main__ - INFO - üÜî Process GUID: b4ae04ed-9b47-49eb-8036-dda7dcbb3d84
2025-10-11 12:06:01 - __main__ - INFO - üìä Records: 28,484
2025-10-11 12:06:01 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:06:01 - __main__ - INFO - ‚è±Ô∏è Time: 4.61s
2025-10-11 12:06:01 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:06:01 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_ASIGNACION_MODULO... 
2025-10-11 12:06:02 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:06:02 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:06:02 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:06:02 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:06:02 - __main__ - INFO - üÜî Process GUID generado: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:02 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:02 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:02 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:06:02 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:06:02 - __main__ - INFO - ================================================================================
2025-10-11 12:06:02 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:06:02 - __main__ - INFO - ================================================================================
2025-10-11 12:06:02 - __main__ - INFO - üÜî Process GUID: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:02 - __main__ - INFO - üìä Table: M_ASIGNACION_MODULO
2025-10-11 12:06:02 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:06:02 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:06:02 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:06:02 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:06:02 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:06:02 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:06:02 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:06:02 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:06:02 - __main__ - INFO - ================================================================================
2025-10-11 12:06:02 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:06:02 - __main__ - INFO - ================================================================================
2025-10-11 12:06:02 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:02 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:06:02 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:06:02 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:06:02 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:06:02 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:06:02 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:06:02 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_ASIGNACION_MODULO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:02,848-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:02,848-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:03,094-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:06:03,095-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:06:03 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:03,400-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:03 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:03 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Table: M_ASIGNACION_MODULO
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_asignacion_modulo'
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Checking source_table: 'mclien4f'
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(cliente as int) as varchar(20)) cliente,cast(cast(modulo as int) as varchar(20)) modulo,cast(cast(ordvisita as int) as varchar(20)) ordvisita, tipmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(sucursal)) sucursal,case when imppaqte = 0x46 then 'F' when imppaqte = 0x54 then 'T' end imppaqte,cast(coordx as varchar(20)) coordx,cast(coordy as varchar(20)) coordy, flgvtajef,cast(cast(codfvtas as int) as varchar(20)) codfvtas, cast(coddirec as varchar(20)) coddirec'
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:06:03 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:06:03 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_ASIGNACION_MODULO process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:03 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_ASIGNACION_MODULO
2025-10-11 12:06:03 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:03 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:06:03 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:06:03 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:06:03 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:06:03 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:06:03 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_ASIGNACION_MODULO process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:03 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:03,634-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:06:03,712-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:03 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Table: M_ASIGNACION_MODULO
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:06:03 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 21, Filters: 0
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:06:03 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania))+'|'+ltrim(rtrim(sucursal))+'|'+cast(cliente as varchar(20))+'|'+cast(modulo as varchar(20))+'|'+cast(codfvtas as varchar(20))+'|'+cast(coddirec as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(cliente as int) as varchar(20)) cliente, cast(cast(modulo as int) as varchar(20)) modulo, cast(cast(ordvisita as int) as varchar(20)) ordvisita, tipmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, case when imppaqte = 0x46 then 'F' when imppaqte = 0x54 then 'T' end imppaqte, cast(coordx as varchar(20)) coordx, cast(coordy as varchar(20)) coordy, flgvtajef, cast(cast(codfvtas as int) as varchar(20)) codfvtas, cast(coddirec as varchar(20)) coddirec FROM mclien4f
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:06:03 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania))+'|'+ltrim(rtrim(sucursal))+'|'+cast(cliente as varchar(20))+'|'+cast(modulo as varchar(20))+'|'+cast(codfvtas as varchar(20))+'|'+cast(coddirec as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(cliente as int) as varchar(20)) cliente, cast(cast(modulo as int) as varchar(20)) modulo, cast(cast(ordvisita as int) as varchar(20)) ordvisita, tipmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, case when imppaqte = 0x46 then 'F' when imppaqte = 0x54 then 'T' end imppaqte, cast(coordx as varchar(20)) coordx, cast(coordy as varchar(20)) coordy, flgvtajef, cast(cast(codfvtas as int) as varchar(20)) codfvtas, cast(coddirec as varchar(20)) coddirec FROM mclien4f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:06:11 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:06:11 - extract.extractors.sql_server_extractor - INFO - Execution time: 7.92s
2025-10-11 12:06:11 - extract.extractors.sql_server_extractor - INFO - Rows returned: 238,373
2025-10-11 12:06:11 - extract.extractors.sql_server_extractor - INFO - Columns: 20
2025-10-11 12:06:11 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 238,373 rows
2025-10-11 12:06:11 - core.orchestrator - INFO - üîç Processing chunk 1 with 238373 rows
2025-10-11 12:06:11 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 238373 rows - process_guid: 8932073e-6083-4da5-8385-a7048da1fb75
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5f31bfe1.parquet","timestamp":"2025-10-11 12:06:12,759-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5f31bfe1.parquet","timestamp":"2025-10-11 12:06:13,181-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:13 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:06:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:13 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:06:13 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:06:13 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:06:13 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_ASIGNACION_MODULO
2025-10-11 12:06:13 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:13 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:06:13 - __main__ - INFO - ================================================================================
2025-10-11 12:06:13 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:06:13 - __main__ - INFO - üÜî Process GUID: 8932073e-6083-4da5-8385-a7048da1fb75
2025-10-11 12:06:13 - __main__ - INFO - üìä Records: 238,373
2025-10-11 12:06:13 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:06:13 - __main__ - INFO - ‚è±Ô∏è Time: 9.66s
2025-10-11 12:06:13 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:06:13 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_CANAL_LOCAL... 
2025-10-11 12:06:14 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:06:14 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:06:14 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:06:14 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:06:14 - __main__ - INFO - üÜî Process GUID generado: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:14 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:14 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:14 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:06:14 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:06:14 - __main__ - INFO - ================================================================================
2025-10-11 12:06:14 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:06:14 - __main__ - INFO - ================================================================================
2025-10-11 12:06:14 - __main__ - INFO - üÜî Process GUID: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:14 - __main__ - INFO - üìä Table: M_CANAL_LOCAL
2025-10-11 12:06:14 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:06:14 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:06:14 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:06:14 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:06:14 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:06:14 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:06:14 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:06:14 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:06:14 - __main__ - INFO - ================================================================================
2025-10-11 12:06:14 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:06:14 - __main__ - INFO - ================================================================================
2025-10-11 12:06:14 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:14 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:06:14 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:06:14 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:06:14 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:06:14 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:06:14 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:06:14 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_CANAL_LOCAL', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:14,663-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:14,663-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:14,905-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:06:14,905-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:14 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:06:14 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:15,182-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:15 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:15 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Table: M_CANAL_LOCAL
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_canal_local'
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Checking source_table: 'mcandist'
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Checking columns: 'compania, canal,replace(replace(descripcion, char(13),''), char(10),'') descripcion, centrocost, estado, tipoprecio, canal_corp'
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:06:15 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:06:15 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_CANAL_LOCAL process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:15 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_CANAL_LOCAL
2025-10-11 12:06:15 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:15 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:06:15 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:06:15 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:06:15 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:06:15 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:06:15 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_CANAL_LOCAL process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:15 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:15,416-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:06:15,487-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:15 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Table: M_CANAL_LOCAL
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:06:15 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 12, Filters: 0
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(canal)) as id, compania, canal, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, centrocost, estado, tipoprecio, canal_corp FROM mcandist
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(canal)) as id, compania, canal, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, centrocost, estado, tipoprecio, canal_corp FROM mcandist
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Rows returned: 78
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Columns: 8
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 78 rows
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç Processing chunk 1 with 78 rows
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 78 rows - process_guid: 7131484f-ca03-4efe-a264-ba059dbee874
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mcandist/year=2025/month=10/day=11/data_thread_0_0_chunk_0_23709b85.parquet","timestamp":"2025-10-11 12:06:15,510-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mcandist/year=2025/month=10/day=11/data_thread_0_0_chunk_0_23709b85.parquet","timestamp":"2025-10-11 12:06:15,556-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:06:15 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:06:15 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_CANAL_LOCAL
2025-10-11 12:06:15 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:15 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:06:15 - __main__ - INFO - ================================================================================
2025-10-11 12:06:15 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:06:15 - __main__ - INFO - üÜî Process GUID: 7131484f-ca03-4efe-a264-ba059dbee874
2025-10-11 12:06:15 - __main__ - INFO - üìä Records: 78
2025-10-11 12:06:15 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:06:15 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:06:15 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:06:15 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_CATEGORIA... 
2025-10-11 12:06:16 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:06:16 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:06:16 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:06:16 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:06:16 - __main__ - INFO - üÜî Process GUID generado: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:17 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:17 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:06:17 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:06:17 - __main__ - INFO - ================================================================================
2025-10-11 12:06:17 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:06:17 - __main__ - INFO - ================================================================================
2025-10-11 12:06:17 - __main__ - INFO - üÜî Process GUID: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - __main__ - INFO - üìä Table: M_CATEGORIA
2025-10-11 12:06:17 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:06:17 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:06:17 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:06:17 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:06:17 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:06:17 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:06:17 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:06:17 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:06:17 - __main__ - INFO - ================================================================================
2025-10-11 12:06:17 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:06:17 - __main__ - INFO - ================================================================================
2025-10-11 12:06:17 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:06:17 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:06:17 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:06:17 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:06:17 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:06:17 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:06:17 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_CATEGORIA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:17,026-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:17,026-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:17,259-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:06:17,259-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:06:17 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:17,540-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:17 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:17 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Table: M_CATEGORIA
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_categoria'
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic5f'
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica5,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp'
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:06:17 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:06:17 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_CATEGORIA process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_CATEGORIA
2025-10-11 12:06:17 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:17 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:06:17 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:06:17 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:06:17 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:06:17 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:06:17 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_CATEGORIA process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:17,759-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 1 objects across 1 pages","timestamp":"2025-10-11 12:06:17,821-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:274","message":"Deleting 1 objects from S3","timestamp":"2025-10-11 12:06:17,821-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:286","message":"Successfully deleted 1 objects","timestamp":"2025-10-11 12:06:17,868-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:17 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Table: M_CATEGORIA
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:06:17 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica5)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica5, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp FROM bartic5f
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica5)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica5, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica5_corp FROM bartic5f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.03s
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Rows returned: 940
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:06:17 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 940 rows
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç Processing chunk 1 with 940 rows
2025-10-11 12:06:17 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 940 rows - process_guid: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic5f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_032e3950.parquet","timestamp":"2025-10-11 12:06:17,915-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic5f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_032e3950.parquet","timestamp":"2025-10-11 12:06:18,165-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:18 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:06:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:18 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:06:18 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:06:18 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:06:18 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_CATEGORIA
2025-10-11 12:06:18 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:18 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:06:18 - __main__ - INFO - ================================================================================
2025-10-11 12:06:18 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:06:18 - __main__ - INFO - üÜî Process GUID: 2cc45dfb-7ccf-4a0f-b436-8de1afe69903
2025-10-11 12:06:18 - __main__ - INFO - üìä Records: 940
2025-10-11 12:06:18 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:06:18 - __main__ - INFO - ‚è±Ô∏è Time: 0.41s
2025-10-11 12:06:18 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:06:18 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_CLIENTE... 
2025-10-11 12:06:19 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:06:19 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:06:19 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:06:19 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:06:19 - __main__ - INFO - üÜî Process GUID generado: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:19 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:19 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:19 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:06:19 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:06:19 - __main__ - INFO - ================================================================================
2025-10-11 12:06:19 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:06:19 - __main__ - INFO - ================================================================================
2025-10-11 12:06:19 - __main__ - INFO - üÜî Process GUID: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:19 - __main__ - INFO - üìä Table: M_TIPO_CLIENTE
2025-10-11 12:06:19 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:06:19 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:06:19 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:06:19 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:06:19 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:06:19 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:06:19 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:06:19 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:06:19 - __main__ - INFO - ================================================================================
2025-10-11 12:06:19 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:06:19 - __main__ - INFO - ================================================================================
2025-10-11 12:06:19 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:19 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:06:19 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:06:19 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:06:19 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:06:19 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:06:19 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:06:19 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_CLIENTE', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:19,488-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:19,488-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:19,725-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:06:19,725-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:19 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:06:19 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:20,025-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:20 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:20 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Table: M_TIPO_CLIENTE
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_cliente'
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Checking source_table: 'mclien7f'
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, cliente, flgcontab, tiprelac, intercom, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod'
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:06:20 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:06:20 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_CLIENTE process_guid: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:20 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_CLIENTE
2025-10-11 12:06:20 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:20 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:06:20 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:06:20 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:06:20 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:06:20 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:06:20 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_CLIENTE process_guid: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:20 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:20,243-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:06:20,322-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:20 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Table: M_TIPO_CLIENTE
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:06:20 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 14, Filters: 0
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(cliente)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cliente, flgcontab, tiprelac, intercom, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mclien7f
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(cliente)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cliente, flgcontab, tiprelac, intercom, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mclien7f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Rows returned: 3
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 3 rows
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç Processing chunk 1 with 3 rows
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 3 rows - process_guid: d5005524-b9fc-45e9-9879-db9737936719
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien7f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d1804f95.parquet","timestamp":"2025-10-11 12:06:20,337-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien7f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d1804f95.parquet","timestamp":"2025-10-11 12:06:20,400-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:06:20 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:06:20 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_CLIENTE
2025-10-11 12:06:20 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:20 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:06:20 - __main__ - INFO - ================================================================================
2025-10-11 12:06:20 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:06:20 - __main__ - INFO - üÜî Process GUID: d5005524-b9fc-45e9-9879-db9737936719
2025-10-11 12:06:20 - __main__ - INFO - üìä Records: 3
2025-10-11 12:06:20 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:06:20 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:06:20 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:06:20 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_CLIENTE... 
2025-10-11 12:06:21 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:06:21 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:06:21 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:06:21 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:06:21 - __main__ - INFO - üÜî Process GUID generado: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:21 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:21 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:21 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:06:21 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:06:21 - __main__ - INFO - ================================================================================
2025-10-11 12:06:21 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:06:21 - __main__ - INFO - ================================================================================
2025-10-11 12:06:21 - __main__ - INFO - üÜî Process GUID: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:21 - __main__ - INFO - üìä Table: M_CLIENTE
2025-10-11 12:06:21 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:06:21 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:06:21 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:06:21 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:06:21 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:06:21 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:06:21 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:06:21 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:06:21 - __main__ - INFO - ================================================================================
2025-10-11 12:06:21 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:06:21 - __main__ - INFO - ================================================================================
2025-10-11 12:06:21 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:21 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:06:21 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:06:21 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:06:21 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:06:21 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:06:21 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:06:21 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_CLIENTE', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:21,812-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:21,812-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:06:22,047-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:06:22,048-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:06:22 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:22,322-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:22 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:06:22 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Table: M_CLIENTE
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_cliente'
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Checking source_table: 'mclien1f'
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(cliente as int) as varchar(20)) cliente,replace(replace(nomcliente, char(13),''), char(10),'') nomcliente,replace(replace(nomclienta, char(13),''), char(10),'') nomclienta, docuidenti, nrodocidec, ruccliente,replace(replace(dirdetclcl, char(13),''), char(10),'') dirdetclcl, zonapost, tlfcliente, faxcliente, gironegoci, apepatpro, apematpro,replace(replace(nompropiet, char(13),''), char(10),'') nompropiet, docuidentp, nrodocidpr, tlfpropiet, tlfcelprop, perscontac, mailcontac, pwebclient, procedcli, articalifi, tipcliente, ocupclient, flggarante, fecpostfac, flgpreenv,cast(cast(vendedor as int) as varchar(20)) vendedor, lincredito, legal, impsallcr, sitcliente, stscliente,cast(cast(listprec as int) as varchar(20)) listprec, flgexisc, flgexigv, flgexim, flgexi4, flgexi5, impfin1, impfin2,rtrim(ltrim(moneda)) moneda, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(sucursal)) sucursal, cajas, botellas, grupo, segmcli, clasifica1, clasifica2, codbon, perfil, canal, inscmunic, inscestadu, unidfiscal, linxfact,cast(cast(codprin as int) as varchar(20)) codprin, regvent,case when reqautdoc = 0x46 then 'F' when reqautdoc = 0x54 then 'T' end reqautdoc, codocasvs, canalvs, girovs, subgirovs,replace(replace(nomcomercial, char(13),''), char(10),'') nomcomercial, ddn, ddi, subunidfiscal, flgreqoc, subregvent, clisucursal, fecinact, motinact, null as cuentaclave, case when flgoportunidad = 0x46 then 'F' when flgoportunidad = 0x54 then 'T' end flgoportunidad, codigo_enlace'
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:06:22 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:06:22 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_CLIENTE process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:22 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_CLIENTE
2025-10-11 12:06:22 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:06:22 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:06:22 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:06:22 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:06:22 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:06:22 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:06:22 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_CLIENTE process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:22 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:06:22,572-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:06:22,650-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:06:22 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Table: M_CLIENTE
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:06:22 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 106, Filters: 0
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:06:22 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(cast(cliente as int) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(cliente as int) as varchar(20)) cliente, replace(replace(nomcliente, char(13), ''), char(10), '') nomcliente, replace(replace(nomclienta, char(13), ''), char(10), '') nomclienta, docuidenti, nrodocidec, ruccliente, replace(replace(dirdetclcl, char(13), ''), char(10), '') dirdetclcl, zonapost, tlfcliente, faxcliente, gironegoci, apepatpro, apematpro, replace(replace(nompropiet, char(13), ''), char(10), '') nompropiet, docuidentp, nrodocidpr, tlfpropiet, tlfcelprop, perscontac, mailcontac, pwebclient, procedcli, articalifi, tipcliente, ocupclient, flggarante, fecpostfac, flgpreenv, cast(cast(vendedor as int) as varchar(20)) vendedor, lincredito, legal, impsallcr, sitcliente, stscliente, cast(cast(listprec as int) as varchar(20)) listprec, flgexisc, flgexigv, flgexim, flgexi4, flgexi5, impfin1, impfin2, rtrim(ltrim(moneda)) moneda, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, cajas, botellas, grupo, segmcli, clasifica1, clasifica2, codbon, perfil, canal, inscmunic, inscestadu, unidfiscal, linxfact, cast(cast(codprin as int) as varchar(20)) codprin, regvent, case when reqautdoc = 0x46 then 'F' when reqautdoc = 0x54 then 'T' end reqautdoc, codocasvs, canalvs, girovs, subgirovs, replace(replace(nomcomercial, char(13), ''), char(10), '') nomcomercial, ddn, ddi, subunidfiscal, flgreqoc, subregvent, clisucursal, fecinact, motinact, null as cuentaclave, case when flgoportunidad = 0x46 then 'F' when flgoportunidad = 0x54 then 'T' end flgoportunidad, codigo_enlace FROM mclien1f
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:06:22 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(cast(cliente as int) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(cliente as int) as varchar(20)) cliente, replace(replace(nomcliente, char(13), ''), char(10), '') nomcliente, replace(replace(nomclienta, char(13), ''), char(10), '') nomclienta, docuidenti, nrodocidec, ruccliente, replace(replace(dirdetclcl, char(13), ''), char(10), '') dirdetclcl, zonapost, tlfcliente, faxcliente, gironegoci, apepatpro, apematpro, replace(replace(nompropiet, char(13), ''), char(10), '') nompropiet, docuidentp, nrodocidpr, tlfpropiet, tlfcelprop, perscontac, mailcontac, pwebclient, procedcli, articalifi, tipcliente, ocupclient, flggarante, fecpostfac, flgpreenv, cast(cast(vendedor as int) as varchar(20)) vendedor, lincredito, legal, impsallcr, sitcliente, stscliente, cast(cast(listprec as int) as varchar(20)) listprec, flgexisc, flgexigv, flgexim, flgexi4, flgexi5, impfin1, impfin2, rtrim(ltrim(moneda)) moneda, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, cajas, botellas, grupo, segmcli, clasifica1, clasifica2, codbon, perfil, canal, inscmunic, inscestadu, unidfiscal, linxfact, cast(cast(codprin as int) as varchar(20)) codprin, regvent, case when reqautdoc = 0x46 then 'F' when reqautdoc = 0x54 then 'T' end reqautdoc, codocasvs, canalvs, girovs, subgirovs, replace(replace(nomcomercial, char(13), ''), char(10), '') nomcomercial, ddn, ddi, subunidfiscal, flgreqoc, subregvent, clisucursal, fecinact, motinact, null as cuentaclave, case when flgoportunidad = 0x46 then 'F' when flgoportunidad = 0x54 then 'T' end flgoportunidad, codigo_enlace FROM mclien1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:30 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:30 - extract.extractors.sql_server_extractor - INFO - Execution time: 67.97s
2025-10-11 12:07:30 - extract.extractors.sql_server_extractor - INFO - Rows returned: 261,020
2025-10-11 12:07:30 - extract.extractors.sql_server_extractor - INFO - Columns: 85
2025-10-11 12:07:30 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 261,020 rows
2025-10-11 12:07:30 - core.orchestrator - INFO - üîç Processing chunk 1 with 261020 rows
2025-10-11 12:07:30 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 261020 rows - process_guid: 77b63b90-500a-4e89-8b04-8226d5c34941
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_28806b73.parquet","timestamp":"2025-10-11 12:07:37,544-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mclien1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_28806b73.parquet","timestamp":"2025-10-11 12:07:38,154-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:38 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:38 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:38 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:38 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:38 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_CLIENTE
2025-10-11 12:07:38 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:38 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:38 - __main__ - INFO - ================================================================================
2025-10-11 12:07:38 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:38 - __main__ - INFO - üÜî Process GUID: 77b63b90-500a-4e89-8b04-8226d5c34941
2025-10-11 12:07:38 - __main__ - INFO - üìä Records: 261,020
2025-10-11 12:07:38 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:38 - __main__ - INFO - ‚è±Ô∏è Time: 76.14s
2025-10-11 12:07:38 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:38 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_COMPANIA... 
2025-10-11 12:07:39 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:39 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:39 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:39 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:39 - __main__ - INFO - üÜî Process GUID generado: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:40 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:40 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:40 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:40 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:40 - __main__ - INFO - ================================================================================
2025-10-11 12:07:40 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:40 - __main__ - INFO - ================================================================================
2025-10-11 12:07:40 - __main__ - INFO - üÜî Process GUID: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:40 - __main__ - INFO - üìä Table: M_COMPANIA
2025-10-11 12:07:40 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:40 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:40 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:40 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:40 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:40 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:40 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:40 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:40 - __main__ - INFO - ================================================================================
2025-10-11 12:07:40 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:40 - __main__ - INFO - ================================================================================
2025-10-11 12:07:40 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:40 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:40 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:40 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:40 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:40 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:40 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:40 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_COMPANIA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:40,198-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:40,198-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:40,437-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:40,438-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:40 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:40,720-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:40 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:40 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Table: M_COMPANIA
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_compania'
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - Checking source_table: 'mcompa1f'
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,replace(replace(nombre, char(13),''), char(10),'') nombre,cast(cast(persona as int) as varchar(20)) persona, tipovia,replace(replace(direccion, char(13),''), char(10),'') direccion,rtrim(ltrim(pais)) pais, departamen, provincia, zonapostal, telefono1, telefono2, telefono3, telefono4, fax, flgtipocia, ruc, nota, regigv, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, abrevbco,case when aprobreq = 0x46 then 'F' when aprobreq = 0x54 then 'T' end aprobreq,case when aproboco = 0x46 then 'F' when aproboco = 0x54 then 'T' end aproboco, ipenlace,case when flgctrfaoc = 0x46 then 'F' when flgctrfaoc = 0x54 then 'T' end flgctrfaoc,case when flgrestart = 0x46 then 'F' when flgrestart = 0x54 then 'T' end flgrestart,case when flgaprogj = 0x46 then 'F' when flgaprogj = 0x54 then 'T' end flgaprogj,cast(cast(cantemple as int) as varchar(20)) cantemple, sucprin, coidioma, intercom, flgbi'
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:40 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:40 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:40 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_COMPANIA process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:40 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_COMPANIA
2025-10-11 12:07:40 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:40 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:40 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:40 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:40 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:40 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:40 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_COMPANIA process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:40 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:40,949-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:41,014-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:41 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - Table: M_COMPANIA
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:41 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 48, Filters: 0
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, replace(replace(nombre, char(13), ''), char(10), '') nombre, cast(cast(persona as int) as varchar(20)) persona, tipovia, replace(replace(direccion, char(13), ''), char(10), '') direccion, rtrim(ltrim(pais)) pais, departamen, provincia, zonapostal, telefono1, telefono2, telefono3, telefono4, fax, flgtipocia, ruc, nota, regigv, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, abrevbco, case when aprobreq = 0x46 then 'F' when aprobreq = 0x54 then 'T' end aprobreq, case when aproboco = 0x46 then 'F' when aproboco = 0x54 then 'T' end aproboco, ipenlace, case when flgctrfaoc = 0x46 then 'F' when flgctrfaoc = 0x54 then 'T' end flgctrfaoc, case when flgrestart = 0x46 then 'F' when flgrestart = 0x54 then 'T' end flgrestart, case when flgaprogj = 0x46 then 'F' when flgaprogj = 0x54 then 'T' end flgaprogj, cast(cast(cantemple as int) as varchar(20)) cantemple, sucprin, coidioma, intercom, flgbi FROM mcompa1f
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, replace(replace(nombre, char(13), ''), char(10), '') nombre, cast(cast(persona as int) as varchar(20)) persona, tipovia, replace(replace(direccion, char(13), ''), char(10), '') direccion, rtrim(ltrim(pais)) pais, departamen, provincia, zonapostal, telefono1, telefono2, telefono3, telefono4, fax, flgtipocia, ruc, nota, regigv, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, abrevbco, case when aprobreq = 0x46 then 'F' when aprobreq = 0x54 then 'T' end aprobreq, case when aproboco = 0x46 then 'F' when aproboco = 0x54 then 'T' end aproboco, ipenlace, case when flgctrfaoc = 0x46 then 'F' when flgctrfaoc = 0x54 then 'T' end flgctrfaoc, case when flgrestart = 0x46 then 'F' when flgrestart = 0x54 then 'T' end flgrestart, case when flgaprogj = 0x46 then 'F' when flgaprogj = 0x54 then 'T' end flgaprogj, cast(cast(cantemple as int) as varchar(20)) cantemple, sucprin, coidioma, intercom, flgbi FROM mcompa1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Rows returned: 13
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Columns: 39
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 13 rows
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç Processing chunk 1 with 13 rows
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 13 rows - process_guid: 5b373efc-4b58-414a-a6a5-bde89a72e13e
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mcompa1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_05999c27.parquet","timestamp":"2025-10-11 12:07:41,040-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mcompa1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_05999c27.parquet","timestamp":"2025-10-11 12:07:41,105-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:41 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:41 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_COMPANIA
2025-10-11 12:07:41 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:41 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:41 - __main__ - INFO - ================================================================================
2025-10-11 12:07:41 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:41 - __main__ - INFO - üÜî Process GUID: 5b373efc-4b58-414a-a6a5-bde89a72e13e
2025-10-11 12:07:41 - __main__ - INFO - üìä Records: 13
2025-10-11 12:07:41 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:41 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:07:41 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:41 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_DIVISION... 
2025-10-11 12:07:42 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:42 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:42 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:42 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:42 - __main__ - INFO - üÜî Process GUID generado: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:42 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:42 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:42 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:42 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:42 - __main__ - INFO - ================================================================================
2025-10-11 12:07:42 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:42 - __main__ - INFO - ================================================================================
2025-10-11 12:07:42 - __main__ - INFO - üÜî Process GUID: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:42 - __main__ - INFO - üìä Table: M_DIVISION
2025-10-11 12:07:42 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:42 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:42 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:42 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:42 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:42 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:42 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:42 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:42 - __main__ - INFO - ================================================================================
2025-10-11 12:07:42 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:42 - __main__ - INFO - ================================================================================
2025-10-11 12:07:42 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:42 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:42 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:42 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:42 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:42 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:42 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:42 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_DIVISION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:42,466-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:42,466-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:42,706-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:42,706-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:42 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:42,981-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:42 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:42 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Table: M_DIVISION
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_division'
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - Checking source_table: 'mestdi1f'
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(discendist as int) as varchar(20)) discendist,replace(replace(desccentdi, char(13),''), char(10),'') desccentdi,cast(cast(jefevta as int) as varchar(20)) jefevta,cast(cast(qclicdis as int) as varchar(20)) qclicdis, stscendist, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod'
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:42 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:42 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:42 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_DIVISION process_guid: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:42 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_DIVISION
2025-10-11 12:07:43 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:43 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:43 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:43 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:43 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:43 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:43 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_DIVISION process_guid: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:43 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:43,216-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:43,278-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:43 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - Table: M_DIVISION
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:43 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 19, Filters: 0
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(discendist as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(discendist as int) as varchar(20)) discendist, replace(replace(desccentdi, char(13), ''), char(10), '') desccentdi, cast(cast(jefevta as int) as varchar(20)) jefevta, cast(cast(qclicdis as int) as varchar(20)) qclicdis, stscendist, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM mestdi1f
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(discendist as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(discendist as int) as varchar(20)) discendist, replace(replace(desccentdi, char(13), ''), char(10), '') desccentdi, cast(cast(jefevta as int) as varchar(20)) jefevta, cast(cast(qclicdis as int) as varchar(20)) qclicdis, stscendist, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM mestdi1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Rows returned: 20
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Columns: 14
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 20 rows
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç Processing chunk 1 with 20 rows
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 20 rows - process_guid: fef2a267-4315-46f0-9847-97183224d606
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0c2e70a3.parquet","timestamp":"2025-10-11 12:07:43,309-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0c2e70a3.parquet","timestamp":"2025-10-11 12:07:43,403-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:43 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:43 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_DIVISION
2025-10-11 12:07:43 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:43 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:43 - __main__ - INFO - ================================================================================
2025-10-11 12:07:43 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:43 - __main__ - INFO - üÜî Process GUID: fef2a267-4315-46f0-9847-97183224d606
2025-10-11 12:07:43 - __main__ - INFO - üìä Records: 20
2025-10-11 12:07:43 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:43 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:07:43 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:43 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_DOCUMENTO_ALMACEN... 
2025-10-11 12:07:44 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:44 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:44 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:44 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:44 - __main__ - INFO - üÜî Process GUID generado: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:44 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:44 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:44 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:44 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:44 - __main__ - INFO - ================================================================================
2025-10-11 12:07:44 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:44 - __main__ - INFO - ================================================================================
2025-10-11 12:07:44 - __main__ - INFO - üÜî Process GUID: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:44 - __main__ - INFO - üìä Table: M_DOCUMENTO_ALMACEN
2025-10-11 12:07:44 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:44 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:44 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:44 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:44 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:44 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:44 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:44 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:44 - __main__ - INFO - ================================================================================
2025-10-11 12:07:44 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:44 - __main__ - INFO - ================================================================================
2025-10-11 12:07:44 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:44 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:44 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:44 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:44 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:44 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:44 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:44 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_DOCUMENTO_ALMACEN', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:44,748-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:44,748-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:44,987-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:44,987-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:44 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:45 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:45,277-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:45 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:45 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Table: M_DOCUMENTO_ALMACEN
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_documento_almacen'
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Checking source_table: 'bcnfin1'
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, transaccio,replace(replace(desctran, char(13),''), char(10),'') desctran, tipdoc, nrodocsol, opstkorig, opstkdest,case when ropstorgs = 0x46 then 'F' when ropstorgs = 0x54 then 'T' end ropstorgs,case when flgacosto = 0x46 then 'F' when flgacosto = 0x54 then 'T' end flgacosto,case when flgaorig = 0x46 then 'F' when flgaorig = 0x54 then 'T' end flgaorig,case when flgadest = 0x46 then 'F' when flgadest = 0x54 then 'T' end flgadest,case when flgacompor = 0x46 then 'F' when flgacompor = 0x54 then 'T' end flgacompor,case when flgacompde = 0x46 then 'F' when flgacompde = 0x54 then 'T' end flgacompde,case when crealote = 0x46 then 'F' when crealote = 0x54 then 'T' end crealote,case when descomprom = 0x46 then 'F' when descomprom = 0x54 then 'T' end descomprom,case when flgtransp = 0x46 then 'F' when flgtransp = 0x54 then 'T' end flgtransp,case when flgsdoneg = 0x46 then 'F' when flgsdoneg = 0x54 then 'T' end flgsdoneg,case when flgtranenv = 0x46 then 'F' when flgtranenv = 0x54 then 'T' end flgtranenv,case when flgtrandev = 0x46 then 'F' when flgtrandev = 0x54 then 'T' end flgtrandev,case when flgingdev = 0x46 then 'F' when flgingdev = 0x54 then 'T' end flgingdev, secubirep, secubirmv, feccrea, horcrea, usucrea, fecultimod, horultimod, usuultimod, transcomp,case when anular = 0x46 then 'F' when anular = 0x54 then 'T' end anular, ubirmvdet, tipperso, entradetalle,case when manltevenc = 0x46 then 'F' when manltevenc = 0x54 then 'T' end manltevenc,case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo,case when manejamotivo = 0x46 then 'F' when manejamotivo = 0x54 then 'T' end manejamotivo,case when flgcostesti = 0x46 then 'F' when flgcostesti = 0x54 then 'T' end flgcostesti,case when chktransf = 0x46 then 'F' when chktransf = 0x54 then 'T' end chktransf,cast(cast(ordkx as int) as varchar(20)) ordkx, modulo, gptransvt, estado,case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer,case when flgrefer2 = 0x46 then 'F' when flgrefer2 = 0x54 then 'T' end flgrefer2,case when flgdes = 0x46 then 'F' when flgdes = 0x54 then 'T' end flgdes, tipoperacion'
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:45 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:45 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_DOCUMENTO_ALMACEN process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:45 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_DOCUMENTO_ALMACEN
2025-10-11 12:07:45 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:45 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:45 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:45 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:45 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:45 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:45 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_DOCUMENTO_ALMACEN process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:45 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:45,514-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:45,586-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:45 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Table: M_DOCUMENTO_ALMACEN
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:45 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 53, Filters: 0
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, transaccio, replace(replace(desctran, char(13), ''), char(10), '') desctran, tipdoc, nrodocsol, opstkorig, opstkdest, case when ropstorgs = 0x46 then 'F' when ropstorgs = 0x54 then 'T' end ropstorgs, case when flgacosto = 0x46 then 'F' when flgacosto = 0x54 then 'T' end flgacosto, case when flgaorig = 0x46 then 'F' when flgaorig = 0x54 then 'T' end flgaorig, case when flgadest = 0x46 then 'F' when flgadest = 0x54 then 'T' end flgadest, case when flgacompor = 0x46 then 'F' when flgacompor = 0x54 then 'T' end flgacompor, case when flgacompde = 0x46 then 'F' when flgacompde = 0x54 then 'T' end flgacompde, case when crealote = 0x46 then 'F' when crealote = 0x54 then 'T' end crealote, case when descomprom = 0x46 then 'F' when descomprom = 0x54 then 'T' end descomprom, case when flgtransp = 0x46 then 'F' when flgtransp = 0x54 then 'T' end flgtransp, case when flgsdoneg = 0x46 then 'F' when flgsdoneg = 0x54 then 'T' end flgsdoneg, case when flgtranenv = 0x46 then 'F' when flgtranenv = 0x54 then 'T' end flgtranenv, case when flgtrandev = 0x46 then 'F' when flgtrandev = 0x54 then 'T' end flgtrandev, case when flgingdev = 0x46 then 'F' when flgingdev = 0x54 then 'T' end flgingdev, secubirep, secubirmv, feccrea, horcrea, usucrea, fecultimod, horultimod, usuultimod, transcomp, case when anular = 0x46 then 'F' when anular = 0x54 then 'T' end anular, ubirmvdet, tipperso, entradetalle, case when manltevenc = 0x46 then 'F' when manltevenc = 0x54 then 'T' end manltevenc, case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo, case when manejamotivo = 0x46 then 'F' when manejamotivo = 0x54 then 'T' end manejamotivo, case when flgcostesti = 0x46 then 'F' when flgcostesti = 0x54 then 'T' end flgcostesti, case when chktransf = 0x46 then 'F' when chktransf = 0x54 then 'T' end chktransf, cast(cast(ordkx as int) as varchar(20)) ordkx, modulo, gptransvt, estado, case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer, case when flgrefer2 = 0x46 then 'F' when flgrefer2 = 0x54 then 'T' end flgrefer2, case when flgdes = 0x46 then 'F' when flgdes = 0x54 then 'T' end flgdes, tipoperacion FROM bcnfin1
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, transaccio, replace(replace(desctran, char(13), ''), char(10), '') desctran, tipdoc, nrodocsol, opstkorig, opstkdest, case when ropstorgs = 0x46 then 'F' when ropstorgs = 0x54 then 'T' end ropstorgs, case when flgacosto = 0x46 then 'F' when flgacosto = 0x54 then 'T' end flgacosto, case when flgaorig = 0x46 then 'F' when flgaorig = 0x54 then 'T' end flgaorig, case when flgadest = 0x46 then 'F' when flgadest = 0x54 then 'T' end flgadest, case when flgacompor = 0x46 then 'F' when flgacompor = 0x54 then 'T' end flgacompor, case when flgacompde = 0x46 then 'F' when flgacompde = 0x54 then 'T' end flgacompde, case when crealote = 0x46 then 'F' when crealote = 0x54 then 'T' end crealote, case when descomprom = 0x46 then 'F' when descomprom = 0x54 then 'T' end descomprom, case when flgtransp = 0x46 then 'F' when flgtransp = 0x54 then 'T' end flgtransp, case when flgsdoneg = 0x46 then 'F' when flgsdoneg = 0x54 then 'T' end flgsdoneg, case when flgtranenv = 0x46 then 'F' when flgtranenv = 0x54 then 'T' end flgtranenv, case when flgtrandev = 0x46 then 'F' when flgtrandev = 0x54 then 'T' end flgtrandev, case when flgingdev = 0x46 then 'F' when flgingdev = 0x54 then 'T' end flgingdev, secubirep, secubirmv, feccrea, horcrea, usucrea, fecultimod, horultimod, usuultimod, transcomp, case when anular = 0x46 then 'F' when anular = 0x54 then 'T' end anular, ubirmvdet, tipperso, entradetalle, case when manltevenc = 0x46 then 'F' when manltevenc = 0x54 then 'T' end manltevenc, case when manejacorreo = 0x46 then 'F' when manejacorreo = 0x54 then 'T' end manejacorreo, case when manejamotivo = 0x46 then 'F' when manejamotivo = 0x54 then 'T' end manejamotivo, case when flgcostesti = 0x46 then 'F' when flgcostesti = 0x54 then 'T' end flgcostesti, case when chktransf = 0x46 then 'F' when chktransf = 0x54 then 'T' end chktransf, cast(cast(ordkx as int) as varchar(20)) ordkx, modulo, gptransvt, estado, case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer, case when flgrefer2 = 0x46 then 'F' when flgrefer2 = 0x54 then 'T' end flgrefer2, case when flgdes = 0x46 then 'F' when flgdes = 0x54 then 'T' end flgdes, tipoperacion FROM bcnfin1
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.09s
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,469
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Columns: 48
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,469 rows
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç Processing chunk 1 with 1469 rows
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1469 rows - process_guid: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bcnfin1/year=2025/month=10/day=11/data_thread_0_0_chunk_0_52b093e8.parquet","timestamp":"2025-10-11 12:07:45,715-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bcnfin1/year=2025/month=10/day=11/data_thread_0_0_chunk_0_52b093e8.parquet","timestamp":"2025-10-11 12:07:45,777-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:45 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:45 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_DOCUMENTO_ALMACEN
2025-10-11 12:07:45 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:45 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:45 - __main__ - INFO - ================================================================================
2025-10-11 12:07:45 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:45 - __main__ - INFO - üÜî Process GUID: 2106b7f0-a2ea-418b-acd0-2ebf81d7c213
2025-10-11 12:07:45 - __main__ - INFO - üìä Records: 1,469
2025-10-11 12:07:45 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:45 - __main__ - INFO - ‚è±Ô∏è Time: 0.26s
2025-10-11 12:07:45 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:45 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_DOCUMENTO_TRANSACCION... 
2025-10-11 12:07:46 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:46 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:46 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:46 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:46 - __main__ - INFO - üÜî Process GUID generado: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:47 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:47 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:47 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:47 - __main__ - INFO - ================================================================================
2025-10-11 12:07:47 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:47 - __main__ - INFO - ================================================================================
2025-10-11 12:07:47 - __main__ - INFO - üÜî Process GUID: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - __main__ - INFO - üìä Table: M_DOCUMENTO_TRANSACCION
2025-10-11 12:07:47 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:47 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:47 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:47 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:47 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:47 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:47 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:47 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:47 - __main__ - INFO - ================================================================================
2025-10-11 12:07:47 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:47 - __main__ - INFO - ================================================================================
2025-10-11 12:07:47 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:47 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:47 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:47 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:47 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:47 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:47 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_DOCUMENTO_TRANSACCION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:47,132-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:47,132-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:47,341-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:47,341-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:47 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:47,606-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:47 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:47 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Table: M_DOCUMENTO_TRANSACCION
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_documento_transaccion'
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Checking source_table: 'mdocum1f'
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, transaccio,replace(replace(descrip, char(13),''), char(10),'') descrip, tipodoc, flgentsal, codsunat, tipotransa,cast(cast(astocontab as int) as varchar(20)) astocontab, idinterno,case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, flgtc, ideimport, abreviado,case when flg16digit = 0x46 then 'F' when flg16digit = 0x54 then 'T' end flg16digit, tipopasivo, regigvtip,case when ctbtrans = 0x46 then 'F' when ctbtrans = 0x54 then 'T' end ctbtrans, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,cast(cast(ndigcom as int) as varchar(20)) ndigcom, genperdet,case when retfuefac = 0x46 then 'F' when retfuefac = 0x54 then 'T' end retfuefac,case when retfuepag = 0x46 then 'F' when retfuepag = 0x54 then 'T' end retfuepag,case when retrenfac = 0x46 then 'F' when retrenfac = 0x54 then 'T' end retrenfac,case when retrenpag = 0x46 then 'F' when retrenpag = 0x54 then 'T' end retrenpag,case when flgocomp = 0x46 then 'F' when flgocomp = 0x54 then 'T' end flgocomp, operacion,case when genrenta = 0x46 then 'F' when genrenta = 0x54 then 'T' end genrenta,case when flgdevolu = 0x46 then 'F' when flgdevolu = 0x54 then 'T' end flgdevolu, flgtiproc, tipalmmens, flgcalneto,case when flgpgv = 0x46 then 'F' when flgpgv = 0x54 then 'T' end flgpgv, tranaju,case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto, flgoblfle,case when flgobserie = 0x46 then 'F' when flgobserie = 0x54 then 'T' end flgobserie, flgcalfecha'
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:47 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:47 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_DOCUMENTO_TRANSACCION process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_DOCUMENTO_TRANSACCION
2025-10-11 12:07:47 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:47 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:47 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:47 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:47 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:47 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:47 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_DOCUMENTO_TRANSACCION process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:47,841-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:47,903-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:47 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Table: M_DOCUMENTO_TRANSACCION
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:47 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 50, Filters: 0
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:47 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, transaccio, replace(replace(descrip, char(13), ''), char(10), '') descrip, tipodoc, flgentsal, codsunat, tipotransa, cast(cast(astocontab as int) as varchar(20)) astocontab, idinterno, case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, flgtc, ideimport, abreviado, case when flg16digit = 0x46 then 'F' when flg16digit = 0x54 then 'T' end flg16digit, tipopasivo, regigvtip, case when ctbtrans = 0x46 then 'F' when ctbtrans = 0x54 then 'T' end ctbtrans, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, cast(cast(ndigcom as int) as varchar(20)) ndigcom, genperdet, case when retfuefac = 0x46 then 'F' when retfuefac = 0x54 then 'T' end retfuefac, case when retfuepag = 0x46 then 'F' when retfuepag = 0x54 then 'T' end retfuepag, case when retrenfac = 0x46 then 'F' when retrenfac = 0x54 then 'T' end retrenfac, case when retrenpag = 0x46 then 'F' when retrenpag = 0x54 then 'T' end retrenpag, case when flgocomp = 0x46 then 'F' when flgocomp = 0x54 then 'T' end flgocomp, operacion, case when genrenta = 0x46 then 'F' when genrenta = 0x54 then 'T' end genrenta, case when flgdevolu = 0x46 then 'F' when flgdevolu = 0x54 then 'T' end flgdevolu, flgtiproc, tipalmmens, flgcalneto, case when flgpgv = 0x46 then 'F' when flgpgv = 0x54 then 'T' end flgpgv, tranaju, case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto, flgoblfle, case when flgobserie = 0x46 then 'F' when flgobserie = 0x54 then 'T' end flgobserie, flgcalfecha FROM mdocum1f
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:47 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, transaccio, replace(replace(descrip, char(13), ''), char(10), '') descrip, tipodoc, flgentsal, codsunat, tipotransa, cast(cast(astocontab as int) as varchar(20)) astocontab, idinterno, case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, flgtc, ideimport, abreviado, case when flg16digit = 0x46 then 'F' when flg16digit = 0x54 then 'T' end flg16digit, tipopasivo, regigvtip, case when ctbtrans = 0x46 then 'F' when ctbtrans = 0x54 then 'T' end ctbtrans, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, cast(cast(ndigcom as int) as varchar(20)) ndigcom, genperdet, case when retfuefac = 0x46 then 'F' when retfuefac = 0x54 then 'T' end retfuefac, case when retfuepag = 0x46 then 'F' when retfuepag = 0x54 then 'T' end retfuepag, case when retrenfac = 0x46 then 'F' when retrenfac = 0x54 then 'T' end retrenfac, case when retrenpag = 0x46 then 'F' when retrenpag = 0x54 then 'T' end retrenpag, case when flgocomp = 0x46 then 'F' when flgocomp = 0x54 then 'T' end flgocomp, operacion, case when genrenta = 0x46 then 'F' when genrenta = 0x54 then 'T' end genrenta, case when flgdevolu = 0x46 then 'F' when flgdevolu = 0x54 then 'T' end flgdevolu, flgtiproc, tipalmmens, flgcalneto, case when flgpgv = 0x46 then 'F' when flgpgv = 0x54 then 'T' end flgpgv, tranaju, case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto, flgoblfle, case when flgobserie = 0x46 then 'F' when flgobserie = 0x54 then 'T' end flgobserie, flgcalfecha FROM mdocum1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.17s
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - Rows returned: 4,017
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - Columns: 45
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 4,017 rows
2025-10-11 12:07:48 - core.orchestrator - INFO - üîç Processing chunk 1 with 4017 rows
2025-10-11 12:07:48 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 4017 rows - process_guid: 1642fa11-09a0-429f-bc91-4d6b72d87768
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e3f3f2c6.parquet","timestamp":"2025-10-11 12:07:48,107-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e3f3f2c6.parquet","timestamp":"2025-10-11 12:07:48,200-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:48 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:48 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:48 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:48 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_DOCUMENTO_TRANSACCION
2025-10-11 12:07:48 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:48 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:48 - __main__ - INFO - ================================================================================
2025-10-11 12:07:48 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:48 - __main__ - INFO - üÜî Process GUID: 1642fa11-09a0-429f-bc91-4d6b72d87768
2025-10-11 12:07:48 - __main__ - INFO - üìä Records: 4,017
2025-10-11 12:07:48 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:48 - __main__ - INFO - ‚è±Ô∏è Time: 0.36s
2025-10-11 12:07:48 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:48 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_FAMILIA... 
2025-10-11 12:07:49 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:49 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:49 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:49 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:49 - __main__ - INFO - üÜî Process GUID generado: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:49 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:49 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:49 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:49 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:49 - __main__ - INFO - ================================================================================
2025-10-11 12:07:49 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:49 - __main__ - INFO - ================================================================================
2025-10-11 12:07:49 - __main__ - INFO - üÜî Process GUID: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:49 - __main__ - INFO - üìä Table: M_FAMILIA
2025-10-11 12:07:49 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:49 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:49 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:49 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:49 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:49 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:49 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:49 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:49 - __main__ - INFO - ================================================================================
2025-10-11 12:07:49 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:49 - __main__ - INFO - ================================================================================
2025-10-11 12:07:49 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:49 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:49 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:49 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:49 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:49 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:49 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:49 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_FAMILIA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:49,518-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:49,518-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:49,753-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:49,754-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:49 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:50,013-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:50 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:50 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Table: M_FAMILIA
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_familia'
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Checking source_table: 'mfamil1f'
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, linea, familia,replace(replace(descrip, char(13),''), char(10),'') descrip,replace(replace(descripcor, char(13),''), char(10),'') descripcor, centrocost, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, parancel,case when flgflete = 0x46 then 'F' when flgflete = 0x54 then 'T' end flgflete, familia_corp, categoria, flgcatfiscal'
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:50 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:50 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_FAMILIA process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:50 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_FAMILIA
2025-10-11 12:07:50 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:50 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:50 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:50 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:50 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:50 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:50 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_FAMILIA process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:50 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:50,247-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:50,325-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:50 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Table: M_FAMILIA
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:50 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 29, Filters: 0
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) + '|' + rtrim(ltrim(familia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, familia, replace(replace(descrip, char(13), ''), char(10), '') descrip, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, centrocost, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, parancel, case when flgflete = 0x46 then 'F' when flgflete = 0x54 then 'T' end flgflete, familia_corp, categoria, flgcatfiscal FROM mfamil1f
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) + '|' + rtrim(ltrim(familia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, familia, replace(replace(descrip, char(13), ''), char(10), '') descrip, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, centrocost, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, parancel, case when flgflete = 0x46 then 'F' when flgflete = 0x54 then 'T' end flgflete, familia_corp, categoria, flgcatfiscal FROM mfamil1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.06s
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,213
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Columns: 20
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,213 rows
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç Processing chunk 1 with 1213 rows
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1213 rows - process_guid: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mfamil1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_bfb312c6.parquet","timestamp":"2025-10-11 12:07:50,403-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mfamil1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_bfb312c6.parquet","timestamp":"2025-10-11 12:07:50,497-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:50 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:50 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_FAMILIA
2025-10-11 12:07:50 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:50 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:50 - __main__ - INFO - ================================================================================
2025-10-11 12:07:50 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:50 - __main__ - INFO - üÜî Process GUID: 374e8d2f-2f6d-46ce-9ca7-86feb0c93fbb
2025-10-11 12:07:50 - __main__ - INFO - üìä Records: 1,213
2025-10-11 12:07:50 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:50 - __main__ - INFO - ‚è±Ô∏è Time: 0.25s
2025-10-11 12:07:50 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:50 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_FORMA_PAGO... 
2025-10-11 12:07:51 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:51 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:51 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:51 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:51 - __main__ - INFO - üÜî Process GUID generado: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:51 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:51 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:51 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:51 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:51 - __main__ - INFO - ================================================================================
2025-10-11 12:07:51 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:51 - __main__ - INFO - ================================================================================
2025-10-11 12:07:51 - __main__ - INFO - üÜî Process GUID: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:51 - __main__ - INFO - üìä Table: M_FORMA_PAGO
2025-10-11 12:07:51 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:51 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:51 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:51 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:51 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:51 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:51 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:51 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:51 - __main__ - INFO - ================================================================================
2025-10-11 12:07:51 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:51 - __main__ - INFO - ================================================================================
2025-10-11 12:07:51 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:51 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:51 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:51 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:51 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:51 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:51 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:51 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_FORMA_PAGO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:51,819-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:51,819-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:52,056-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:52,056-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:52 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:52,325-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:52 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:52 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Table: M_FORMA_PAGO
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_forma_pago'
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Checking source_table: 'tcpago1f'
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, condpago,case when stscomerci = 0x46 then 'F' when stscomerci = 0x54 then 'T' end stscomerci,replace(replace(descriplar, char(13),''), char(10),'') descriplar,replace(replace(descripcor, char(13),''), char(10),'') descripcor, porcadela, tiempo, nivelpeso, tipoprecio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codequiv'
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:52 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:52 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_FORMA_PAGO process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:52 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_FORMA_PAGO
2025-10-11 12:07:52 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:52 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:52 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:52 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:52 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:52 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:52 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_FORMA_PAGO process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:52 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:52,559-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:52,637-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:52 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Table: M_FORMA_PAGO
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:52 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 28, Filters: 0
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(condpago)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, condpago, case when stscomerci = 0x46 then 'F' when stscomerci = 0x54 then 'T' end stscomerci, replace(replace(descriplar, char(13), ''), char(10), '') descriplar, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, porcadela, tiempo, nivelpeso, tipoprecio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codequiv FROM tcpago1f
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(condpago)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, condpago, case when stscomerci = 0x46 then 'F' when stscomerci = 0x54 then 'T' end stscomerci, replace(replace(descriplar, char(13), ''), char(10), '') descriplar, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, porcadela, tiempo, nivelpeso, tipoprecio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, codequiv FROM tcpago1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.05s
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Rows returned: 643
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Columns: 19
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 643 rows
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç Processing chunk 1 with 643 rows
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 643 rows - process_guid: bb4dc49b-6ffe-4ce0-8060-735e722317bc
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcpago1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_1a4405e0.parquet","timestamp":"2025-10-11 12:07:52,684-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcpago1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_1a4405e0.parquet","timestamp":"2025-10-11 12:07:52,778-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:52 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:52 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_FORMA_PAGO
2025-10-11 12:07:52 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:52 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:52 - __main__ - INFO - ================================================================================
2025-10-11 12:07:52 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:52 - __main__ - INFO - üÜî Process GUID: bb4dc49b-6ffe-4ce0-8060-735e722317bc
2025-10-11 12:07:52 - __main__ - INFO - üìä Records: 643
2025-10-11 12:07:52 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:52 - __main__ - INFO - ‚è±Ô∏è Time: 0.22s
2025-10-11 12:07:52 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:52 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_FORMATO... 
2025-10-11 12:07:53 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:53 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:53 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:53 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:53 - __main__ - INFO - üÜî Process GUID generado: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:54 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:54 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:54 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:54 - __main__ - INFO - ================================================================================
2025-10-11 12:07:54 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:54 - __main__ - INFO - ================================================================================
2025-10-11 12:07:54 - __main__ - INFO - üÜî Process GUID: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - __main__ - INFO - üìä Table: M_FORMATO
2025-10-11 12:07:54 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:54 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:54 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:54 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:54 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:54 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:54 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:54 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:54 - __main__ - INFO - ================================================================================
2025-10-11 12:07:54 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:54 - __main__ - INFO - ================================================================================
2025-10-11 12:07:54 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:54 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:54 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:54 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:54 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:54 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:54 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_FORMATO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:54,141-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:54,141-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:54,393-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:54,394-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:54 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:54,684-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:54 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:54 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Table: M_FORMATO
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_formato'
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic3f'
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica3,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica3_corp'
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:54 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:54 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_FORMATO process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_FORMATO
2025-10-11 12:07:54 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:54 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:54 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:54 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:54 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:54 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:54 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_FORMATO process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:54,918-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:54,981-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:54 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Table: M_FORMATO
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:54 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:54 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica3)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica3, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica3_corp FROM bartic3f
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:54 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica3)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica3, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica3_corp FROM bartic3f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.23s
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - Rows returned: 7,607
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 7,607 rows
2025-10-11 12:07:55 - core.orchestrator - INFO - üîç Processing chunk 1 with 7607 rows
2025-10-11 12:07:55 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 7607 rows - process_guid: 40da2527-658c-4f42-8e00-ae8720b2df5f
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5dd4cf67.parquet","timestamp":"2025-10-11 12:07:55,262-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5dd4cf67.parquet","timestamp":"2025-10-11 12:07:55,372-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:55 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:55 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:55 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:55 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_FORMATO
2025-10-11 12:07:55 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:55 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:55 - __main__ - INFO - ================================================================================
2025-10-11 12:07:55 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:55 - __main__ - INFO - üÜî Process GUID: 40da2527-658c-4f42-8e00-ae8720b2df5f
2025-10-11 12:07:55 - __main__ - INFO - üìä Records: 7,607
2025-10-11 12:07:55 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:55 - __main__ - INFO - ‚è±Ô∏è Time: 0.45s
2025-10-11 12:07:55 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:55 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_FUERZA_VENTA... 
2025-10-11 12:07:56 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:56 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:56 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:56 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:56 - __main__ - INFO - üÜî Process GUID generado: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:56 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:56 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:56 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:56 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:56 - __main__ - INFO - ================================================================================
2025-10-11 12:07:56 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:56 - __main__ - INFO - ================================================================================
2025-10-11 12:07:56 - __main__ - INFO - üÜî Process GUID: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:56 - __main__ - INFO - üìä Table: M_FUERZA_VENTA
2025-10-11 12:07:56 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:56 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:56 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:56 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:56 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:56 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:56 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:56 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:56 - __main__ - INFO - ================================================================================
2025-10-11 12:07:56 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:56 - __main__ - INFO - ================================================================================
2025-10-11 12:07:56 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:56 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:56 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:56 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:56 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:56 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:56 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:56 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_FUERZA_VENTA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:56,681-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:56,681-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:56,942-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:56,942-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:56 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:56 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:57,232-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:57 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:57 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Table: M_FUERZA_VENTA
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_fuerza_venta'
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Checking source_table: 'view_cas_tfvta1f'
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,cast(cast(codfvtas as int) as varchar(20)) codfvtas,replace(replace(descrip, char(13),''), char(10),'') descrip, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod, estado'
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:57 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:57 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_FUERZA_VENTA process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:57 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_FUERZA_VENTA
2025-10-11 12:07:57 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:57 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:57 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:57 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:57 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:57 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:57 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_FUERZA_VENTA process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:57 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:57,482-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:57,544-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:57 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Table: M_FUERZA_VENTA
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:57 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, cast(cast(codfvtas as int) as varchar(20)) codfvtas, replace(replace(descrip, char(13), ''), char(10), '') descrip, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod, estado FROM view_cas_tfvta1f
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, cast(cast(codfvtas as int) as varchar(20)) codfvtas, replace(replace(descrip, char(13), ''), char(10), '') descrip, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod, estado FROM view_cas_tfvta1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.03s
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Rows returned: 55
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 55 rows
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç Processing chunk 1 with 55 rows
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 55 rows - process_guid: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/view_cas_tfvta1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_db1b73cc.parquet","timestamp":"2025-10-11 12:07:57,575-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/view_cas_tfvta1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_db1b73cc.parquet","timestamp":"2025-10-11 12:07:57,669-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:57 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:57 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_FUERZA_VENTA
2025-10-11 12:07:57 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:57 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:57 - __main__ - INFO - ================================================================================
2025-10-11 12:07:57 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:57 - __main__ - INFO - üÜî Process GUID: 1d0c4893-1a8d-45f5-958b-e0602c6fefef
2025-10-11 12:07:57 - __main__ - INFO - üìä Records: 55
2025-10-11 12:07:57 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:57 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:07:57 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:57 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_GASIFICADO... 
2025-10-11 12:07:58 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:07:58 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:07:58 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:07:58 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:07:58 - __main__ - INFO - üÜî Process GUID generado: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:58 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:58 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:58 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:07:58 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:07:58 - __main__ - INFO - ================================================================================
2025-10-11 12:07:58 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:07:58 - __main__ - INFO - ================================================================================
2025-10-11 12:07:58 - __main__ - INFO - üÜî Process GUID: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:58 - __main__ - INFO - üìä Table: M_GASIFICADO
2025-10-11 12:07:58 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:07:58 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:07:58 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:07:58 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:07:58 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:07:58 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:07:58 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:07:58 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:07:58 - __main__ - INFO - ================================================================================
2025-10-11 12:07:58 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:07:58 - __main__ - INFO - ================================================================================
2025-10-11 12:07:58 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:07:59 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:07:59 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:07:59 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:07:59 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:07:59 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:07:59 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_GASIFICADO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:59,016-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:59,016-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:07:59,254-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:07:59,254-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:07:59 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:59,528-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:59 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:07:59 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Table: M_GASIFICADO
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_gasificado'
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic7f'
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica7,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica7_corp'
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:07:59 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:07:59 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_GASIFICADO process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_GASIFICADO
2025-10-11 12:07:59 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:59 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:07:59 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:07:59 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:07:59 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:07:59 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:07:59 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_GASIFICADO process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:07:59,747-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:07:59,825-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:59 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Table: M_GASIFICADO
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:07:59 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica7)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica7, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica7_corp FROM bartic7f
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica7)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica7, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica7_corp FROM bartic7f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Rows returned: 26
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 26 rows
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç Processing chunk 1 with 26 rows
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 26 rows - process_guid: ce71ada1-225d-480d-bc5b-4aacdb9cee43
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic7f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_f7f0f484.parquet","timestamp":"2025-10-11 12:07:59,841-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic7f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_f7f0f484.parquet","timestamp":"2025-10-11 12:07:59,904-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:07:59 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:07:59 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_GASIFICADO
2025-10-11 12:07:59 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:07:59 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:07:59 - __main__ - INFO - ================================================================================
2025-10-11 12:07:59 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:07:59 - __main__ - INFO - üÜî Process GUID: ce71ada1-225d-480d-bc5b-4aacdb9cee43
2025-10-11 12:07:59 - __main__ - INFO - üìä Records: 26
2025-10-11 12:07:59 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:07:59 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:07:59 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:07:59 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_GIRO_LOCAL... 
2025-10-11 12:08:01 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:01 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:01 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:01 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:01 - __main__ - INFO - üÜî Process GUID generado: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:01 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:01 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:01 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:01 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:01 - __main__ - INFO - ================================================================================
2025-10-11 12:08:01 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:01 - __main__ - INFO - ================================================================================
2025-10-11 12:08:01 - __main__ - INFO - üÜî Process GUID: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:01 - __main__ - INFO - üìä Table: M_GIRO_LOCAL
2025-10-11 12:08:01 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:01 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:01 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:01 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:01 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:01 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:01 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:01 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:01 - __main__ - INFO - ================================================================================
2025-10-11 12:08:01 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:01 - __main__ - INFO - ================================================================================
2025-10-11 12:08:01 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:01 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:01 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:01 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:01 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:01 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:01 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:01 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_GIRO_LOCAL', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:01,297-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:01,297-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:01,591-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:01,591-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:01 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:01 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:01,903-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:01 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:01 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Table: M_GIRO_LOCAL
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_giro_local'
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - Checking source_table: 'bgiro1f'
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, giroempres, girdnom,case when flgagentead = 0x46 then 'F' when flgagentead = 0x54 then 'T' end flgagentead,case when flgciasegu = 0x46 then 'F' when flgciasegu = 0x54 then 'T' end flgciasegu,case when flgnotaria = 0x46 then 'F' when flgnotaria = 0x54 then 'T' end flgnotaria,case when flgbanco = 0x46 then 'F' when flgbanco = 0x54 then 'T' end flgbanco, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, giroequiv, sgiro_corp'
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:01 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:01 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:01 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_GIRO_LOCAL process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:01 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_GIRO_LOCAL
2025-10-11 12:08:02 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:02 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:02 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:02 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:02 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:02 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:02 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_GIRO_LOCAL process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:02 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:02,122-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:02,196-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:02 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - Table: M_GIRO_LOCAL
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:02 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 19, Filters: 0
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(giroempres)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, giroempres, girdnom, case when flgagentead = 0x46 then 'F' when flgagentead = 0x54 then 'T' end flgagentead, case when flgciasegu = 0x46 then 'F' when flgciasegu = 0x54 then 'T' end flgciasegu, case when flgnotaria = 0x46 then 'F' when flgnotaria = 0x54 then 'T' end flgnotaria, case when flgbanco = 0x46 then 'F' when flgbanco = 0x54 then 'T' end flgbanco, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, giroequiv, sgiro_corp FROM bgiro1f
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(giroempres)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, giroempres, girdnom, case when flgagentead = 0x46 then 'F' when flgagentead = 0x54 then 'T' end flgagentead, case when flgciasegu = 0x46 then 'F' when flgciasegu = 0x54 then 'T' end flgciasegu, case when flgnotaria = 0x46 then 'F' when flgnotaria = 0x54 then 'T' end flgnotaria, case when flgbanco = 0x46 then 'F' when flgbanco = 0x54 then 'T' end flgbanco, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, giroequiv, sgiro_corp FROM bgiro1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.03s
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Rows returned: 398
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Columns: 18
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 398 rows
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç Processing chunk 1 with 398 rows
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 398 rows - process_guid: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bgiro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_eaa00302.parquet","timestamp":"2025-10-11 12:08:02,245-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bgiro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_eaa00302.parquet","timestamp":"2025-10-11 12:08:02,306-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:02 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:02 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_GIRO_LOCAL
2025-10-11 12:08:02 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:02 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:02 - __main__ - INFO - ================================================================================
2025-10-11 12:08:02 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:02 - __main__ - INFO - üÜî Process GUID: 16bf443b-59fd-439e-8cc6-7c3a6380fdf0
2025-10-11 12:08:02 - __main__ - INFO - üìä Records: 398
2025-10-11 12:08:02 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:02 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:08:02 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:02 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_LIGHT... 
2025-10-11 12:08:03 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:03 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:03 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:03 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:03 - __main__ - INFO - üÜî Process GUID generado: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:03 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:03 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:03 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:03 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:03 - __main__ - INFO - ================================================================================
2025-10-11 12:08:03 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:03 - __main__ - INFO - ================================================================================
2025-10-11 12:08:03 - __main__ - INFO - üÜî Process GUID: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:03 - __main__ - INFO - üìä Table: M_LIGHT
2025-10-11 12:08:03 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:03 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:03 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:03 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:03 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:03 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:03 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:03 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:03 - __main__ - INFO - ================================================================================
2025-10-11 12:08:03 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:03 - __main__ - INFO - ================================================================================
2025-10-11 12:08:03 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:03 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:03 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:03 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:03 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:03 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:03 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:03 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_LIGHT', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:03,780-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:03,780-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:04,012-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:04,012-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:04 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:04,325-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:04 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:04 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Table: M_LIGHT
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_light'
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic8f'
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica8,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:04 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:04 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_LIGHT process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:04 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_LIGHT
2025-10-11 12:08:04 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:04 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:04 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:04 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:04 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:04 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:04 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_LIGHT process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:04 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:04,606-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:04,684-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:04 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Table: M_LIGHT
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:04 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica8)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica8, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic8f
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica8)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica8, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic8f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Rows returned: 379
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 379 rows
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç Processing chunk 1 with 379 rows
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 379 rows - process_guid: 3d3b39c0-b654-4e0c-896d-8a58b8959275
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_4ee202f5.parquet","timestamp":"2025-10-11 12:08:04,716-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_4ee202f5.parquet","timestamp":"2025-10-11 12:08:04,794-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:04 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:04 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_LIGHT
2025-10-11 12:08:04 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:04 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:04 - __main__ - INFO - ================================================================================
2025-10-11 12:08:04 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:04 - __main__ - INFO - üÜî Process GUID: 3d3b39c0-b654-4e0c-896d-8a58b8959275
2025-10-11 12:08:04 - __main__ - INFO - üìä Records: 379
2025-10-11 12:08:04 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:04 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:08:04 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:04 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_LINEA... 
2025-10-11 12:08:05 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:05 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:05 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:05 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:05 - __main__ - INFO - üÜî Process GUID generado: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:06 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:06 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:06 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:06 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:06 - __main__ - INFO - ================================================================================
2025-10-11 12:08:06 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:06 - __main__ - INFO - ================================================================================
2025-10-11 12:08:06 - __main__ - INFO - üÜî Process GUID: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:06 - __main__ - INFO - üìä Table: M_LINEA
2025-10-11 12:08:06 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:06 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:06 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:06 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:06 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:06 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:06 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:06 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:06 - __main__ - INFO - ================================================================================
2025-10-11 12:08:06 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:06 - __main__ - INFO - ================================================================================
2025-10-11 12:08:06 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:06 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:06 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:06 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:06 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:06 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:06 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:06 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_LINEA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:06,192-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:06,193-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:06,430-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:06,430-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:06 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:06 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:06,716-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:06 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:06 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Table: M_LINEA
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_linea'
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - Checking source_table: 'mlinea1f'
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, linea,replace(replace(descrip, char(13),''), char(10),'') descrip, flglinea, compranac, compraimpo, consnacion, consimport,case when flgctlmejo = 0x46 then 'F' when flgctlmejo = 0x54 then 'T' end flgctlmejo,case when flgbienmat = 0x46 then 'F' when flgbienmat = 0x54 then 'T' end flgbienmat,case when flgoblsfam = 0x46 then 'F' when flgoblsfam = 0x54 then 'T' end flgoblsfam, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,case when flgcostigv = 0x46 then 'F' when flgcostigv = 0x54 then 'T' end flgcostigv,case when flgcreacronograma = 0x46 then 'F' when flgcreacronograma = 0x54 then 'T' end flgcreacronograma,case when encve = 0x46 then 'F' when encve = 0x54 then 'T' end encve, linea_corp, tipmateria, flgcatfiscal, tipocrea, flgaprfor'
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:06 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:06 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:06 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_LINEA process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:06 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_LINEA
2025-10-11 12:08:06 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:06 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:06 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:06 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:06 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:06 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:06 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_LINEA process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:06 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:06,966-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:07,036-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:07 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - Table: M_LINEA
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:07 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 33, Filters: 0
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, replace(replace(descrip, char(13), ''), char(10), '') descrip, flglinea, compranac, compraimpo, consnacion, consimport, case when flgctlmejo = 0x46 then 'F' when flgctlmejo = 0x54 then 'T' end flgctlmejo, case when flgbienmat = 0x46 then 'F' when flgbienmat = 0x54 then 'T' end flgbienmat, case when flgoblsfam = 0x46 then 'F' when flgoblsfam = 0x54 then 'T' end flgoblsfam, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when flgcostigv = 0x46 then 'F' when flgcostigv = 0x54 then 'T' end flgcostigv, case when flgcreacronograma = 0x46 then 'F' when flgcreacronograma = 0x54 then 'T' end flgcreacronograma, case when encve = 0x46 then 'F' when encve = 0x54 then 'T' end encve, linea_corp, tipmateria, flgcatfiscal, tipocrea, flgaprfor FROM mlinea1f
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, replace(replace(descrip, char(13), ''), char(10), '') descrip, flglinea, compranac, compraimpo, consnacion, consimport, case when flgctlmejo = 0x46 then 'F' when flgctlmejo = 0x54 then 'T' end flgctlmejo, case when flgbienmat = 0x46 then 'F' when flgbienmat = 0x54 then 'T' end flgbienmat, case when flgoblsfam = 0x46 then 'F' when flgoblsfam = 0x54 then 'T' end flgoblsfam, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when flgcostigv = 0x46 then 'F' when flgcostigv = 0x54 then 'T' end flgcostigv, case when flgcreacronograma = 0x46 then 'F' when flgcreacronograma = 0x54 then 'T' end flgcreacronograma, case when encve = 0x46 then 'F' when encve = 0x54 then 'T' end encve, linea_corp, tipmateria, flgcatfiscal, tipocrea, flgaprfor FROM mlinea1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Rows returned: 298
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Columns: 28
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 298 rows
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç Processing chunk 1 with 298 rows
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 298 rows - process_guid: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mlinea1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_63099477.parquet","timestamp":"2025-10-11 12:08:07,059-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mlinea1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_63099477.parquet","timestamp":"2025-10-11 12:08:07,138-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:07 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:07 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_LINEA
2025-10-11 12:08:07 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:07 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:07 - __main__ - INFO - ================================================================================
2025-10-11 12:08:07 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:07 - __main__ - INFO - üÜî Process GUID: 3aca1fbd-5c4d-4afc-bf14-c9dda80fa219
2025-10-11 12:08:07 - __main__ - INFO - üìä Records: 298
2025-10-11 12:08:07 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:07 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:08:07 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:07 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_LISTA_PRECIO... 
2025-10-11 12:08:08 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:08 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:08 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:08 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:08 - __main__ - INFO - üÜî Process GUID generado: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:08 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:08 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:08 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:08 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:08 - __main__ - INFO - ================================================================================
2025-10-11 12:08:08 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:08 - __main__ - INFO - ================================================================================
2025-10-11 12:08:08 - __main__ - INFO - üÜî Process GUID: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:08 - __main__ - INFO - üìä Table: M_LISTA_PRECIO
2025-10-11 12:08:08 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:08 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:08 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:08 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:08 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:08 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:08 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:08 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:08 - __main__ - INFO - ================================================================================
2025-10-11 12:08:08 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:08 - __main__ - INFO - ================================================================================
2025-10-11 12:08:08 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:08 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:08 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:08 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:08 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:08 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:08 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:08 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_LISTA_PRECIO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:08,446-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:08,446-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:08,685-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:08,685-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:08 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:08 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:08,950-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:08 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:08 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Table: M_LISTA_PRECIO
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_lista_precio'
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - Checking source_table: 'mlpvta1f'
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(listprec as int) as varchar(20)) listprec,replace(replace(descprecio, char(13),''), char(10),'') descprecio, stslipre,cast(cast(qcliprecio as int) as varchar(20)) qcliprecio, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,cast(cast(priolp as int) as varchar(20)) priolp, maxcjs, mincjs, canal, gneg, grupolist, codunid, fecfinal,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac,case when flglistbase = 0x46 then 'F' when flglistbase = 0x54 then 'T' end flglistbase'
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:08 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:08 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:08 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_LISTA_PRECIO process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:08 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_LISTA_PRECIO
2025-10-11 12:08:09 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:09 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:09 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:09 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:09 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:09 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:09 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_LISTA_PRECIO process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:09 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:09,184-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:09,247-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:09 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - Table: M_LISTA_PRECIO
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:09 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 30, Filters: 0
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(listprec as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(listprec as int) as varchar(20)) listprec, replace(replace(descprecio, char(13), ''), char(10), '') descprecio, stslipre, cast(cast(qcliprecio as int) as varchar(20)) qcliprecio, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cast(cast(priolp as int) as varchar(20)) priolp, maxcjs, mincjs, canal, gneg, grupolist, codunid, fecfinal, cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, case when flglistbase = 0x46 then 'F' when flglistbase = 0x54 then 'T' end flglistbase FROM mlpvta1f
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(listprec as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(listprec as int) as varchar(20)) listprec, replace(replace(descprecio, char(13), ''), char(10), '') descprecio, stslipre, cast(cast(qcliprecio as int) as varchar(20)) qcliprecio, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cast(cast(priolp as int) as varchar(20)) priolp, maxcjs, mincjs, canal, gneg, grupolist, codunid, fecfinal, cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, case when flglistbase = 0x46 then 'F' when flglistbase = 0x54 then 'T' end flglistbase FROM mlpvta1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Rows returned: 129
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Columns: 25
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 129 rows
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç Processing chunk 1 with 129 rows
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 129 rows - process_guid: 93959d67-37fc-4fa1-923e-f6c78607e125
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mlpvta1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8b243f61.parquet","timestamp":"2025-10-11 12:08:09,278-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mlpvta1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8b243f61.parquet","timestamp":"2025-10-11 12:08:09,341-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:09 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:09 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_LISTA_PRECIO
2025-10-11 12:08:09 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:09 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:09 - __main__ - INFO - ================================================================================
2025-10-11 12:08:09 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:09 - __main__ - INFO - üÜî Process GUID: 93959d67-37fc-4fa1-923e-f6c78607e125
2025-10-11 12:08:09 - __main__ - INFO - üìä Records: 129
2025-10-11 12:08:09 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:09 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:08:09 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:09 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_MARCA... 
2025-10-11 12:08:10 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:10 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:10 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:10 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:10 - __main__ - INFO - üÜî Process GUID generado: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:10 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:10 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:10 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:10 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:10 - __main__ - INFO - ================================================================================
2025-10-11 12:08:10 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:10 - __main__ - INFO - ================================================================================
2025-10-11 12:08:10 - __main__ - INFO - üÜî Process GUID: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:10 - __main__ - INFO - üìä Table: M_MARCA
2025-10-11 12:08:10 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:10 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:10 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:10 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:10 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:10 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:10 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:10 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:10 - __main__ - INFO - ================================================================================
2025-10-11 12:08:10 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:10 - __main__ - INFO - ================================================================================
2025-10-11 12:08:10 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:10 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:10 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:10 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:10 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:10 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:10 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:10 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_MARCA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:10,637-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:10,638-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:10,880-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:10,880-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:10 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:10 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:11,185-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:11 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:11 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Table: M_MARCA
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_marca'
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic1f'
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica1,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica1_corp'
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:11 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:11 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_MARCA process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:11 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_MARCA
2025-10-11 12:08:11 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:11 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:11 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:11 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:11 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:11 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:11 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_MARCA process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:11 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:11,403-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:11,513-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:11 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Table: M_MARCA
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:11 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica1)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica1, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica1_corp FROM bartic1f
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica1)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica1, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica1_corp FROM bartic1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.23s
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Rows returned: 7,734
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 7,734 rows
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç Processing chunk 1 with 7734 rows
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 7734 rows - process_guid: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5ef9639d.parquet","timestamp":"2025-10-11 12:08:11,769-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_5ef9639d.parquet","timestamp":"2025-10-11 12:08:11,889-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:11 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:11 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_MARCA
2025-10-11 12:08:11 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:11 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:11 - __main__ - INFO - ================================================================================
2025-10-11 12:08:11 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:11 - __main__ - INFO - üÜî Process GUID: 3e52999c-90ae-4dd4-9c86-6de9d6207a3b
2025-10-11 12:08:11 - __main__ - INFO - üìä Records: 7,734
2025-10-11 12:08:11 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:11 - __main__ - INFO - ‚è±Ô∏è Time: 0.49s
2025-10-11 12:08:11 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:11 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_MODELO_ATENCION... 
2025-10-11 12:08:12 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:12 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:12 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:12 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:12 - __main__ - INFO - üÜî Process GUID generado: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:13 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:13 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:13 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:13 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:13 - __main__ - INFO - ================================================================================
2025-10-11 12:08:13 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:13 - __main__ - INFO - ================================================================================
2025-10-11 12:08:13 - __main__ - INFO - üÜî Process GUID: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:13 - __main__ - INFO - üìä Table: M_MODELO_ATENCION
2025-10-11 12:08:13 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:13 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:13 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:13 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:13 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:13 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:13 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:13 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:13 - __main__ - INFO - ================================================================================
2025-10-11 12:08:13 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:13 - __main__ - INFO - ================================================================================
2025-10-11 12:08:13 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:13 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:13 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:13 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:13 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:13 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:13 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:13 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_MODELO_ATENCION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:13,180-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:13,180-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:13,424-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:13,424-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:13 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:13 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:13,717-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:13 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:13 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Table: M_MODELO_ATENCION
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_modelo_atencion'
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - Checking source_table: 'mmodaten'
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - Checking columns: 'compania, codigo, replace(replace(descripcion, char(13),''), char(10),'') descripcion, estado'
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:13 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:13 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:13 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_MODELO_ATENCION process_guid: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:13 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_MODELO_ATENCION
2025-10-11 12:08:13 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:13 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:13 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:13 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:13 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:13 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:13 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_MODELO_ATENCION process_guid: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:13 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:13,951-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:14,029-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:14 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - Table: M_MODELO_ATENCION
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:14 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 9, Filters: 0
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(codigo)) as id, compania, codigo, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, estado FROM mmodaten
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(codigo)) as id, compania, codigo, replace(replace(descripcion, char(13), ''), char(10), '') descripcion, estado FROM mmodaten
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - Rows returned: 0
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - Columns: 5
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - WARNING - Query returned empty result
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:14 - core.orchestrator - INFO - üîç No watermark to save
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmodaten/year=2025/month=10/day=11/data_thread_0_chunk_0_3b51875d.parquet","timestamp":"2025-10-11 12:08:14,045-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmodaten/year=2025/month=10/day=11/data_thread_0_chunk_0_3b51875d.parquet","timestamp":"2025-10-11 12:08:14,107-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:14 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table M_MODELO_ATENCION
2025-10-11 12:08:14 - bigmagic-monitor - WARNING - Advertencia procesando tabla M_MODELO_ATENCION: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:08:14 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:14 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:08:14 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:14 - __main__ - INFO - ================================================================================
2025-10-11 12:08:14 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:14 - __main__ - INFO - üÜî Process GUID: 7259e268-ad36-4b64-89a9-41036c8f486c
2025-10-11 12:08:14 - __main__ - INFO - üìä Records: 0
2025-10-11 12:08:14 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:14 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:08:14 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:14 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_MODULO... 
2025-10-11 12:08:15 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:15 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:15 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:15 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:15 - __main__ - INFO - üÜî Process GUID generado: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:15 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:15 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:15 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:15 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:15 - __main__ - INFO - ================================================================================
2025-10-11 12:08:15 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:15 - __main__ - INFO - ================================================================================
2025-10-11 12:08:15 - __main__ - INFO - üÜî Process GUID: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:15 - __main__ - INFO - üìä Table: M_MODULO
2025-10-11 12:08:15 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:15 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:15 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:15 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:15 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:15 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:15 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:15 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:15 - __main__ - INFO - ================================================================================
2025-10-11 12:08:15 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:15 - __main__ - INFO - ================================================================================
2025-10-11 12:08:15 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:15 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:15 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:15 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:15 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:15 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:15 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:15 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_MODULO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:15,435-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:15,435-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:15,678-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:15,679-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:15 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:15 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:15,951-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:15 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:15 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Table: M_MODULO
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_modulo'
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - Checking source_table: 'mestdi4f'
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(modulo as int) as varchar(20)) modulo,cast(cast(ruta as int) as varchar(20)) ruta, tipmodulo,replace(replace(descmodulo, char(13),''), char(10),'') descmodulo,cast(cast(qclimodu as int) as varchar(20)) qclimodu, stsmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(sucursal)) sucursal, flgpeligro,cast(cast(codfvtas as int) as varchar(20)) codfvtas'
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:15 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:15 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:15 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_MODULO process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:15 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_MODULO
2025-10-11 12:08:16 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:16 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:16 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:16 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:16 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:16 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:16 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_MODULO process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:16 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:16,169-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:16,232-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:16 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - Table: M_MODULO
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:16 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 23, Filters: 0
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) + '|' + cast(modulo as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(modulo as int) as varchar(20)) modulo, cast(cast(ruta as int) as varchar(20)) ruta, tipmodulo, replace(replace(descmodulo, char(13), ''), char(10), '') descmodulo, cast(cast(qclimodu as int) as varchar(20)) qclimodu, stsmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, flgpeligro, cast(cast(codfvtas as int) as varchar(20)) codfvtas FROM mestdi4f
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) + '|' + cast(modulo as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(modulo as int) as varchar(20)) modulo, cast(cast(ruta as int) as varchar(20)) ruta, tipmodulo, replace(replace(descmodulo, char(13), ''), char(10), '') descmodulo, cast(cast(qclimodu as int) as varchar(20)) qclimodu, stsmodulo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, flgpeligro, cast(cast(codfvtas as int) as varchar(20)) codfvtas FROM mestdi4f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.19s
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Rows returned: 6,674
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Columns: 18
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 6,674 rows
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç Processing chunk 1 with 6674 rows
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 6674 rows - process_guid: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e4fb150b.parquet","timestamp":"2025-10-11 12:08:16,478-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e4fb150b.parquet","timestamp":"2025-10-11 12:08:16,575-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:16 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:16 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_MODULO
2025-10-11 12:08:16 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:16 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:16 - __main__ - INFO - ================================================================================
2025-10-11 12:08:16 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:16 - __main__ - INFO - üÜî Process GUID: b5ba35b1-6b43-42bb-8479-2e3a316b9bd0
2025-10-11 12:08:16 - __main__ - INFO - üìä Records: 6,674
2025-10-11 12:08:16 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:16 - __main__ - INFO - ‚è±Ô∏è Time: 0.41s
2025-10-11 12:08:16 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:16 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_MONEDA... 
2025-10-11 12:08:17 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:17 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:17 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:17 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:17 - __main__ - INFO - üÜî Process GUID generado: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:17 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:17 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:17 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:17 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:17 - __main__ - INFO - ================================================================================
2025-10-11 12:08:17 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:17 - __main__ - INFO - ================================================================================
2025-10-11 12:08:17 - __main__ - INFO - üÜî Process GUID: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:17 - __main__ - INFO - üìä Table: M_MONEDA
2025-10-11 12:08:17 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:17 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:17 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:17 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:17 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:17 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:17 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:17 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:17 - __main__ - INFO - ================================================================================
2025-10-11 12:08:17 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:17 - __main__ - INFO - ================================================================================
2025-10-11 12:08:17 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:17 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:17 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:17 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:17 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:17 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:17 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:17 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_MONEDA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:17,930-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:17,930-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:18,174-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:18,175-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:18 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:18,450-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:18 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:18 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Table: M_MONEDA
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_moneda'
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Checking source_table: 'mmoned1f'
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea'
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:18 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:18 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_MONEDA process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:18 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_MONEDA
2025-10-11 12:08:18 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:18 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:18 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:18 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:18 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:18 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:18 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_MONEDA process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:18 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:18,700-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 1 objects across 1 pages","timestamp":"2025-10-11 12:08:18,794-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:274","message":"Deleting 1 objects from S3","timestamp":"2025-10-11 12:08:18,794-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"delete_objects:286","message":"Successfully deleted 1 objects","timestamp":"2025-10-11 12:08:18,825-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:18 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Table: M_MONEDA
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:18 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea FROM mmoned1f
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(moneda)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, moneda, descrip, simbmone, flgproced, estado, operacion, descrip2, operador, feccrea, fecultmod, horcrea, horultimod, ultusumod, usucrea FROM mmoned1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Columns: 17
2025-10-11 12:08:18 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 50 rows
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç Processing chunk 1 with 50 rows
2025-10-11 12:08:18 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 50 rows - process_guid: 19465039-ccc7-4889-b587-2abbe4ce870e
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmoned1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec0dd03f.parquet","timestamp":"2025-10-11 12:08:18,841-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mmoned1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec0dd03f.parquet","timestamp":"2025-10-11 12:08:19,091-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:19 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:19 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:19 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:19 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:19 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_MONEDA
2025-10-11 12:08:19 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:19 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:19 - __main__ - INFO - ================================================================================
2025-10-11 12:08:19 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:19 - __main__ - INFO - üÜî Process GUID: 19465039-ccc7-4889-b587-2abbe4ce870e
2025-10-11 12:08:19 - __main__ - INFO - üìä Records: 50
2025-10-11 12:08:19 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:19 - __main__ - INFO - ‚è±Ô∏è Time: 0.39s
2025-10-11 12:08:19 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:19 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_NG1... 
2025-10-11 12:08:20 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:20 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:20 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:20 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:20 - __main__ - INFO - üÜî Process GUID generado: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:20 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:20 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:20 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:20 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:20 - __main__ - INFO - ================================================================================
2025-10-11 12:08:20 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:20 - __main__ - INFO - ================================================================================
2025-10-11 12:08:20 - __main__ - INFO - üÜî Process GUID: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:20 - __main__ - INFO - üìä Table: M_NG1
2025-10-11 12:08:20 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:20 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:20 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:20 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:20 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:20 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:20 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:20 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:20 - __main__ - INFO - ================================================================================
2025-10-11 12:08:20 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:20 - __main__ - INFO - ================================================================================
2025-10-11 12:08:20 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:20 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:20 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:20 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:20 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:20 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:20 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:20 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_NG1', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:20,413-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:20,414-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:20,623-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:20,623-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:20 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:20 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:20,904-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:20 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:20 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Table: M_NG1
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_ng1'
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - Checking source_table: 'bubige2f'
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais, departamen,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,replace(replace(descorta, char(13),''), char(10),'') descorta, flgcetico'
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:20 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:20 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:20 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_NG1 process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:20 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_NG1
2025-10-11 12:08:21 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:21 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:21 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:21 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:21 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:21 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:21 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_NG1 process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:21 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:21,123-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:21,185-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:21 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - Table: M_NG1
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:21 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 23, Filters: 0
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, flgcetico FROM bubige2f
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, flgcetico FROM bubige2f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Rows returned: 97
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Columns: 14
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 97 rows
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç Processing chunk 1 with 97 rows
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 97 rows - process_guid: acfb85bc-eaf2-463e-bb0f-126da460953d
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ce9f01b2.parquet","timestamp":"2025-10-11 12:08:21,217-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ce9f01b2.parquet","timestamp":"2025-10-11 12:08:21,263-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:21 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:21 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_NG1
2025-10-11 12:08:21 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:21 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:21 - __main__ - INFO - ================================================================================
2025-10-11 12:08:21 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:21 - __main__ - INFO - üÜî Process GUID: acfb85bc-eaf2-463e-bb0f-126da460953d
2025-10-11 12:08:21 - __main__ - INFO - üìä Records: 97
2025-10-11 12:08:21 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:21 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:08:21 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:21 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_NG2... 
2025-10-11 12:08:22 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:22 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:22 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:22 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:22 - __main__ - INFO - üÜî Process GUID generado: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:22 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:22 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:22 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:22 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:22 - __main__ - INFO - ================================================================================
2025-10-11 12:08:22 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:22 - __main__ - INFO - ================================================================================
2025-10-11 12:08:22 - __main__ - INFO - üÜî Process GUID: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:22 - __main__ - INFO - üìä Table: M_NG2
2025-10-11 12:08:22 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:22 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:22 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:22 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:22 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:22 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:22 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:22 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:22 - __main__ - INFO - ================================================================================
2025-10-11 12:08:22 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:22 - __main__ - INFO - ================================================================================
2025-10-11 12:08:22 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:22 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:22 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:22 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:22 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:22 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:22 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:22 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_NG2', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:22,633-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:22,633-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:22,909-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:22,910-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:22 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:23,186-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:23 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:23 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Table: M_NG2
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_ng2'
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Checking source_table: 'bubige3f'
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais, departamen, provincia,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:23 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:23 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_NG2 process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:23 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_NG2
2025-10-11 12:08:23 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:23 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:23 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:23 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:23 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:23 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:23 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_NG2 process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:23 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:23,405-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:23,467-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:23 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Table: M_NG2
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:23 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) + '|' + rtrim(ltrim(provincia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, provincia, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bubige3f
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) + '|' + rtrim(ltrim(provincia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, provincia, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bubige3f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Rows returned: 212
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 212 rows
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç Processing chunk 1 with 212 rows
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 212 rows - process_guid: 558f218f-19d4-4a09-a32d-9a87e02d784d
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e37810c5.parquet","timestamp":"2025-10-11 12:08:23,498-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_e37810c5.parquet","timestamp":"2025-10-11 12:08:23,561-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:23 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:23 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_NG2
2025-10-11 12:08:23 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:23 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:23 - __main__ - INFO - ================================================================================
2025-10-11 12:08:23 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:23 - __main__ - INFO - üÜî Process GUID: 558f218f-19d4-4a09-a32d-9a87e02d784d
2025-10-11 12:08:23 - __main__ - INFO - üìä Records: 212
2025-10-11 12:08:23 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:23 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:08:23 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:23 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_NG3... 
2025-10-11 12:08:24 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:24 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:24 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:24 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:24 - __main__ - INFO - üÜî Process GUID generado: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:24 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:24 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:24 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:24 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:24 - __main__ - INFO - ================================================================================
2025-10-11 12:08:24 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:24 - __main__ - INFO - ================================================================================
2025-10-11 12:08:24 - __main__ - INFO - üÜî Process GUID: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:24 - __main__ - INFO - üìä Table: M_NG3
2025-10-11 12:08:24 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:24 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:24 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:24 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:24 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:24 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:24 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:24 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:24 - __main__ - INFO - ================================================================================
2025-10-11 12:08:24 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:24 - __main__ - INFO - ================================================================================
2025-10-11 12:08:24 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:24 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:24 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:24 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:24 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:24 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:24 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:24 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_NG3', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:24,848-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:24,848-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:25,088-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:25,088-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:25 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:25,358-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:25 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:25 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Table: M_NG3
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_ng3'
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Checking source_table: 'bubige4f'
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais, departamen, provincia, distrito, zonapostal,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, region'
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:25 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:25 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_NG3 process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:25 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_NG3
2025-10-11 12:08:25 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:25 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:25 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:25 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:25 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:25 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:25 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_NG3 process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:25 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:25,593-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:25,655-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:25 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Table: M_NG3
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:25 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 21, Filters: 0
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) + '|' + rtrim(ltrim(provincia)) + '|' + rtrim(ltrim(distrito)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, provincia, distrito, zonapostal, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, region FROM bubige4f
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(departamen)) + '|' + rtrim(ltrim(provincia)) + '|' + rtrim(ltrim(distrito)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, departamen, provincia, distrito, zonapostal, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, region FROM bubige4f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.11s
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Rows returned: 3,278
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Columns: 16
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 3,278 rows
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç Processing chunk 1 with 3278 rows
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 3278 rows - process_guid: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_cdd14366.parquet","timestamp":"2025-10-11 12:08:25,780-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bubige4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_cdd14366.parquet","timestamp":"2025-10-11 12:08:25,874-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:25 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:25 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_NG3
2025-10-11 12:08:25 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:25 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:25 - __main__ - INFO - ================================================================================
2025-10-11 12:08:25 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:25 - __main__ - INFO - üÜî Process GUID: de3fd5be-c77a-4a45-aaf8-9e303d97ded5
2025-10-11 12:08:25 - __main__ - INFO - üìä Records: 3,278
2025-10-11 12:08:25 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:25 - __main__ - INFO - ‚è±Ô∏è Time: 0.28s
2025-10-11 12:08:25 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:25 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_OCASION... 
2025-10-11 12:08:26 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:26 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:26 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:26 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:26 - __main__ - INFO - üÜî Process GUID generado: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:27 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:27 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:27 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:27 - __main__ - INFO - ================================================================================
2025-10-11 12:08:27 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:27 - __main__ - INFO - ================================================================================
2025-10-11 12:08:27 - __main__ - INFO - üÜî Process GUID: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - __main__ - INFO - üìä Table: M_OCASION
2025-10-11 12:08:27 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:27 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:27 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:27 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:27 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:27 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:27 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:27 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:27 - __main__ - INFO - ================================================================================
2025-10-11 12:08:27 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:27 - __main__ - INFO - ================================================================================
2025-10-11 12:08:27 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:27 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:27 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:27 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:27 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:27 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:27 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_OCASION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:27,171-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:27,171-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:27,374-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:27,374-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:27 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:27,669-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:27 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:27 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Table: M_OCASION
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_ocasion'
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Checking source_table: 'mocasion1f'
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecmodi,horamodi) lastmodifydate, compania, codocas,replace(replace(desocas, char(13),''), char(10),'') desocas, estocas, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi'
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:27 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:27 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_OCASION process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_OCASION
2025-10-11 12:08:27 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:27 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:27 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:27 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:27 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:27 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:27 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_OCASION process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:27,904-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:27,979-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:27 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Table: M_OCASION
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:27 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(codocas)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, codocas, replace(replace(desocas, char(13), ''), char(10), '') desocas, estocas, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM mocasion1f
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(codocas)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, codocas, replace(replace(desocas, char(13), ''), char(10), '') desocas, estocas, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM mocasion1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Rows returned: 104
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:08:27 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 104 rows
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç Processing chunk 1 with 104 rows
2025-10-11 12:08:27 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 104 rows - process_guid: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mocasion1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9e4888a6.parquet","timestamp":"2025-10-11 12:08:28,006-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mocasion1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9e4888a6.parquet","timestamp":"2025-10-11 12:08:28,060-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:28 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:28 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:28 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:28 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:28 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_OCASION
2025-10-11 12:08:28 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:28 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:28 - __main__ - INFO - ================================================================================
2025-10-11 12:08:28 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:28 - __main__ - INFO - üÜî Process GUID: 6b7e936e-4eb4-4bbb-8962-a31c77aec86d
2025-10-11 12:08:28 - __main__ - INFO - üìä Records: 104
2025-10-11 12:08:28 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:28 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:08:28 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:28 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_OPERACION... 
2025-10-11 12:08:29 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:29 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:29 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:29 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:29 - __main__ - INFO - üÜî Process GUID generado: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:29 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:29 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:29 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:29 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:29 - __main__ - INFO - ================================================================================
2025-10-11 12:08:29 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:29 - __main__ - INFO - ================================================================================
2025-10-11 12:08:29 - __main__ - INFO - üÜî Process GUID: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:29 - __main__ - INFO - üìä Table: M_OPERACION
2025-10-11 12:08:29 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:29 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:29 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:29 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:29 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:29 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:29 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:29 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:29 - __main__ - INFO - ================================================================================
2025-10-11 12:08:29 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:29 - __main__ - INFO - ================================================================================
2025-10-11 12:08:29 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:29 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:29 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:29 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:29 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:29 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:29 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:29 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_OPERACION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:29,427-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:29,428-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:29,657-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:29,657-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:29 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:29 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:29,920-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:29 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:29 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Table: M_OPERACION
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_operacion'
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - Checking source_table: 'bopera1f'
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(docuoperac)) docuoperac,rtrim(ltrim(procedim)) procedim,rtrim(ltrim(operacion)) operacion,replace(replace(descoper1, char(13),''), char(10),'') descoper1,replace(replace(descoper2, char(13),''), char(10),'') descoper2, stsoperaci, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cfop, flgcalctotal, flgcalcimp, tipoper, flgcontab, nota, flgsumres, codequiv, flgdigprec, flgcaldsct'
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:29 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:29 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:29 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_OPERACION process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:29 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_OPERACION
2025-10-11 12:08:30 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:30 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:30 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:30 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:30 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:30 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:30 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_OPERACION process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:30 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:30,139-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:30,201-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:30 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - Table: M_OPERACION
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:30 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 34, Filters: 0
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(docuoperac)) + '|' + rtrim(ltrim(procedim)) + '|' + rtrim(ltrim(operacion)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(docuoperac)) docuoperac, rtrim(ltrim(procedim)) procedim, rtrim(ltrim(operacion)) operacion, replace(replace(descoper1, char(13), ''), char(10), '') descoper1, replace(replace(descoper2, char(13), ''), char(10), '') descoper2, stsoperaci, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cfop, flgcalctotal, flgcalcimp, tipoper, flgcontab, nota, flgsumres, codequiv, flgdigprec, flgcaldsct FROM bopera1f
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(docuoperac)) + '|' + rtrim(ltrim(procedim)) + '|' + rtrim(ltrim(operacion)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(docuoperac)) docuoperac, rtrim(ltrim(procedim)) procedim, rtrim(ltrim(operacion)) operacion, replace(replace(descoper1, char(13), ''), char(10), '') descoper1, replace(replace(descoper2, char(13), ''), char(10), '') descoper2, stsoperaci, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cfop, flgcalctotal, flgcalcimp, tipoper, flgcontab, nota, flgsumres, codequiv, flgdigprec, flgcaldsct FROM bopera1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.06s
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,822
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Columns: 25
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,822 rows
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç Processing chunk 1 with 1822 rows
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1822 rows - process_guid: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bopera1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9cf8e594.parquet","timestamp":"2025-10-11 12:08:30,279-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bopera1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9cf8e594.parquet","timestamp":"2025-10-11 12:08:30,389-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:30 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:30 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_OPERACION
2025-10-11 12:08:30 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:30 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:30 - __main__ - INFO - ================================================================================
2025-10-11 12:08:30 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:30 - __main__ - INFO - üÜî Process GUID: 4c14779a-4ec7-464c-b55f-3c6983b12aa0
2025-10-11 12:08:30 - __main__ - INFO - üìä Records: 1,822
2025-10-11 12:08:30 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:30 - __main__ - INFO - ‚è±Ô∏è Time: 0.25s
2025-10-11 12:08:30 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:30 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_ORIGEN_PEDIDO... 
2025-10-11 12:08:31 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:31 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:31 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:31 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:31 - __main__ - INFO - üÜî Process GUID generado: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:31 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:31 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:31 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:31 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:31 - __main__ - INFO - ================================================================================
2025-10-11 12:08:31 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:31 - __main__ - INFO - ================================================================================
2025-10-11 12:08:31 - __main__ - INFO - üÜî Process GUID: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:31 - __main__ - INFO - üìä Table: M_ORIGEN_PEDIDO
2025-10-11 12:08:31 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:31 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:31 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:31 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:31 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:31 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:31 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:31 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:31 - __main__ - INFO - ================================================================================
2025-10-11 12:08:31 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:31 - __main__ - INFO - ================================================================================
2025-10-11 12:08:31 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:31 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:31 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:31 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:31 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:31 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:31 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:31 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_ORIGEN_PEDIDO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:31,661-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:31,661-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:31,923-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:31,923-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:31 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:32,217-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:32 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:32 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Table: M_ORIGEN_PEDIDO
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_origen_pedido'
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Checking source_table: 'boripe1f'
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, origpedido,replace(replace(descorip1, char(13),''), char(10),'') descorip1,replace(replace(descorip2, char(13),''), char(10),'') descorip2, stsoriped, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod'
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:32 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:32 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_ORIGEN_PEDIDO process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:32 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_ORIGEN_PEDIDO
2025-10-11 12:08:32 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:32 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:32 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:32 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:32 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:32 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:32 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_ORIGEN_PEDIDO process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:32 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:32,465-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:32,547-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:32 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Table: M_ORIGEN_PEDIDO
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:32 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 22, Filters: 0
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(origpedido)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, origpedido, replace(replace(descorip1, char(13), ''), char(10), '') descorip1, replace(replace(descorip2, char(13), ''), char(10), '') descorip2, stsoriped, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM boripe1f
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(origpedido)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, origpedido, replace(replace(descorip1, char(13), ''), char(10), '') descorip1, replace(replace(descorip2, char(13), ''), char(10), '') descorip2, stsoriped, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM boripe1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Rows returned: 84
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 84 rows
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç Processing chunk 1 with 84 rows
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 84 rows - process_guid: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/boripe1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_fa14ef7d.parquet","timestamp":"2025-10-11 12:08:32,572-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/boripe1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_fa14ef7d.parquet","timestamp":"2025-10-11 12:08:32,640-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:32 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:32 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_ORIGEN_PEDIDO
2025-10-11 12:08:32 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:32 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:32 - __main__ - INFO - ================================================================================
2025-10-11 12:08:32 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:32 - __main__ - INFO - üÜî Process GUID: 1994c2d5-0dea-4e2b-989b-d3bd3b8cccc9
2025-10-11 12:08:32 - __main__ - INFO - üìä Records: 84
2025-10-11 12:08:32 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:32 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:08:32 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:32 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_PARAMETRO... 
2025-10-11 12:08:33 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:33 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:33 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:33 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:33 - __main__ - INFO - üÜî Process GUID generado: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:33 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:33 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:33 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:33 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:33 - __main__ - INFO - ================================================================================
2025-10-11 12:08:33 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:33 - __main__ - INFO - ================================================================================
2025-10-11 12:08:33 - __main__ - INFO - üÜî Process GUID: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:33 - __main__ - INFO - üìä Table: M_PARAMETRO
2025-10-11 12:08:33 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:33 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:33 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:33 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:33 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:33 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:33 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:33 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:33 - __main__ - INFO - ================================================================================
2025-10-11 12:08:33 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:33 - __main__ - INFO - ================================================================================
2025-10-11 12:08:33 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:33 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:33 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:33 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:33 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:33 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:33 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:33 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_PARAMETRO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:33,973-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:33,973-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:34,187-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:34,187-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:34 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:34,467-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:34 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:34 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Table: M_PARAMETRO
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_parametro'
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Checking source_table: 'mparam1f'
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,replace(replace(diavcmto, char(13),''), char(10),'') diavcmto,replace(replace(diavigencia, char(13),''), char(10),'') diavigencia, condpagoco,replace(replace(dexpsolcre, char(13),''), char(10),'') dexpsolcre, mduccod, prgminsol2, prgmindol2,replace(replace(diarend, char(13),''), char(10),'') diarend, tliqtransp, tncargo, tnabono, ttransint, areasol, cajasol, areadol, cajadol, monsol, mondolar,rtrim(ltrim(almacen)) almacen, sucdestino, astogasto, astoajstpr, ctarei, ttransext, astoapertu, astoprovin, flujoefec, ubicalerta, redonflujo, transfti, monflujodo, areaflujod, fecinicio, fecfinal, astoajstce, prgminsol1, prgmindol1, motcjaing, motcjaegr, motbcoing, motbcoegr, motsolprov, ordgiropro, ttpcompdoc, costogasto, mothabilit, mottransf, motreembol, motdevol, estaduana, reponcieco, emplerecep, astocliloc, astoajstpa, astoajsten, gtoxint, astoajstbc, otrgtoxint, intmorator, bajactivop, motcompact, astoajstac, astoajstcj, compvtadol, astotrans, transrecho, ttbajactiv, ttactivact, mtodifer, astoecdm, astoedcm, costodmemo, astocanctb, astocompra, astoventa, cajeordgir, ttpagopasi, tbdeposito, concfaltan, combustibl, concingcobt, transdoc, transltcli, transltpro, condpagolt, transcheq, transcheqr, califica1, califica2, califica3, califica4, califica5, califica6, califica7, califica8, califica9, califica10, lincartacr, transefecu, concprerob, nronivcta,replace(replace(diginiv1, char(13),''), char(10),'') diginiv1,replace(replace(diginiv2, char(13),''), char(10),'') diginiv2,replace(replace(diginiv3, char(13),''), char(10),'') diginiv3,replace(replace(diginiv4, char(13),''), char(10),'') diginiv4,replace(replace(diginiv5, char(13),''), char(10),'') diginiv5, codctared, codctaaju, motnalce, motnclce, transdie, motingdie, motegrdie, motabotra, traabotra, motcjd, astovta, astocinlct, maxenrsol, maxenrdol,replace(replace(diasenr, char(13),''), char(10),'') diasenr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, maxgassol, maxgasdol, maxegrsol, maxegrdol, regigvt, regigvmm, regigvfd, regigvfh, ttcobtrans, areacajch, cajach, transcnd, transbp,case when flgacepcxc = 0x46 then 'F' when flgacepcxc = 0x54 then 'T' end flgacepcxc,case when flgacepcxp = 0x46 then 'F' when flgacepcxp = 0x54 then 'T' end flgacepcxp,case when flgentrcxp = 0x46 then 'F' when flgentrcxp = 0x54 then 'T' end flgentrcxp,case when flgentrchq = 0x46 then 'F' when flgentrchq = 0x54 then 'T' end flgentrchq, astoplani, astoingalm, imptonac, ttingbcont, acttransf, actactivac, trabcurso, actasegur, actmejora, traalmact, movalmact, motogjdet, motbdbtra, astdconalm, astcoinalm, astctopro, astctovta, astcvsbra, astcvdeduc, motantprov, motogliqui, astcvtarim, impminperc, finiperc, ffinperc, impminpcppdt, maxogjes, maxogjed, facliqcom, facimp, califica11, gasvehreq,case when flgalmreq = 0x46 then 'F' when flgalmreq = 0x54 then 'T' end flgalmreq, arthosp,case when flgmocacot = 0x46 then 'F' when flgmocacot = 0x54 then 'T' end flgmocacot, nombruc,case when flgimpincl = 0x46 then 'F' when flgimpincl = 0x54 then 'T' end flgimpincl,case when aprdiroco = 0x46 then 'F' when aprdiroco = 0x54 then 'T' end aprdiroco, codiretr, astdistgto, procdimpu,case when multisuc = 0x46 then 'F' when multisuc = 0x54 then 'T' end multisuc, persrebco,case when imp1com = 0x46 then 'F' when imp1com = 0x54 then 'T' end imp1com,case when imp2com = 0x46 then 'F' when imp2com = 0x54 then 'T' end imp2com, ctrlpptto, aremark, succerv,case when centpagos = 0x46 then 'F' when centpagos = 0x54 then 'T' end centpagos, sucmov,case when flgretfue = 0x46 then 'F' when flgretfue = 0x54 then 'T' end flgretfue,case when flgretren = 0x46 then 'F' when flgretren = 0x54 then 'T' end flgretren,case when flgctrlfrc = 0x46 then 'F' when flgctrlfrc = 0x54 then 'T' end flgctrlfrc,replace(replace(digdepos, char(13),''), char(10),'') digdepos, vadetocia, motbigbda, ttbigbda, tdperce, tdreten,case when ctrlimpdep = 0x46 then 'F' when ctrlimpdep = 0x54 then 'T' end ctrlimpdep,case when flgctrchq = 0x46 then 'F' when flgctrchq = 0x54 then 'T' end flgctrchq,case when flgcalcimp = 0x46 then 'F' when flgcalcimp = 0x54 then 'T' end flgcalcimp, codimpiva, codislr, coddebco, codrim,case when flgrenta = 0x46 then 'F' when flgrenta = 0x54 then 'T' end flgrenta,case when flgmunici = 0x46 then 'F' when flgmunici = 0x54 then 'T' end flgmunici, ctagaspresu,replace(replace(digctaconta, char(13),''), char(10),'') digctaconta, ccostvta,case when flggim = 0x46 then 'F' when flggim = 0x54 then 'T' end flggim, ordenkardex'
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:34 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:34 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_PARAMETRO process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:34 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_PARAMETRO
2025-10-11 12:08:34 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:34 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:34 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:34 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:34 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:34 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:34 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_PARAMETRO process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:34 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:34,686-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:34,749-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:34 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Table: M_PARAMETRO
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:34 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 270, Filters: 0
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, replace(replace(diavcmto, char(13), ''), char(10), '') diavcmto, replace(replace(diavigencia, char(13), ''), char(10), '') diavigencia, condpagoco, replace(replace(dexpsolcre, char(13), ''), char(10), '') dexpsolcre, mduccod, prgminsol2, prgmindol2, replace(replace(diarend, char(13), ''), char(10), '') diarend, tliqtransp, tncargo, tnabono, ttransint, areasol, cajasol, areadol, cajadol, monsol, mondolar, rtrim(ltrim(almacen)) almacen, sucdestino, astogasto, astoajstpr, ctarei, ttransext, astoapertu, astoprovin, flujoefec, ubicalerta, redonflujo, transfti, monflujodo, areaflujod, fecinicio, fecfinal, astoajstce, prgminsol1, prgmindol1, motcjaing, motcjaegr, motbcoing, motbcoegr, motsolprov, ordgiropro, ttpcompdoc, costogasto, mothabilit, mottransf, motreembol, motdevol, estaduana, reponcieco, emplerecep, astocliloc, astoajstpa, astoajsten, gtoxint, astoajstbc, otrgtoxint, intmorator, bajactivop, motcompact, astoajstac, astoajstcj, compvtadol, astotrans, transrecho, ttbajactiv, ttactivact, mtodifer, astoecdm, astoedcm, costodmemo, astocanctb, astocompra, astoventa, cajeordgir, ttpagopasi, tbdeposito, concfaltan, combustibl, concingcobt, transdoc, transltcli, transltpro, condpagolt, transcheq, transcheqr, califica1, califica2, califica3, califica4, califica5, califica6, califica7, califica8, califica9, califica10, lincartacr, transefecu, concprerob, nronivcta, replace(replace(diginiv1, char(13), ''), char(10), '') diginiv1, replace(replace(diginiv2, char(13), ''), char(10), '') diginiv2, replace(replace(diginiv3, char(13), ''), char(10), '') diginiv3, replace(replace(diginiv4, char(13), ''), char(10), '') diginiv4, replace(replace(diginiv5, char(13), ''), char(10), '') diginiv5, codctared, codctaaju, motnalce, motnclce, transdie, motingdie, motegrdie, motabotra, traabotra, motcjd, astovta, astocinlct, maxenrsol, maxenrdol, replace(replace(diasenr, char(13), ''), char(10), '') diasenr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, maxgassol, maxgasdol, maxegrsol, maxegrdol, regigvt, regigvmm, regigvfd, regigvfh, ttcobtrans, areacajch, cajach, transcnd, transbp, case when flgacepcxc = 0x46 then 'F' when flgacepcxc = 0x54 then 'T' end flgacepcxc, case when flgacepcxp = 0x46 then 'F' when flgacepcxp = 0x54 then 'T' end flgacepcxp, case when flgentrcxp = 0x46 then 'F' when flgentrcxp = 0x54 then 'T' end flgentrcxp, case when flgentrchq = 0x46 then 'F' when flgentrchq = 0x54 then 'T' end flgentrchq, astoplani, astoingalm, imptonac, ttingbcont, acttransf, actactivac, trabcurso, actasegur, actmejora, traalmact, movalmact, motogjdet, motbdbtra, astdconalm, astcoinalm, astctopro, astctovta, astcvsbra, astcvdeduc, motantprov, motogliqui, astcvtarim, impminperc, finiperc, ffinperc, impminpcppdt, maxogjes, maxogjed, facliqcom, facimp, califica11, gasvehreq, case when flgalmreq = 0x46 then 'F' when flgalmreq = 0x54 then 'T' end flgalmreq, arthosp, case when flgmocacot = 0x46 then 'F' when flgmocacot = 0x54 then 'T' end flgmocacot, nombruc, case when flgimpincl = 0x46 then 'F' when flgimpincl = 0x54 then 'T' end flgimpincl, case when aprdiroco = 0x46 then 'F' when aprdiroco = 0x54 then 'T' end aprdiroco, codiretr, astdistgto, procdimpu, case when multisuc = 0x46 then 'F' when multisuc = 0x54 then 'T' end multisuc, persrebco, case when imp1com = 0x46 then 'F' when imp1com = 0x54 then 'T' end imp1com, case when imp2com = 0x46 then 'F' when imp2com = 0x54 then 'T' end imp2com, ctrlpptto, aremark, succerv, case when centpagos = 0x46 then 'F' when centpagos = 0x54 then 'T' end centpagos, sucmov, case when flgretfue = 0x46 then 'F' when flgretfue = 0x54 then 'T' end flgretfue, case when flgretren = 0x46 then 'F' when flgretren = 0x54 then 'T' end flgretren, case when flgctrlfrc = 0x46 then 'F' when flgctrlfrc = 0x54 then 'T' end flgctrlfrc, replace(replace(digdepos, char(13), ''), char(10), '') digdepos, vadetocia, motbigbda, ttbigbda, tdperce, tdreten, case when ctrlimpdep = 0x46 then 'F' when ctrlimpdep = 0x54 then 'T' end ctrlimpdep, case when flgctrchq = 0x46 then 'F' when flgctrchq = 0x54 then 'T' end flgctrchq, case when flgcalcimp = 0x46 then 'F' when flgcalcimp = 0x54 then 'T' end flgcalcimp, codimpiva, codislr, coddebco, codrim, case when flgrenta = 0x46 then 'F' when flgrenta = 0x54 then 'T' end flgrenta, case when flgmunici = 0x46 then 'F' when flgmunici = 0x54 then 'T' end flgmunici, ctagaspresu, replace(replace(digctaconta, char(13), ''), char(10), '') digctaconta, ccostvta, case when flggim = 0x46 then 'F' when flggim = 0x54 then 'T' end flggim, ordenkardex FROM mparam1f
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, replace(replace(diavcmto, char(13), ''), char(10), '') diavcmto, replace(replace(diavigencia, char(13), ''), char(10), '') diavigencia, condpagoco, replace(replace(dexpsolcre, char(13), ''), char(10), '') dexpsolcre, mduccod, prgminsol2, prgmindol2, replace(replace(diarend, char(13), ''), char(10), '') diarend, tliqtransp, tncargo, tnabono, ttransint, areasol, cajasol, areadol, cajadol, monsol, mondolar, rtrim(ltrim(almacen)) almacen, sucdestino, astogasto, astoajstpr, ctarei, ttransext, astoapertu, astoprovin, flujoefec, ubicalerta, redonflujo, transfti, monflujodo, areaflujod, fecinicio, fecfinal, astoajstce, prgminsol1, prgmindol1, motcjaing, motcjaegr, motbcoing, motbcoegr, motsolprov, ordgiropro, ttpcompdoc, costogasto, mothabilit, mottransf, motreembol, motdevol, estaduana, reponcieco, emplerecep, astocliloc, astoajstpa, astoajsten, gtoxint, astoajstbc, otrgtoxint, intmorator, bajactivop, motcompact, astoajstac, astoajstcj, compvtadol, astotrans, transrecho, ttbajactiv, ttactivact, mtodifer, astoecdm, astoedcm, costodmemo, astocanctb, astocompra, astoventa, cajeordgir, ttpagopasi, tbdeposito, concfaltan, combustibl, concingcobt, transdoc, transltcli, transltpro, condpagolt, transcheq, transcheqr, califica1, califica2, califica3, califica4, califica5, califica6, califica7, califica8, califica9, califica10, lincartacr, transefecu, concprerob, nronivcta, replace(replace(diginiv1, char(13), ''), char(10), '') diginiv1, replace(replace(diginiv2, char(13), ''), char(10), '') diginiv2, replace(replace(diginiv3, char(13), ''), char(10), '') diginiv3, replace(replace(diginiv4, char(13), ''), char(10), '') diginiv4, replace(replace(diginiv5, char(13), ''), char(10), '') diginiv5, codctared, codctaaju, motnalce, motnclce, transdie, motingdie, motegrdie, motabotra, traabotra, motcjd, astovta, astocinlct, maxenrsol, maxenrdol, replace(replace(diasenr, char(13), ''), char(10), '') diasenr, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, maxgassol, maxgasdol, maxegrsol, maxegrdol, regigvt, regigvmm, regigvfd, regigvfh, ttcobtrans, areacajch, cajach, transcnd, transbp, case when flgacepcxc = 0x46 then 'F' when flgacepcxc = 0x54 then 'T' end flgacepcxc, case when flgacepcxp = 0x46 then 'F' when flgacepcxp = 0x54 then 'T' end flgacepcxp, case when flgentrcxp = 0x46 then 'F' when flgentrcxp = 0x54 then 'T' end flgentrcxp, case when flgentrchq = 0x46 then 'F' when flgentrchq = 0x54 then 'T' end flgentrchq, astoplani, astoingalm, imptonac, ttingbcont, acttransf, actactivac, trabcurso, actasegur, actmejora, traalmact, movalmact, motogjdet, motbdbtra, astdconalm, astcoinalm, astctopro, astctovta, astcvsbra, astcvdeduc, motantprov, motogliqui, astcvtarim, impminperc, finiperc, ffinperc, impminpcppdt, maxogjes, maxogjed, facliqcom, facimp, califica11, gasvehreq, case when flgalmreq = 0x46 then 'F' when flgalmreq = 0x54 then 'T' end flgalmreq, arthosp, case when flgmocacot = 0x46 then 'F' when flgmocacot = 0x54 then 'T' end flgmocacot, nombruc, case when flgimpincl = 0x46 then 'F' when flgimpincl = 0x54 then 'T' end flgimpincl, case when aprdiroco = 0x46 then 'F' when aprdiroco = 0x54 then 'T' end aprdiroco, codiretr, astdistgto, procdimpu, case when multisuc = 0x46 then 'F' when multisuc = 0x54 then 'T' end multisuc, persrebco, case when imp1com = 0x46 then 'F' when imp1com = 0x54 then 'T' end imp1com, case when imp2com = 0x46 then 'F' when imp2com = 0x54 then 'T' end imp2com, ctrlpptto, aremark, succerv, case when centpagos = 0x46 then 'F' when centpagos = 0x54 then 'T' end centpagos, sucmov, case when flgretfue = 0x46 then 'F' when flgretfue = 0x54 then 'T' end flgretfue, case when flgretren = 0x46 then 'F' when flgretren = 0x54 then 'T' end flgretren, case when flgctrlfrc = 0x46 then 'F' when flgctrlfrc = 0x54 then 'T' end flgctrlfrc, replace(replace(digdepos, char(13), ''), char(10), '') digdepos, vadetocia, motbigbda, ttbigbda, tdperce, tdreten, case when ctrlimpdep = 0x46 then 'F' when ctrlimpdep = 0x54 then 'T' end ctrlimpdep, case when flgctrchq = 0x46 then 'F' when flgctrchq = 0x54 then 'T' end flgctrchq, case when flgcalcimp = 0x46 then 'F' when flgcalcimp = 0x54 then 'T' end flgcalcimp, codimpiva, codislr, coddebco, codrim, case when flgrenta = 0x46 then 'F' when flgrenta = 0x54 then 'T' end flgrenta, case when flgmunici = 0x46 then 'F' when flgmunici = 0x54 then 'T' end flgmunici, ctagaspresu, replace(replace(digctaconta, char(13), ''), char(10), '') digctaconta, ccostvta, case when flggim = 0x46 then 'F' when flggim = 0x54 then 'T' end flggim, ordenkardex FROM mparam1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.03s
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Rows returned: 13
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Columns: 221
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 13 rows
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç Processing chunk 1 with 13 rows
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 13 rows - process_guid: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mparam1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_2666943d.parquet","timestamp":"2025-10-11 12:08:34,811-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mparam1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_2666943d.parquet","timestamp":"2025-10-11 12:08:34,936-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:34 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:34 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_PARAMETRO
2025-10-11 12:08:34 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:34 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:34 - __main__ - INFO - ================================================================================
2025-10-11 12:08:34 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:34 - __main__ - INFO - üÜî Process GUID: 22c99bd6-b33e-400f-a8e8-4189da2d02b2
2025-10-11 12:08:34 - __main__ - INFO - üìä Records: 13
2025-10-11 12:08:34 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:34 - __main__ - INFO - ‚è±Ô∏è Time: 0.25s
2025-10-11 12:08:34 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:34 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_PRESENTACION... 
2025-10-11 12:08:35 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:35 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:35 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:35 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:35 - __main__ - INFO - üÜî Process GUID generado: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:36 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:36 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:36 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:36 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:36 - __main__ - INFO - ================================================================================
2025-10-11 12:08:36 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:36 - __main__ - INFO - ================================================================================
2025-10-11 12:08:36 - __main__ - INFO - üÜî Process GUID: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:36 - __main__ - INFO - üìä Table: M_PRESENTACION
2025-10-11 12:08:36 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:36 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:36 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:36 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:36 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:36 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:36 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:36 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:36 - __main__ - INFO - ================================================================================
2025-10-11 12:08:36 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:36 - __main__ - INFO - ================================================================================
2025-10-11 12:08:36 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:36 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:36 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:36 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:36 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:36 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:36 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:36 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_PRESENTACION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:36,202-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:36,202-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:36,445-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:36,445-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:36 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:36 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:36,732-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:36 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:36 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Table: M_PRESENTACION
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_presentacion'
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic2f'
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica2,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica2_corp'
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:36 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:36 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:36 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_PRESENTACION process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:36 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_PRESENTACION
2025-10-11 12:08:36 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:36 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:36 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:36 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:36 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:36 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:36 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_PRESENTACION process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:36 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:36,951-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:37,076-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:37 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - Table: M_PRESENTACION
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:37 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 18, Filters: 0
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica2)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica2, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica2_corp FROM bartic2f
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica2)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica2, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, califica2_corp FROM bartic2f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Rows returned: 401
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Columns: 13
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 401 rows
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç Processing chunk 1 with 401 rows
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 401 rows - process_guid: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0854e7d8.parquet","timestamp":"2025-10-11 12:08:37,107-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0854e7d8.parquet","timestamp":"2025-10-11 12:08:37,204-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:37 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:37 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_PRESENTACION
2025-10-11 12:08:37 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:37 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:37 - __main__ - INFO - ================================================================================
2025-10-11 12:08:37 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:37 - __main__ - INFO - üÜî Process GUID: c96e6f42-4b4b-4836-a7e4-b5d085abd42e
2025-10-11 12:08:37 - __main__ - INFO - üìä Records: 401
2025-10-11 12:08:37 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:37 - __main__ - INFO - ‚è±Ô∏è Time: 0.25s
2025-10-11 12:08:37 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:37 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_PROCEDIMIENTO... 
2025-10-11 12:08:38 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:38 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:38 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:38 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:38 - __main__ - INFO - üÜî Process GUID generado: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:38 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:38 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:38 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:38 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:38 - __main__ - INFO - ================================================================================
2025-10-11 12:08:38 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:38 - __main__ - INFO - ================================================================================
2025-10-11 12:08:38 - __main__ - INFO - üÜî Process GUID: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:38 - __main__ - INFO - üìä Table: M_PROCEDIMIENTO
2025-10-11 12:08:38 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:38 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:38 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:38 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:38 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:38 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:38 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:38 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:38 - __main__ - INFO - ================================================================================
2025-10-11 12:08:38 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:38 - __main__ - INFO - ================================================================================
2025-10-11 12:08:38 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:38 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:38 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:38 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:38 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:38 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:38 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:38 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_PROCEDIMIENTO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:38,482-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:38,482-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:38,720-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:38,720-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:38 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:38 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:38,999-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:39 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:39 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Table: M_PROCEDIMIENTO
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_procedimiento'
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Checking source_table: 'bproce1f'
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(docuproced)) docuproced, procedim,replace(replace(descproce1, char(13),''), char(10),'') descproce1,replace(replace(descproce2, char(13),''), char(10),'') descproce2, stsproced, flgvisible, motivo_traslado, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,case when liqdirecta = 0x46 then 'F' when liqdirecta = 0x54 then 'T' end liqdirecta, alcance, tipproc, cfop, codequiv,case when flgcontab = 0x46 then 'F' when flgcontab = 0x54 then 'T' end flgcontab,case when flglctcli = 0x46 then 'F' when flglctcli = 0x54 then 'T' end flglctcli, codequiv2, tipopersona,case when afectopago = 0x46 then 'F' when afectopago = 0x54 then 'T' end afectopago, tipopago,case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer, flglctvnd, ccostflet, flgvtbot'
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:39 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:39 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_PROCEDIMIENTO process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:39 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_PROCEDIMIENTO
2025-10-11 12:08:39 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:39 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:39 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:39 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:39 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:39 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:39 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_PROCEDIMIENTO process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:39 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:39,233-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:39,296-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:39 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Table: M_PROCEDIMIENTO
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:39 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 40, Filters: 0
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(docuproced)) + '|' + rtrim(ltrim(procedim)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(docuproced)) docuproced, procedim, replace(replace(descproce1, char(13), ''), char(10), '') descproce1, replace(replace(descproce2, char(13), ''), char(10), '') descproce2, stsproced, flgvisible, motivo_traslado, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, case when liqdirecta = 0x46 then 'F' when liqdirecta = 0x54 then 'T' end liqdirecta, alcance, tipproc, cfop, codequiv, case when flgcontab = 0x46 then 'F' when flgcontab = 0x54 then 'T' end flgcontab, case when flglctcli = 0x46 then 'F' when flglctcli = 0x54 then 'T' end flglctcli, codequiv2, tipopersona, case when afectopago = 0x46 then 'F' when afectopago = 0x54 then 'T' end afectopago, tipopago, case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer, flglctvnd, ccostflet, flgvtbot FROM bproce1f
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(docuproced)) + '|' + rtrim(ltrim(procedim)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, rtrim(ltrim(docuproced)) docuproced, procedim, replace(replace(descproce1, char(13), ''), char(10), '') descproce1, replace(replace(descproce2, char(13), ''), char(10), '') descproce2, stsproced, flgvisible, motivo_traslado, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, case when liqdirecta = 0x46 then 'F' when liqdirecta = 0x54 then 'T' end liqdirecta, alcance, tipproc, cfop, codequiv, case when flgcontab = 0x46 then 'F' when flgcontab = 0x54 then 'T' end flgcontab, case when flglctcli = 0x46 then 'F' when flglctcli = 0x54 then 'T' end flglctcli, codequiv2, tipopersona, case when afectopago = 0x46 then 'F' when afectopago = 0x54 then 'T' end afectopago, tipopago, case when flgrefer = 0x46 then 'F' when flgrefer = 0x54 then 'T' end flgrefer, flglctvnd, ccostflet, flgvtbot FROM bproce1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.08s
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Rows returned: 2,247
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Columns: 31
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 2,247 rows
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç Processing chunk 1 with 2247 rows
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 2247 rows - process_guid: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bproce1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d9e9b1f4.parquet","timestamp":"2025-10-11 12:08:39,405-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bproce1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d9e9b1f4.parquet","timestamp":"2025-10-11 12:08:39,514-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:39 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:39 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_PROCEDIMIENTO
2025-10-11 12:08:39 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:39 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:39 - __main__ - INFO - ================================================================================
2025-10-11 12:08:39 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:39 - __main__ - INFO - üÜî Process GUID: 88f96cba-9c3d-4433-a1d0-3de51e2d85c4
2025-10-11 12:08:39 - __main__ - INFO - üìä Records: 2,247
2025-10-11 12:08:39 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:39 - __main__ - INFO - ‚è±Ô∏è Time: 0.28s
2025-10-11 12:08:39 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:39 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_REGION... 
2025-10-11 12:08:40 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:40 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:40 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:40 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:40 - __main__ - INFO - üÜî Process GUID generado: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:40 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:40 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:40 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:40 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:40 - __main__ - INFO - ================================================================================
2025-10-11 12:08:40 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:40 - __main__ - INFO - ================================================================================
2025-10-11 12:08:40 - __main__ - INFO - üÜî Process GUID: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:40 - __main__ - INFO - üìä Table: M_REGION
2025-10-11 12:08:40 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:40 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:40 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:40 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:40 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:40 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:40 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:40 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:40 - __main__ - INFO - ================================================================================
2025-10-11 12:08:40 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:40 - __main__ - INFO - ================================================================================
2025-10-11 12:08:40 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:40 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:40 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:40 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:40 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:40 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:40 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:40 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_REGION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:40,896-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:40,896-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:41,135-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:41,135-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:41 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:41,420-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:41 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:41 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Table: M_REGION
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_region'
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Checking source_table: 'bregion1f'
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais, region,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,replace(replace(descorta, char(13),''), char(10),'') descorta, ciaperson,cast(cast(persona as int) as varchar(20)) persona, regprinc, region_corp'
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:41 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:41 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_REGION process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:41 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_REGION
2025-10-11 12:08:41 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:41 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:41 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:41 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:41 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:41 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:41 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_REGION process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:41 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:41,639-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:41,717-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:41 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Table: M_REGION
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:41 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 26, Filters: 0
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(region)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, region, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, ciaperson, cast(cast(persona as int) as varchar(20)) persona, regprinc, region_corp FROM bregion1f
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(region)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, region, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, ciaperson, cast(cast(persona as int) as varchar(20)) persona, regprinc, region_corp FROM bregion1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Rows returned: 14
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Columns: 17
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 14 rows
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç Processing chunk 1 with 14 rows
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 14 rows - process_guid: 3733b3b6-b587-4ba0-a993-4226a9984896
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bregion1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_3711597d.parquet","timestamp":"2025-10-11 12:08:41,732-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bregion1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_3711597d.parquet","timestamp":"2025-10-11 12:08:41,795-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:41 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:41 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_REGION
2025-10-11 12:08:41 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:41 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:41 - __main__ - INFO - ================================================================================
2025-10-11 12:08:41 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:41 - __main__ - INFO - üÜî Process GUID: 3733b3b6-b587-4ba0-a993-4226a9984896
2025-10-11 12:08:41 - __main__ - INFO - üìä Records: 14
2025-10-11 12:08:41 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:41 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:08:41 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:41 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_RUTA... 
2025-10-11 12:08:42 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:42 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:42 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:42 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:42 - __main__ - INFO - üÜî Process GUID generado: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:43 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:43 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:43 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:43 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:43 - __main__ - INFO - ================================================================================
2025-10-11 12:08:43 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:43 - __main__ - INFO - ================================================================================
2025-10-11 12:08:43 - __main__ - INFO - üÜî Process GUID: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:43 - __main__ - INFO - üìä Table: M_RUTA
2025-10-11 12:08:43 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:43 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:43 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:43 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:43 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:43 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:43 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:43 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:43 - __main__ - INFO - ================================================================================
2025-10-11 12:08:43 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:43 - __main__ - INFO - ================================================================================
2025-10-11 12:08:43 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:43 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:43 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:43 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:43 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:43 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:43 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:43 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_RUTA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:43,207-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:43,208-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:43,440-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:43,441-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:43 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:43 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:43,717-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:43 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:43 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Table: M_RUTA
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_ruta'
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Checking source_table: 'mestdi3f'
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(ruta as int) as varchar(20)) ruta,replace(replace(descruta, char(13),''), char(10),'') descruta,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(qcliruta as int) as varchar(20)) qcliruta, stsruta, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,cast(cast(codfvtas as int) as varchar(20)) codfvtas,rtrim(ltrim(sucursal)) sucursal, flgpeligro, modaten'
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:43 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:43 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_RUTA process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:43 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_RUTA
2025-10-11 12:08:43 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:43 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:43 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:43 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:43 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:43 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:43 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_RUTA process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:43 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:43,936-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:43,999-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:43 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Table: M_RUTA
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:43 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 24, Filters: 0
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) + '|' + cast(ruta as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(ruta as int) as varchar(20)) ruta, replace(replace(descruta, char(13), ''), char(10), '') descruta, cast(cast(vendedor as int) as varchar(20)) vendedor, cast(cast(zonadist as int) as varchar(20)) zonadist, cast(cast(qcliruta as int) as varchar(20)) qcliruta, stsruta, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cast(cast(codfvtas as int) as varchar(20)) codfvtas, rtrim(ltrim(sucursal)) sucursal, flgpeligro, modaten FROM mestdi3f
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(codfvtas as varchar(20)) + '|' + cast(ruta as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(ruta as int) as varchar(20)) ruta, replace(replace(descruta, char(13), ''), char(10), '') descruta, cast(cast(vendedor as int) as varchar(20)) vendedor, cast(cast(zonadist as int) as varchar(20)) zonadist, cast(cast(qcliruta as int) as varchar(20)) qcliruta, stsruta, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, cast(cast(codfvtas as int) as varchar(20)) codfvtas, rtrim(ltrim(sucursal)) sucursal, flgpeligro, modaten FROM mestdi3f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.05s
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1,139
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Columns: 19
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1,139 rows
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç Processing chunk 1 with 1139 rows
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 1139 rows - process_guid: 5023184a-ba22-4195-9a10-6a6fe9b93161
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_db1a4690.parquet","timestamp":"2025-10-11 12:08:44,061-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mestdi3f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_db1a4690.parquet","timestamp":"2025-10-11 12:08:44,170-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:44 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:44 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_RUTA
2025-10-11 12:08:44 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:44 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:44 - __main__ - INFO - ================================================================================
2025-10-11 12:08:44 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:44 - __main__ - INFO - üÜî Process GUID: 5023184a-ba22-4195-9a10-6a6fe9b93161
2025-10-11 12:08:44 - __main__ - INFO - üìä Records: 1,139
2025-10-11 12:08:44 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:44 - __main__ - INFO - ‚è±Ô∏è Time: 0.23s
2025-10-11 12:08:44 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:44 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_SABOR... 
2025-10-11 12:08:45 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:45 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:45 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:45 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:45 - __main__ - INFO - üÜî Process GUID generado: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:45 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:45 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:45 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:45 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:45 - __main__ - INFO - ================================================================================
2025-10-11 12:08:45 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:45 - __main__ - INFO - ================================================================================
2025-10-11 12:08:45 - __main__ - INFO - üÜî Process GUID: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:45 - __main__ - INFO - üìä Table: M_SABOR
2025-10-11 12:08:45 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:45 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:45 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:45 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:45 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:45 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:45 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:45 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:45 - __main__ - INFO - ================================================================================
2025-10-11 12:08:45 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:45 - __main__ - INFO - ================================================================================
2025-10-11 12:08:45 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:45 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:45 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:45 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:45 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:45 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:45 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:45 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_SABOR', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:45,563-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:45,563-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:45,803-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:45,803-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:45 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:45 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:46,077-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:46 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:46 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Table: M_SABOR
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_sabor'
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic4f'
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica4,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, regsalud, califica4_corp'
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:46 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:46 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_SABOR process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:46 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_SABOR
2025-10-11 12:08:46 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:46 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:46 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:46 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:46 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:46 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:46 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_SABOR process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:46 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:46,296-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:46,374-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:46 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Table: M_SABOR
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:46 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 19, Filters: 0
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica4)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica4, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, regsalud, califica4_corp FROM bartic4f
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica4)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica4, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, regsalud, califica4_corp FROM bartic4f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.19s
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Rows returned: 5,781
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Columns: 14
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 5,781 rows
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç Processing chunk 1 with 5781 rows
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 5781 rows - process_guid: d9d2d92e-ceb3-4c80-9608-76ed65552e54
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0157f229.parquet","timestamp":"2025-10-11 12:08:46,577-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_0157f229.parquet","timestamp":"2025-10-11 12:08:46,671-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:46 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:46 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_SABOR
2025-10-11 12:08:46 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:46 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:46 - __main__ - INFO - ================================================================================
2025-10-11 12:08:46 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:46 - __main__ - INFO - üÜî Process GUID: d9d2d92e-ceb3-4c80-9608-76ed65552e54
2025-10-11 12:08:46 - __main__ - INFO - üìä Records: 5,781
2025-10-11 12:08:46 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:46 - __main__ - INFO - ‚è±Ô∏è Time: 0.38s
2025-10-11 12:08:46 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:46 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_SUBFAMILIA... 
2025-10-11 12:08:47 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:47 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:47 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:47 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:47 - __main__ - INFO - üÜî Process GUID generado: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:48 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:48 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:48 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:48 - __main__ - INFO - ================================================================================
2025-10-11 12:08:48 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:48 - __main__ - INFO - ================================================================================
2025-10-11 12:08:48 - __main__ - INFO - üÜî Process GUID: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - __main__ - INFO - üìä Table: M_SUBFAMILIA
2025-10-11 12:08:48 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:48 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:48 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:48 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:48 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:48 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:48 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:48 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:48 - __main__ - INFO - ================================================================================
2025-10-11 12:08:48 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:48 - __main__ - INFO - ================================================================================
2025-10-11 12:08:48 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:48 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:48 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:48 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:48 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:48 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:48 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_SUBFAMILIA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:48,098-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:48,099-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:48,344-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:48,344-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:48 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:48,654-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:48 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:48 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Table: M_SUBFAMILIA
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_subfamilia'
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Checking source_table: 'msubfa1f'
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, linea, familia, subfamilia,replace(replace(descrip, char(13),''), char(10),'') descrip,replace(replace(descripcor, char(13),''), char(10),'') descripcor, compraloc, compraimpo, variaexist, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, subcategoria'
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:48 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:48 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_SUBFAMILIA process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_SUBFAMILIA
2025-10-11 12:08:48 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:48 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:48 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:48 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:48 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:48 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:48 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_SUBFAMILIA process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:48,904-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:48,982-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:48 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Table: M_SUBFAMILIA
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:48 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 28, Filters: 0
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:48 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) + '|' + rtrim(ltrim(familia)) + '|' + rtrim(ltrim(subfamilia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, familia, subfamilia, replace(replace(descrip, char(13), ''), char(10), '') descrip, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, compraloc, compraimpo, variaexist, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, subcategoria FROM msubfa1f
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:48 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(linea)) + '|' + rtrim(ltrim(familia)) + '|' + rtrim(ltrim(subfamilia)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, linea, familia, subfamilia, replace(replace(descrip, char(13), ''), char(10), '') descrip, replace(replace(descripcor, char(13), ''), char(10), '') descripcor, compraloc, compraimpo, variaexist, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, subcategoria FROM msubfa1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.08s
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - Rows returned: 2,533
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - Columns: 19
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 2,533 rows
2025-10-11 12:08:49 - core.orchestrator - INFO - üîç Processing chunk 1 with 2533 rows
2025-10-11 12:08:49 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 2533 rows - process_guid: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/msubfa1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ea54c67f.parquet","timestamp":"2025-10-11 12:08:49,076-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/msubfa1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ea54c67f.parquet","timestamp":"2025-10-11 12:08:49,201-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:49 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:49 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:49 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:49 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_SUBFAMILIA
2025-10-11 12:08:49 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:49 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:49 - __main__ - INFO - ================================================================================
2025-10-11 12:08:49 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:49 - __main__ - INFO - üÜî Process GUID: c26cbfc5-4a11-43aa-b451-d5abea5aad7a
2025-10-11 12:08:49 - __main__ - INFO - üìä Records: 2,533
2025-10-11 12:08:49 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:49 - __main__ - INFO - ‚è±Ô∏è Time: 0.30s
2025-10-11 12:08:49 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:49 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_SUBGIRO... 
2025-10-11 12:08:50 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:50 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:50 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:50 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:50 - __main__ - INFO - üÜî Process GUID generado: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:50 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:50 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:50 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:50 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:50 - __main__ - INFO - ================================================================================
2025-10-11 12:08:50 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:50 - __main__ - INFO - ================================================================================
2025-10-11 12:08:50 - __main__ - INFO - üÜî Process GUID: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:50 - __main__ - INFO - üìä Table: M_SUBGIRO
2025-10-11 12:08:50 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:50 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:50 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:50 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:50 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:50 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:50 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:50 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:50 - __main__ - INFO - ================================================================================
2025-10-11 12:08:50 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:50 - __main__ - INFO - ================================================================================
2025-10-11 12:08:50 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:50 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:50 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:50 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:50 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:50 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:50 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:50 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_SUBGIRO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:50,618-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:50,618-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:50,877-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:50,877-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:50 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:50 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:51,155-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:51 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:51 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Table: M_SUBGIRO
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_subgiro'
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Checking source_table: 'bsgiro1f'
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecmodi,horamodi) lastmodifydate, compania, subgiro,replace(replace(descsgiro, char(13),''), char(10),'') descsgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi'
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:51 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:51 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_SUBGIRO process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:51 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_SUBGIRO
2025-10-11 12:08:51 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:51 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:51 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:51 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:51 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:51 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:51 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_SUBGIRO process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:51 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:51,390-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:51,452-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:51 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Table: M_SUBGIRO
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:51 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(subgiro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, subgiro, replace(replace(descsgiro, char(13), ''), char(10), '') descsgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM bsgiro1f
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(subgiro)) as id, dbo.func_cas_todatetime(fecmodi, horamodi) lastmodifydate, compania, subgiro, replace(replace(descsgiro, char(13), ''), char(10), '') descsgiro, estsgiro, usuacrea, feccrea, horacrea, usuamodi, fecmodi, horamodi FROM bsgiro1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.16s
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Rows returned: 4,048
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 4,048 rows
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç Processing chunk 1 with 4048 rows
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 4048 rows - process_guid: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bsgiro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ff4321e7.parquet","timestamp":"2025-10-11 12:08:51,655-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bsgiro1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ff4321e7.parquet","timestamp":"2025-10-11 12:08:51,718-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:51 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:51 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_SUBGIRO
2025-10-11 12:08:51 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:51 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:51 - __main__ - INFO - ================================================================================
2025-10-11 12:08:51 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:51 - __main__ - INFO - üÜî Process GUID: 47dfb3dd-b0d2-4dd6-84dd-23a880d776d9
2025-10-11 12:08:51 - __main__ - INFO - üìä Records: 4,048
2025-10-11 12:08:51 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:51 - __main__ - INFO - ‚è±Ô∏è Time: 0.33s
2025-10-11 12:08:51 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:51 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_SUBREGION... 
2025-10-11 12:08:52 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:52 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:52 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:52 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:52 - __main__ - INFO - üÜî Process GUID generado: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:53 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:53 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:53 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:53 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:53 - __main__ - INFO - ================================================================================
2025-10-11 12:08:53 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:53 - __main__ - INFO - ================================================================================
2025-10-11 12:08:53 - __main__ - INFO - üÜî Process GUID: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:53 - __main__ - INFO - üìä Table: M_SUBREGION
2025-10-11 12:08:53 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:53 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:53 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:53 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:53 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:53 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:53 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:53 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:53 - __main__ - INFO - ================================================================================
2025-10-11 12:08:53 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:53 - __main__ - INFO - ================================================================================
2025-10-11 12:08:53 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:53 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:53 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:53 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:53 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:53 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:53 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:53 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_SUBREGION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:53,189-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:53,189-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:53,420-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:53,420-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:53 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:53 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:53,719-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:53 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:53 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Table: M_SUBREGION
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_subregion'
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - Checking source_table: 'bregion2f'
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate,rtrim(ltrim(pais)) pais, region, subregion,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,replace(replace(descorta, char(13),''), char(10),'') descorta, ciaperson,cast(cast(persona as int) as varchar(20)) persona, subregprinc, subregion_corp'
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:53 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:53 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:53 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_SUBREGION process_guid: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:53 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_SUBREGION
2025-10-11 12:08:53 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:53 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:53 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:53 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:53 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:53 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:53 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_SUBREGION process_guid: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:53 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:53,972-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:54,076-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:54 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - Table: M_SUBREGION
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:54 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 27, Filters: 0
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(region)) + '|' + rtrim(ltrim(subregion)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, region, subregion, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, ciaperson, cast(cast(persona as int) as varchar(20)) persona, subregprinc, subregion_corp FROM bregion2f
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(pais)) + '|' + rtrim(ltrim(region)) + '|' + rtrim(ltrim(subregion)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, rtrim(ltrim(pais)) pais, region, subregion, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, replace(replace(descorta, char(13), ''), char(10), '') descorta, ciaperson, cast(cast(persona as int) as varchar(20)) persona, subregprinc, subregion_corp FROM bregion2f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - Rows returned: 0
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - Columns: 18
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - WARNING - Query returned empty result
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:54 - core.orchestrator - INFO - üîç No watermark to save
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bregion2f/year=2025/month=10/day=11/data_thread_0_chunk_0_698cc39d.parquet","timestamp":"2025-10-11 12:08:54,092-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bregion2f/year=2025/month=10/day=11/data_thread_0_chunk_0_698cc39d.parquet","timestamp":"2025-10-11 12:08:54,161-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:54 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table M_SUBREGION
2025-10-11 12:08:54 - bigmagic-monitor - WARNING - Advertencia procesando tabla M_SUBREGION: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:08:54 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:54 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:08:54 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:54 - __main__ - INFO - ================================================================================
2025-10-11 12:08:54 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:54 - __main__ - INFO - üÜî Process GUID: 771b5c6b-8a13-40e7-a9c6-8132a25a2d7f
2025-10-11 12:08:54 - __main__ - INFO - üìä Records: 0
2025-10-11 12:08:54 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:54 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:08:54 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:54 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_SUCURSAL... 
2025-10-11 12:08:55 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:55 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:55 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:55 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:55 - __main__ - INFO - üÜî Process GUID generado: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:55 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:55 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:55 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:55 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:55 - __main__ - INFO - ================================================================================
2025-10-11 12:08:55 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:55 - __main__ - INFO - ================================================================================
2025-10-11 12:08:55 - __main__ - INFO - üÜî Process GUID: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:55 - __main__ - INFO - üìä Table: M_SUCURSAL
2025-10-11 12:08:55 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:55 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:55 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:55 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:55 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:55 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:55 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:55 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:55 - __main__ - INFO - ================================================================================
2025-10-11 12:08:55 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:55 - __main__ - INFO - ================================================================================
2025-10-11 12:08:55 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:55 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:55 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:55 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:55 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:55 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:55 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:55 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_SUCURSAL', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:55,556-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:55,556-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:55,795-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:55,795-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:55 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:55 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:56,061-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:56 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:56 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Table: M_SUCURSAL
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_sucursal'
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Checking source_table: 'tcompa2f'
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,replace(replace(nombre, char(13),''), char(10),'') nombre,replace(replace(direccion, char(13),''), char(10),'') direccion, zonapostal, telefono1, telefono2, fax, responsabl, fecoper, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,case when esplanta = 0x46 then 'F' when esplanta = 0x54 then 'T' end esplanta,case when escomercia = 0x46 then 'F' when escomercia = 0x54 then 'T' end escomercia,case when dscimp = 0x46 then 'F' when dscimp = 0x54 then 'T' end dscimp,case when incobsenv = 0x46 then 'F' when incobsenv = 0x54 then 'T' end incobsenv,case when titbon = 0x46 then 'F' when titbon = 0x54 then 'T' end titbon,case when impteimpto = 0x46 then 'F' when impteimpto = 0x54 then 'T' end impteimpto, numlinguia,case when ptmoenv = 0x46 then 'F' when ptmoenv = 0x54 then 'T' end ptmoenv,case when vtaconsig = 0x46 then 'F' when vtaconsig = 0x54 then 'T' end vtaconsig, sucrep, tiposuc,case when flgcont13 = 0x46 then 'F' when flgcont13 = 0x54 then 'T' end flgcont13, ctrlpresu,case when flgvaligv = 0x46 then 'F' when flgvaligv = 0x54 then 'T' end flgvaligv, undneg,case when flgcodbar = 0x46 then 'F' when flgcodbar = 0x54 then 'T' end flgcodbar, cedis,case when flgfolliq = 0x46 then 'F' when flgfolliq = 0x54 then 'T' end flgfolliq,case when flgmodlp = 0x46 then 'F' when flgmodlp = 0x54 then 'T' end flgmodlp,case when flgcont3 = 0x46 then 'F' when flgcont3 = 0x54 then 'T' end flgcont3,case when flgcont4 = 0x46 then 'F' when flgcont4 = 0x54 then 'T' end flgcont4,case when flgcont5 = 0x46 then 'F' when flgcont5 = 0x54 then 'T' end flgcont5, validadep, ruc, inscestadu, inscmunici, unidfisca, codidenti, localidad,case when facpropco = 0x46 then 'F' when facpropco = 0x54 then 'T' end facpropco,cast(cast(cliente as int) as varchar(20)) cliente,cast(cast(cvecuotad as int) as varchar(20)) cvecuotad,case when flgcont6 = 0x46 then 'F' when flgcont6 = 0x54 then 'T' end flgcont6,case when flgcont7 = 0x46 then 'F' when flgcont7 = 0x54 then 'T' end flgcont7,case when flgcont8 = 0x46 then 'F' when flgcont8 = 0x54 then 'T' end flgcont8,case when flgcont9 = 0x46 then 'F' when flgcont9 = 0x54 then 'T' end flgcont9, equival1, equival2,case when cedi = 0x46 then 'F' when cedi = 0x54 then 'T' end cedi,case when flgccodbar = 0x46 then 'F' when flgccodbar = 0x54 then 'T' end flgccodbar,case when flgdifcamb = 0x46 then 'F' when flgdifcamb = 0x54 then 'T' end flgdifcamb'
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:56 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:56 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_SUCURSAL process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:56 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_SUCURSAL
2025-10-11 12:08:56 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:56 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:56 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:56 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:56 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:56 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:56 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_SUCURSAL process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:56 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:56,295-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:56,358-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:56 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Table: M_SUCURSAL
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:56 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 69, Filters: 0
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, replace(replace(nombre, char(13), ''), char(10), '') nombre, replace(replace(direccion, char(13), ''), char(10), '') direccion, zonapostal, telefono1, telefono2, fax, responsabl, fecoper, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when esplanta = 0x46 then 'F' when esplanta = 0x54 then 'T' end esplanta, case when escomercia = 0x46 then 'F' when escomercia = 0x54 then 'T' end escomercia, case when dscimp = 0x46 then 'F' when dscimp = 0x54 then 'T' end dscimp, case when incobsenv = 0x46 then 'F' when incobsenv = 0x54 then 'T' end incobsenv, case when titbon = 0x46 then 'F' when titbon = 0x54 then 'T' end titbon, case when impteimpto = 0x46 then 'F' when impteimpto = 0x54 then 'T' end impteimpto, numlinguia, case when ptmoenv = 0x46 then 'F' when ptmoenv = 0x54 then 'T' end ptmoenv, case when vtaconsig = 0x46 then 'F' when vtaconsig = 0x54 then 'T' end vtaconsig, sucrep, tiposuc, case when flgcont13 = 0x46 then 'F' when flgcont13 = 0x54 then 'T' end flgcont13, ctrlpresu, case when flgvaligv = 0x46 then 'F' when flgvaligv = 0x54 then 'T' end flgvaligv, undneg, case when flgcodbar = 0x46 then 'F' when flgcodbar = 0x54 then 'T' end flgcodbar, cedis, case when flgfolliq = 0x46 then 'F' when flgfolliq = 0x54 then 'T' end flgfolliq, case when flgmodlp = 0x46 then 'F' when flgmodlp = 0x54 then 'T' end flgmodlp, case when flgcont3 = 0x46 then 'F' when flgcont3 = 0x54 then 'T' end flgcont3, case when flgcont4 = 0x46 then 'F' when flgcont4 = 0x54 then 'T' end flgcont4, case when flgcont5 = 0x46 then 'F' when flgcont5 = 0x54 then 'T' end flgcont5, validadep, ruc, inscestadu, inscmunici, unidfisca, codidenti, localidad, case when facpropco = 0x46 then 'F' when facpropco = 0x54 then 'T' end facpropco, cast(cast(cliente as int) as varchar(20)) cliente, cast(cast(cvecuotad as int) as varchar(20)) cvecuotad, case when flgcont6 = 0x46 then 'F' when flgcont6 = 0x54 then 'T' end flgcont6, case when flgcont7 = 0x46 then 'F' when flgcont7 = 0x54 then 'T' end flgcont7, case when flgcont8 = 0x46 then 'F' when flgcont8 = 0x54 then 'T' end flgcont8, case when flgcont9 = 0x46 then 'F' when flgcont9 = 0x54 then 'T' end flgcont9, equival1, equival2, case when cedi = 0x46 then 'F' when cedi = 0x54 then 'T' end cedi, case when flgccodbar = 0x46 then 'F' when flgccodbar = 0x54 then 'T' end flgccodbar, case when flgdifcamb = 0x46 then 'F' when flgdifcamb = 0x54 then 'T' end flgdifcamb FROM tcompa2f
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, rtrim(ltrim(sucursal)) sucursal, replace(replace(nombre, char(13), ''), char(10), '') nombre, replace(replace(direccion, char(13), ''), char(10), '') direccion, zonapostal, telefono1, telefono2, fax, responsabl, fecoper, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when esplanta = 0x46 then 'F' when esplanta = 0x54 then 'T' end esplanta, case when escomercia = 0x46 then 'F' when escomercia = 0x54 then 'T' end escomercia, case when dscimp = 0x46 then 'F' when dscimp = 0x54 then 'T' end dscimp, case when incobsenv = 0x46 then 'F' when incobsenv = 0x54 then 'T' end incobsenv, case when titbon = 0x46 then 'F' when titbon = 0x54 then 'T' end titbon, case when impteimpto = 0x46 then 'F' when impteimpto = 0x54 then 'T' end impteimpto, numlinguia, case when ptmoenv = 0x46 then 'F' when ptmoenv = 0x54 then 'T' end ptmoenv, case when vtaconsig = 0x46 then 'F' when vtaconsig = 0x54 then 'T' end vtaconsig, sucrep, tiposuc, case when flgcont13 = 0x46 then 'F' when flgcont13 = 0x54 then 'T' end flgcont13, ctrlpresu, case when flgvaligv = 0x46 then 'F' when flgvaligv = 0x54 then 'T' end flgvaligv, undneg, case when flgcodbar = 0x46 then 'F' when flgcodbar = 0x54 then 'T' end flgcodbar, cedis, case when flgfolliq = 0x46 then 'F' when flgfolliq = 0x54 then 'T' end flgfolliq, case when flgmodlp = 0x46 then 'F' when flgmodlp = 0x54 then 'T' end flgmodlp, case when flgcont3 = 0x46 then 'F' when flgcont3 = 0x54 then 'T' end flgcont3, case when flgcont4 = 0x46 then 'F' when flgcont4 = 0x54 then 'T' end flgcont4, case when flgcont5 = 0x46 then 'F' when flgcont5 = 0x54 then 'T' end flgcont5, validadep, ruc, inscestadu, inscmunici, unidfisca, codidenti, localidad, case when facpropco = 0x46 then 'F' when facpropco = 0x54 then 'T' end facpropco, cast(cast(cliente as int) as varchar(20)) cliente, cast(cast(cvecuotad as int) as varchar(20)) cvecuotad, case when flgcont6 = 0x46 then 'F' when flgcont6 = 0x54 then 'T' end flgcont6, case when flgcont7 = 0x46 then 'F' when flgcont7 = 0x54 then 'T' end flgcont7, case when flgcont8 = 0x46 then 'F' when flgcont8 = 0x54 then 'T' end flgcont8, case when flgcont9 = 0x46 then 'F' when flgcont9 = 0x54 then 'T' end flgcont9, equival1, equival2, case when cedi = 0x46 then 'F' when cedi = 0x54 then 'T' end cedi, case when flgccodbar = 0x46 then 'F' when flgccodbar = 0x54 then 'T' end flgccodbar, case when flgdifcamb = 0x46 then 'F' when flgdifcamb = 0x54 then 'T' end flgdifcamb FROM tcompa2f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Rows returned: 42
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Columns: 60
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 42 rows
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç Processing chunk 1 with 42 rows
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 42 rows - process_guid: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcompa2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_de157eb9.parquet","timestamp":"2025-10-11 12:08:56,389-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tcompa2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_de157eb9.parquet","timestamp":"2025-10-11 12:08:56,499-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:56 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:56 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_SUCURSAL
2025-10-11 12:08:56 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:56 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:56 - __main__ - INFO - ================================================================================
2025-10-11 12:08:56 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:56 - __main__ - INFO - üÜî Process GUID: ebb20755-761f-4c14-ba5b-a4dc5199e1b6
2025-10-11 12:08:56 - __main__ - INFO - üìä Records: 42
2025-10-11 12:08:56 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:56 - __main__ - INFO - ‚è±Ô∏è Time: 0.20s
2025-10-11 12:08:56 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:56 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_DOCUMENTO... 
2025-10-11 12:08:57 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:57 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:57 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:57 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:57 - __main__ - INFO - üÜî Process GUID generado: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:57 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:57 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:57 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:08:57 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:08:57 - __main__ - INFO - ================================================================================
2025-10-11 12:08:57 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:08:57 - __main__ - INFO - ================================================================================
2025-10-11 12:08:57 - __main__ - INFO - üÜî Process GUID: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:57 - __main__ - INFO - üìä Table: M_TIPO_DOCUMENTO
2025-10-11 12:08:57 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:08:57 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:08:57 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:08:57 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:08:57 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:08:57 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:08:57 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:08:57 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:08:57 - __main__ - INFO - ================================================================================
2025-10-11 12:08:57 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:08:57 - __main__ - INFO - ================================================================================
2025-10-11 12:08:57 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:57 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:08:57 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:08:57 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:08:57 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:08:57 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:08:57 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:08:57 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_DOCUMENTO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:57,837-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:57,837-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:08:58,082-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:08:58,082-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:08:58 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:58,381-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:58 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:08:58 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Table: M_TIPO_DOCUMENTO
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_documento'
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Checking source_table: 'mdocum4f'
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, tipodoc,replace(replace(descrip, char(13),''), char(10),'') descrip, tipo, flgtipfact,case when flgctrlcaja = 0x46 then 'F' when flgctrlcaja = 0x54 then 'T' end flgctrlcaja,case when flgcorxcja = 0x46 then 'F' when flgcorxcja = 0x54 then 'T' end flgcorxcja,case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod,case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto'
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:08:58 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:08:58 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_DOCUMENTO process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:58 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_DOCUMENTO
2025-10-11 12:08:58 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:58 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:08:58 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:08:58 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:08:58 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:08:58 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:08:58 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_DOCUMENTO process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:58 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:08:58,624-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:08:58,691-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:58 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Table: M_TIPO_DOCUMENTO
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:08:58 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 23, Filters: 0
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(tipodoc)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, tipodoc, replace(replace(descrip, char(13), ''), char(10), '') descrip, tipo, flgtipfact, case when flgctrlcaja = 0x46 then 'F' when flgctrlcaja = 0x54 then 'T' end flgctrlcaja, case when flgcorxcja = 0x46 then 'F' when flgcorxcja = 0x54 then 'T' end flgcorxcja, case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto FROM mdocum4f
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(tipodoc)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, tipodoc, replace(replace(descrip, char(13), ''), char(10), '') descrip, tipo, flgtipfact, case when flgctrlcaja = 0x46 then 'F' when flgctrlcaja = 0x54 then 'T' end flgctrlcaja, case when flgcorxcja = 0x46 then 'F' when flgcorxcja = 0x54 then 'T' end flgcorxcja, case when flgimport = 0x46 then 'F' when flgimport = 0x54 then 'T' end flgimport, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, case when flgpresupuesto = 0x46 then 'F' when flgpresupuesto = 0x54 then 'T' end flgpresupuesto FROM mdocum4f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Rows returned: 659
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Columns: 18
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 659 rows
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç Processing chunk 1 with 659 rows
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 659 rows - process_guid: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_3bc8e447.parquet","timestamp":"2025-10-11 12:08:58,733-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum4f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_3bc8e447.parquet","timestamp":"2025-10-11 12:08:58,796-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:08:58 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:08:58 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_DOCUMENTO
2025-10-11 12:08:58 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:08:58 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:08:58 - __main__ - INFO - ================================================================================
2025-10-11 12:08:58 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:08:58 - __main__ - INFO - üÜî Process GUID: 480f9efa-12fb-4f56-9ce5-0ed8256e3afe
2025-10-11 12:08:58 - __main__ - INFO - üìä Records: 659
2025-10-11 12:08:58 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:08:58 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:08:58 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:08:58 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_ENVASE... 
2025-10-11 12:08:59 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:08:59 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:08:59 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:08:59 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:08:59 - __main__ - INFO - üÜî Process GUID generado: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:00 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:00 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:00 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:00 - __main__ - INFO - ================================================================================
2025-10-11 12:09:00 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:00 - __main__ - INFO - ================================================================================
2025-10-11 12:09:00 - __main__ - INFO - üÜî Process GUID: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - __main__ - INFO - üìä Table: M_TIPO_ENVASE
2025-10-11 12:09:00 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:00 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:00 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:00 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:00 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:00 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:00 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:00 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:00 - __main__ - INFO - ================================================================================
2025-10-11 12:09:00 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:00 - __main__ - INFO - ================================================================================
2025-10-11 12:09:00 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:00 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:00 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:00 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:00 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:00 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:00 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_ENVASE', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:00,164-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:00,164-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:00,405-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:00,405-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:00 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:00,686-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:00 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:00 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Table: M_TIPO_ENVASE
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_envase'
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Checking source_table: 'bartic9f'
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, califica9,replace(replace(descrip, char(13),''), char(10),'') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:00 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:00 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_ENVASE process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_ENVASE
2025-10-11 12:09:00 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:00 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:00 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:00 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:00 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:00 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:00 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_ENVASE process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:00,905-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:00,967-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:00 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Table: M_TIPO_ENVASE
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:00 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica9)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica9, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic9f
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(califica9)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, califica9, replace(replace(descrip, char(13), ''), char(10), '') descrip, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM bartic9f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Rows returned: 70
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:09:00 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 70 rows
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç Processing chunk 1 with 70 rows
2025-10-11 12:09:00 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 70 rows - process_guid: 0f8b0f48-645f-40ad-ba40-f86de37581cc
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic9f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_30bda109.parquet","timestamp":"2025-10-11 12:09:00,983-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/bartic9f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_30bda109.parquet","timestamp":"2025-10-11 12:09:01,045-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:01 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:01 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:01 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:01 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:01 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_ENVASE
2025-10-11 12:09:01 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:01 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:01 - __main__ - INFO - ================================================================================
2025-10-11 12:09:01 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:01 - __main__ - INFO - üÜî Process GUID: 0f8b0f48-645f-40ad-ba40-f86de37581cc
2025-10-11 12:09:01 - __main__ - INFO - üìä Records: 70
2025-10-11 12:09:01 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:01 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:09:01 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:01 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_OPERACION... 
2025-10-11 12:09:02 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:02 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:02 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:02 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:02 - __main__ - INFO - üÜî Process GUID generado: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:02 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:02 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:02 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:02 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:02 - __main__ - INFO - ================================================================================
2025-10-11 12:09:02 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:02 - __main__ - INFO - ================================================================================
2025-10-11 12:09:02 - __main__ - INFO - üÜî Process GUID: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:02 - __main__ - INFO - üìä Table: M_TIPO_OPERACION
2025-10-11 12:09:02 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:02 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:02 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:02 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:02 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:02 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:02 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:02 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:02 - __main__ - INFO - ================================================================================
2025-10-11 12:09:02 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:02 - __main__ - INFO - ================================================================================
2025-10-11 12:09:02 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:02 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:02 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:02 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:02 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:02 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:02 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:02 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_OPERACION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:02,363-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:02,363-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:02,582-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:02,582-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:02 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:02 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:02,875-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:02 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:02 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Table: M_TIPO_OPERACION
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_operacion'
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - Checking source_table: 'btipopera1f'
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, tipoper,replace(replace(descrip, char(13),''), char(10),'') descrip, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod'
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:02 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:02 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:02 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_OPERACION process_guid: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:02 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_OPERACION
2025-10-11 12:09:03 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:03 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:03 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:03 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:03 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:03 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:03 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_OPERACION process_guid: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:03 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:03,094-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:03,156-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:03 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - Table: M_TIPO_OPERACION
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:03 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 15, Filters: 0
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(tipoper)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, tipoper, replace(replace(descrip, char(13), ''), char(10), '') descrip, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM btipopera1f
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(tipoper)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, tipoper, replace(replace(descrip, char(13), ''), char(10), '') descrip, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod FROM btipopera1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - Rows returned: 0
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - Columns: 10
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - WARNING - Query returned empty result
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:03 - core.orchestrator - INFO - üîç No watermark to save
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btipopera1f/year=2025/month=10/day=11/data_thread_0_chunk_0_83f705fb.parquet","timestamp":"2025-10-11 12:09:03,192-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btipopera1f/year=2025/month=10/day=11/data_thread_0_chunk_0_83f705fb.parquet","timestamp":"2025-10-11 12:09:03,248-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:03 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table M_TIPO_OPERACION
2025-10-11 12:09:03 - bigmagic-monitor - WARNING - Advertencia procesando tabla M_TIPO_OPERACION: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:09:03 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:03 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:09:03 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:03 - __main__ - INFO - ================================================================================
2025-10-11 12:09:03 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:03 - __main__ - INFO - üÜî Process GUID: 1301f322-4d5d-41b2-a92f-20e634151eec
2025-10-11 12:09:03 - __main__ - INFO - üìä Records: 0
2025-10-11 12:09:03 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:03 - __main__ - INFO - ‚è±Ô∏è Time: 0.15s
2025-10-11 12:09:03 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:03 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_TRANSACCION... 
2025-10-11 12:09:04 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:04 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:04 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:04 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:04 - __main__ - INFO - üÜî Process GUID generado: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:04 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:04 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:04 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:04 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:04 - __main__ - INFO - ================================================================================
2025-10-11 12:09:04 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:04 - __main__ - INFO - ================================================================================
2025-10-11 12:09:04 - __main__ - INFO - üÜî Process GUID: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:04 - __main__ - INFO - üìä Table: M_TIPO_TRANSACCION
2025-10-11 12:09:04 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:04 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:04 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:04 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:04 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:04 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:04 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:04 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:04 - __main__ - INFO - ================================================================================
2025-10-11 12:09:04 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:04 - __main__ - INFO - ================================================================================
2025-10-11 12:09:04 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:04 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:04 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:04 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:04 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:04 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:04 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:04 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_TRANSACCION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:04,611-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:04,611-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:04,844-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:04,844-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:04 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:05,125-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:05 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:05 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Table: M_TIPO_TRANSACCION
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_transaccion'
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Checking source_table: 'mdocum8f'
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania, transprinc, transaccio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod'
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:05 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:05 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_TRANSACCION process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:05 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_TRANSACCION
2025-10-11 12:09:05 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:05 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:05 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:05 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:05 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:05 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:05 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_TRANSACCION process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:05 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:05,360-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:05,422-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:05 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Table: M_TIPO_TRANSACCION
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:05 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 13, Filters: 0
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transprinc)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, transprinc, transaccio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mdocum8f
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(transprinc)) + '|' + rtrim(ltrim(transaccio)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, transprinc, transaccio, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod FROM mdocum8f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.09s
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Rows returned: 4,424
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 4,424 rows
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç Processing chunk 1 with 4424 rows
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 4424 rows - process_guid: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_6037d39e.parquet","timestamp":"2025-10-11 12:09:05,547-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mdocum8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_6037d39e.parquet","timestamp":"2025-10-11 12:09:05,641-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:05 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:05 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_TRANSACCION
2025-10-11 12:09:05 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:05 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:05 - __main__ - INFO - ================================================================================
2025-10-11 12:09:05 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:05 - __main__ - INFO - üÜî Process GUID: ffdc70c4-ded4-45e4-8e19-238c5d3d28bd
2025-10-11 12:09:05 - __main__ - INFO - üìä Records: 4,424
2025-10-11 12:09:05 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:05 - __main__ - INFO - ‚è±Ô∏è Time: 0.28s
2025-10-11 12:09:05 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:05 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_TRANSPORTISTA... 
2025-10-11 12:09:06 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:06 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:06 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:06 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:06 - __main__ - INFO - üÜî Process GUID generado: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:06 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:06 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:06 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:06 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:06 - __main__ - INFO - ================================================================================
2025-10-11 12:09:06 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:06 - __main__ - INFO - ================================================================================
2025-10-11 12:09:06 - __main__ - INFO - üÜî Process GUID: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:06 - __main__ - INFO - üìä Table: M_TIPO_TRANSPORTISTA
2025-10-11 12:09:06 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:06 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:06 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:06 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:06 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:06 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:06 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:06 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:06 - __main__ - INFO - ================================================================================
2025-10-11 12:09:06 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:06 - __main__ - INFO - ================================================================================
2025-10-11 12:09:06 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:06 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:06 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:06 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:06 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:06 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:06 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:06 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_TRANSPORTISTA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:06,941-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:06,942-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:07,156-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:07,158-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:07 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:07,420-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:07 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:07 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Table: M_TIPO_TRANSPORTISTA
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_transportista'
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Checking source_table: 'btitra1f'
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, tiptranspo, descttran1, ststitran, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod'
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:07 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:07 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_TRANSPORTISTA process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:07 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_TRANSPORTISTA
2025-10-11 12:09:07 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:07 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:07 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:07 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:07 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:07 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:07 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_TRANSPORTISTA process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:07 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:07,655-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:07,733-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:07 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Table: M_TIPO_TRANSPORTISTA
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:07 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 13, Filters: 0
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(tiptranspo)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, tiptranspo, descttran1, ststitran, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM btitra1f
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(tiptranspo)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, tiptranspo, descttran1, ststitran, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM btitra1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Rows returned: 60
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 60 rows
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç Processing chunk 1 with 60 rows
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 60 rows - process_guid: 26912bc1-dce7-4806-bee8-e0f930b40f69
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btitra1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9bd3b71a.parquet","timestamp":"2025-10-11 12:09:07,748-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btitra1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_9bd3b71a.parquet","timestamp":"2025-10-11 12:09:07,811-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:07 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:07 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_TRANSPORTISTA
2025-10-11 12:09:07 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:07 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:07 - __main__ - INFO - ================================================================================
2025-10-11 12:09:07 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:07 - __main__ - INFO - üÜî Process GUID: 26912bc1-dce7-4806-bee8-e0f930b40f69
2025-10-11 12:09:07 - __main__ - INFO - üìä Records: 60
2025-10-11 12:09:07 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:07 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:09:07 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:07 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TRANSPORTISTA... 
2025-10-11 12:09:08 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:08 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:08 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:08 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:08 - __main__ - INFO - üÜî Process GUID generado: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:09 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:09 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:09 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:09 - __main__ - INFO - ================================================================================
2025-10-11 12:09:09 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:09 - __main__ - INFO - ================================================================================
2025-10-11 12:09:09 - __main__ - INFO - üÜî Process GUID: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - __main__ - INFO - üìä Table: M_TRANSPORTISTA
2025-10-11 12:09:09 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:09 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:09 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:09 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:09 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:09 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:09 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:09 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:09 - __main__ - INFO - ================================================================================
2025-10-11 12:09:09 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:09 - __main__ - INFO - ================================================================================
2025-10-11 12:09:09 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:09 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:09 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:09 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:09 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:09 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:09 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TRANSPORTISTA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:09,140-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:09,140-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:09,373-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:09,374-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:09 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:09,641-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:09 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:09 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Table: M_TRANSPORTISTA
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_transportista'
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Checking source_table: 'mperso8f'
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, transport, tiptranspo, sucursal, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod'
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:09 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:09 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TRANSPORTISTA process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TRANSPORTISTA
2025-10-11 12:09:09 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:09 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:09 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:09 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:09 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:09 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:09 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TRANSPORTISTA process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:09,860-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:09,922-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:09 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Table: M_TRANSPORTISTA
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:09 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 13, Filters: 0
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(transport)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, transport, tiptranspo, sucursal, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mperso8f
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(transport)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, transport, tiptranspo, sucursal, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mperso8f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Rows returned: 238
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Columns: 12
2025-10-11 12:09:09 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 238 rows
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç Processing chunk 1 with 238 rows
2025-10-11 12:09:09 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 238 rows - process_guid: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mperso8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_63780acf.parquet","timestamp":"2025-10-11 12:09:09,938-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mperso8f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_63780acf.parquet","timestamp":"2025-10-11 12:09:10,000-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:10 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:10 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:10 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:10 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:10 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:10 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:10 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TRANSPORTISTA
2025-10-11 12:09:10 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:10 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:10 - __main__ - INFO - ================================================================================
2025-10-11 12:09:10 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:10 - __main__ - INFO - üÜî Process GUID: f9d55b1d-c83d-4563-9c91-4a5ad0ed760e
2025-10-11 12:09:10 - __main__ - INFO - üìä Records: 238
2025-10-11 12:09:10 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:10 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:09:10 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:10 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_TIPO_VEHICULO... 
2025-10-11 12:09:11 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:11 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:11 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:11 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:11 - __main__ - INFO - üÜî Process GUID generado: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:11 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:11 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:11 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:11 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:11 - __main__ - INFO - ================================================================================
2025-10-11 12:09:11 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:11 - __main__ - INFO - ================================================================================
2025-10-11 12:09:11 - __main__ - INFO - üÜî Process GUID: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:11 - __main__ - INFO - üìä Table: M_TIPO_VEHICULO
2025-10-11 12:09:11 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:11 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:11 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:11 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:11 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:11 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:11 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:11 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:11 - __main__ - INFO - ================================================================================
2025-10-11 12:09:11 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:11 - __main__ - INFO - ================================================================================
2025-10-11 12:09:11 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:11 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:11 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:11 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:11 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:11 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:11 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:11 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_TIPO_VEHICULO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:11,297-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:11,297-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:11,517-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:11,518-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:11 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:11 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:11,812-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:11 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:11 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Table: M_TIPO_VEHICULO
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_tipo_vehiculo'
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - Checking source_table: 'btiveh1f'
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, tipvehicu, desctvehi1, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod'
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:11 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:11 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:11 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_TIPO_VEHICULO process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:11 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_TIPO_VEHICULO
2025-10-11 12:09:12 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:12 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:12 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:12 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:12 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:12 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:12 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_TIPO_VEHICULO process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:12 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:12,031-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:12,109-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:12 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - Table: M_TIPO_VEHICULO
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:12 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 12, Filters: 0
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(tipvehicu)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, tipvehicu, desctvehi1, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM btiveh1f
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(tipvehicu)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, tipvehicu, desctvehi1, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM btiveh1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.00s
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Rows returned: 96
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Columns: 11
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 96 rows
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç Processing chunk 1 with 96 rows
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 96 rows - process_guid: d885ae22-de4c-4db3-91ad-05d3d2a3369b
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btiveh1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_a4fc45e9.parquet","timestamp":"2025-10-11 12:09:12,124-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/btiveh1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_a4fc45e9.parquet","timestamp":"2025-10-11 12:09:12,187-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:12 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:12 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_TIPO_VEHICULO
2025-10-11 12:09:12 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:12 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:12 - __main__ - INFO - ================================================================================
2025-10-11 12:09:12 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:12 - __main__ - INFO - üÜî Process GUID: d885ae22-de4c-4db3-91ad-05d3d2a3369b
2025-10-11 12:09:12 - __main__ - INFO - üìä Records: 96
2025-10-11 12:09:12 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:12 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:09:12 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:12 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_VEHICULO... 
2025-10-11 12:09:13 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:13 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:13 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:13 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:13 - __main__ - INFO - üÜî Process GUID generado: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:13 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:13 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:13 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:13 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:13 - __main__ - INFO - ================================================================================
2025-10-11 12:09:13 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:13 - __main__ - INFO - ================================================================================
2025-10-11 12:09:13 - __main__ - INFO - üÜî Process GUID: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:13 - __main__ - INFO - üìä Table: M_VEHICULO
2025-10-11 12:09:13 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:13 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:13 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:13 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:13 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:13 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:13 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:13 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:13 - __main__ - INFO - ================================================================================
2025-10-11 12:09:13 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:13 - __main__ - INFO - ================================================================================
2025-10-11 12:09:13 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:13 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:13 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:13 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:13 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:13 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:13 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:13 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_VEHICULO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:13,691-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:13,692-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:13,925-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:13,925-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:13 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:13 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:14,200-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:14 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:14 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Table: M_VEHICULO
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_vehiculo'
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Checking source_table: 'mvehic1f'
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania, vehiculo, tipvehicu, marca, capmaxkgsv, flgcartec, stsvehicul,cast(cast(transport as int) as varchar(20)) transport, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod'
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:14 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:14 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_VEHICULO process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:14 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_VEHICULO
2025-10-11 12:09:14 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:14 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:14 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:14 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:14 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:14 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:14 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_VEHICULO process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:14 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:14,499-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:14,580-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:14 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Table: M_VEHICULO
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:14 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 17, Filters: 0
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(vehiculo)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, vehiculo, tipvehicu, marca, capmaxkgsv, flgcartec, stsvehicul, cast(cast(transport as int) as varchar(20)) transport, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mvehic1f
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(vehiculo)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, vehiculo, tipvehicu, marca, capmaxkgsv, flgcartec, stsvehicul, cast(cast(transport as int) as varchar(20)) transport, usuacreac, feccreacio, horcreacio, usuaulmod, fecultimod, horultimod FROM mvehic1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.01s
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Rows returned: 298
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Columns: 16
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 298 rows
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç Processing chunk 1 with 298 rows
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 298 rows - process_guid: 0c44a912-a812-45a4-93df-79ea916e60af
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mvehic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_90a964bc.parquet","timestamp":"2025-10-11 12:09:14,593-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mvehic1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_90a964bc.parquet","timestamp":"2025-10-11 12:09:14,671-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:14 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:14 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_VEHICULO
2025-10-11 12:09:14 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:14 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:14 - __main__ - INFO - ================================================================================
2025-10-11 12:09:14 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:14 - __main__ - INFO - üÜî Process GUID: 0c44a912-a812-45a4-93df-79ea916e60af
2025-10-11 12:09:14 - __main__ - INFO - üìä Records: 298
2025-10-11 12:09:14 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:14 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:09:14 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:14 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_PERSONA... 
2025-10-11 12:09:15 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:09:15 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:09:15 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:09:15 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:09:15 - __main__ - INFO - üÜî Process GUID generado: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:15 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:15 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:15 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:09:15 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:09:15 - __main__ - INFO - ================================================================================
2025-10-11 12:09:15 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:09:15 - __main__ - INFO - ================================================================================
2025-10-11 12:09:15 - __main__ - INFO - üÜî Process GUID: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:15 - __main__ - INFO - üìä Table: M_PERSONA
2025-10-11 12:09:15 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:09:15 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:09:15 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:09:15 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:09:15 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:09:15 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:09:15 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:09:15 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:09:15 - __main__ - INFO - ================================================================================
2025-10-11 12:09:15 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:09:15 - __main__ - INFO - ================================================================================
2025-10-11 12:09:15 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:15 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:09:15 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:09:15 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:09:15 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:09:15 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:09:15 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:09:15 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_PERSONA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:15,995-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:15,995-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:09:16,226-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:09:16,227-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:09:16 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:16,515-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:16 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:09:16 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Table: M_PERSONA
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_persona'
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Checking source_table: 'mperso1f'
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultmod,horultimod) lastmodifydate, compania,cast(cast(persona as int) as varchar(20)) persona,replace(replace(nombcomp, char(13),''), char(10),'') nombcomp, apellidopa, apellidoma,replace(replace(nombres, char(13),''), char(10),'') nombres, centrocost, flgtippers, sexo, stscivil, tipdocident, docidentid,rtrim(ltrim(sucursal)) sucursal, coddirec, fecnacim,case when flgcliente = 0x46 then 'F' when flgcliente = 0x54 then 'T' end flgcliente,case when flgprovee = 0x46 then 'F' when flgprovee = 0x54 then 'T' end flgprovee,case when flgemplead = 0x46 then 'F' when flgemplead = 0x54 then 'T' end flgemplead,case when flgtercero = 0x46 then 'F' when flgtercero = 0x54 then 'T' end flgtercero,case when flgobrero = 0x46 then 'F' when flgobrero = 0x54 then 'T' end flgobrero,case when flgvend = 0x46 then 'F' when flgvend = 0x54 then 'T' end flgvend, codigointe, fecrelacio, telefono, fax, nacionali, internet, procedenc, email, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, inscestadu, inscmunici, unidfisca, ruc2, ruc3, ruc4, ruc5, tipdoc2, tipdoc3, tipdoc4, tipdoc5, ddn, ddi, subundfiscal'
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:09:16 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:09:16 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_PERSONA process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:16 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_PERSONA
2025-10-11 12:09:16 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:16 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:09:16 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:09:16 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:09:16 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:09:16 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:09:16 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_PERSONA process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:16 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:09:16,749-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:09:16,811-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:16 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Table: M_PERSONA
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:09:16 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 61, Filters: 0
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:09:16 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(cast(persona as int) as varchar(20)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, cast(cast(persona as int) as varchar(20)) persona, replace(replace(nombcomp, char(13), ''), char(10), '') nombcomp, apellidopa, apellidoma, replace(replace(nombres, char(13), ''), char(10), '') nombres, centrocost, flgtippers, sexo, stscivil, tipdocident, docidentid, rtrim(ltrim(sucursal)) sucursal, coddirec, fecnacim, case when flgcliente = 0x46 then 'F' when flgcliente = 0x54 then 'T' end flgcliente, case when flgprovee = 0x46 then 'F' when flgprovee = 0x54 then 'T' end flgprovee, case when flgemplead = 0x46 then 'F' when flgemplead = 0x54 then 'T' end flgemplead, case when flgtercero = 0x46 then 'F' when flgtercero = 0x54 then 'T' end flgtercero, case when flgobrero = 0x46 then 'F' when flgobrero = 0x54 then 'T' end flgobrero, case when flgvend = 0x46 then 'F' when flgvend = 0x54 then 'T' end flgvend, codigointe, fecrelacio, telefono, fax, nacionali, internet, procedenc, email, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, inscestadu, inscmunici, unidfisca, ruc2, ruc3, ruc4, ruc5, tipdoc2, tipdoc3, tipdoc4, tipdoc5, ddn, ddi, subundfiscal FROM mperso1f
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:09:16 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(cast(persona as int) as varchar(20)) as id, dbo.func_cas_todatetime(fecultmod, horultimod) lastmodifydate, compania, cast(cast(persona as int) as varchar(20)) persona, replace(replace(nombcomp, char(13), ''), char(10), '') nombcomp, apellidopa, apellidoma, replace(replace(nombres, char(13), ''), char(10), '') nombres, centrocost, flgtippers, sexo, stscivil, tipdocident, docidentid, rtrim(ltrim(sucursal)) sucursal, coddirec, fecnacim, case when flgcliente = 0x46 then 'F' when flgcliente = 0x54 then 'T' end flgcliente, case when flgprovee = 0x46 then 'F' when flgprovee = 0x54 then 'T' end flgprovee, case when flgemplead = 0x46 then 'F' when flgemplead = 0x54 then 'T' end flgemplead, case when flgtercero = 0x46 then 'F' when flgtercero = 0x54 then 'T' end flgtercero, case when flgobrero = 0x46 then 'F' when flgobrero = 0x54 then 'T' end flgobrero, case when flgvend = 0x46 then 'F' when flgvend = 0x54 then 'T' end flgvend, codigointe, fecrelacio, telefono, fax, nacionali, internet, procedenc, email, estado, feccrea, horcrea, usucrea, fecultmod, horultimod, ultusumod, inscestadu, inscmunici, unidfisca, ruc2, ruc3, ruc4, ruc5, tipdoc2, tipdoc3, tipdoc4, tipdoc5, ddn, ddi, subundfiscal FROM mperso1f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:09:55 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:09:55 - extract.extractors.sql_server_extractor - INFO - Execution time: 38.77s
2025-10-11 12:09:55 - extract.extractors.sql_server_extractor - INFO - Rows returned: 270,442
2025-10-11 12:09:55 - extract.extractors.sql_server_extractor - INFO - Columns: 52
2025-10-11 12:09:55 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 270,442 rows
2025-10-11 12:09:55 - core.orchestrator - INFO - üîç Processing chunk 1 with 270442 rows
2025-10-11 12:09:55 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 270442 rows - process_guid: c406e571-c205-46d6-8f11-5532a14fa1b5
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mperso1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_be03b54f.parquet","timestamp":"2025-10-11 12:09:58,657-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mperso1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_be03b54f.parquet","timestamp":"2025-10-11 12:09:59,157-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:09:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:59 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:09:59 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:09:59 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:09:59 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:09:59 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:09:59 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_PERSONA
2025-10-11 12:09:59 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:09:59 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:09:59 - __main__ - INFO - ================================================================================
2025-10-11 12:09:59 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:09:59 - __main__ - INFO - üÜî Process GUID: c406e571-c205-46d6-8f11-5532a14fa1b5
2025-10-11 12:09:59 - __main__ - INFO - üìä Records: 270,442
2025-10-11 12:09:59 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:09:59 - __main__ - INFO - ‚è±Ô∏è Time: 42.69s
2025-10-11 12:09:59 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:09:59 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_VENDEDOR... 
2025-10-11 12:10:00 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:00 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:00 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:00 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:00 - __main__ - INFO - üÜî Process GUID generado: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:00 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:00 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:00 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:00 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:00 - __main__ - INFO - ================================================================================
2025-10-11 12:10:00 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:00 - __main__ - INFO - ================================================================================
2025-10-11 12:10:00 - __main__ - INFO - üÜî Process GUID: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:00 - __main__ - INFO - üìä Table: M_VENDEDOR
2025-10-11 12:10:00 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:00 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:00 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:00 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:00 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:00 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:00 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:00 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:00 - __main__ - INFO - ================================================================================
2025-10-11 12:10:00 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:00 - __main__ - INFO - ================================================================================
2025-10-11 12:10:00 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:00 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:00 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:10:00 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:10:00 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:10:00 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:00 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:10:00 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_VENDEDOR', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:00,733-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:00,733-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:00,996-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:00,996-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:00 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:01 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:01,267-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:01 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:01 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Table: M_VENDEDOR
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_vendedor'
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Checking source_table: 'mpersocf'
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(vendedor as int) as varchar(20)) vendedor, handheld, flgintro, prcdesvend, tipvendedo, stsvendedo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, flgcomis,cast(cast(codfvtas as int) as varchar(20)) codfvtas,rtrim(ltrim(sucursal)) sucursal, claveprev'
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:01 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:01 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_VENDEDOR process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:01 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_VENDEDOR
2025-10-11 12:10:01 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:01 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:01 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:01 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:01 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:01 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:01 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_VENDEDOR process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:01 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:01,522-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:01,591-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:01 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Table: M_VENDEDOR
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:10:01 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 20, Filters: 0
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + cast(vendedor as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(vendedor as int) as varchar(20)) vendedor, handheld, flgintro, prcdesvend, tipvendedo, stsvendedo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, flgcomis, cast(cast(codfvtas as int) as varchar(20)) codfvtas, rtrim(ltrim(sucursal)) sucursal, claveprev FROM mpersocf
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + cast(vendedor as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(vendedor as int) as varchar(20)) vendedor, handheld, flgintro, prcdesvend, tipvendedo, stsvendedo, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, flgcomis, cast(cast(codfvtas as int) as varchar(20)) codfvtas, rtrim(ltrim(sucursal)) sucursal, claveprev FROM mpersocf
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Rows returned: 603
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Columns: 19
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 603 rows
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç Processing chunk 1 with 603 rows
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 603 rows - process_guid: 61162caa-37d3-4a05-808c-e4901ead49d9
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mpersocf/year=2025/month=10/day=11/data_thread_0_0_chunk_0_6c043bde.parquet","timestamp":"2025-10-11 12:10:01,634-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/mpersocf/year=2025/month=10/day=11/data_thread_0_0_chunk_0_6c043bde.parquet","timestamp":"2025-10-11 12:10:01,704-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:10:01 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:10:01 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_VENDEDOR
2025-10-11 12:10:01 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:01 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:01 - __main__ - INFO - ================================================================================
2025-10-11 12:10:01 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:01 - __main__ - INFO - üÜî Process GUID: 61162caa-37d3-4a05-808c-e4901ead49d9
2025-10-11 12:10:01 - __main__ - INFO - üìä Records: 603
2025-10-11 12:10:01 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:01 - __main__ - INFO - ‚è±Ô∏è Time: 0.18s
2025-10-11 12:10:01 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:10:01 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla M_ZONA... 
2025-10-11 12:10:02 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:02 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:02 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:02 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:02 - __main__ - INFO - üÜî Process GUID generado: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:03 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:03 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:03 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
2025-10-11 12:10:03 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
2025-10-11 12:10:03 - __main__ - INFO - üÜî Process GUID: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - __main__ - INFO - üìä Table: M_ZONA
2025-10-11 12:10:03 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:03 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:03 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:03 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:03 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:03 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:03 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:03 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
2025-10-11 12:10:03 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
2025-10-11 12:10:03 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:03 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'full'
2025-10-11 12:10:03 - core.orchestrator - INFO - After strip - load_type: 'full'
2025-10-11 12:10:03 - core.orchestrator - INFO - Before force_full_load check - load_type: 'full'
2025-10-11 12:10:03 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:03 - core.orchestrator - INFO - Final load_type: 'full'
2025-10-11 12:10:03 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-M_ZONA', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:03,067-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:03,067-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:03,296-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:03,296-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:03 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:03,563-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:03 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:03 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Table: M_ZONA
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Load type from config: 'full'
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Mapped to strategy type: full
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Determined strategy type: full
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Creating strategy instance: FullLoadStrategy
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY VALIDATION ===
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Checking stage_table_name: 'm_zona'
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Checking source_table: 'view_cas_mestdi2f'
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,cast(cast(zonadist as int) as varchar(20)) zonadist,replace(replace(desczona, char(13),''), char(10),'') desczona,cast(cast(supervisor as int) as varchar(20)) supervisor,cast(cast(discendiis as int) as varchar(20)) discendiis,cast(cast(qclizona as int) as varchar(20)) qclizona, stszona, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(sucursal)) sucursal, regvent,cast(cast(cvecuotad as int) as varchar(20)) cvecuotad, canal, subregvent,rtrim(ltrim(pais)) pais'
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - === END VALIDATION ===
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:03 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:03 - core.orchestrator - INFO - üöÄ Starting extraction - table: M_ZONA process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla M_ZONA
2025-10-11 12:10:03 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:03 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:03 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:03 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:03 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:03 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:03 - core.orchestrator - INFO - üìä Executing fullload strategy - table: M_ZONA process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - core.orchestrator - INFO - fullload strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:03,766-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:03,829-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:03 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - === FULL LOAD STRATEGY ===
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Table: M_ZONA
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - Load Mode: initial
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - üîç Watermark tracking decision:
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -    - Load Mode: initial
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -    - Has partition column: 
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -    - Has watermark storage: False
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -    - Is incremental table: False
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO -    - Should track: 
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - ‚ÑπÔ∏è Full load without watermark tracking
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - üìã Building non-partitioned full load params
2025-10-11 12:10:03 - strategies.implementations.full_load - INFO - ‚úÖ Params built - Columns: 26, Filters: 0
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç Thread 0 - Strategy: fullload - process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG Partition column: ''
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG Watermark storage available: False
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG Chunk size: 50000
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG Order by: None
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG Chunking params: {}
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(zonadist as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(zonadist as int) as varchar(20)) zonadist, replace(replace(desczona, char(13), ''), char(10), '') desczona, cast(cast(supervisor as int) as varchar(20)) supervisor, cast(cast(discendiis as int) as varchar(20)) discendiis, cast(cast(qclizona as int) as varchar(20)) qclizona, stszona, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, regvent, cast(cast(cvecuotad as int) as varchar(20)) cvecuotad, canal, subregvent, rtrim(ltrim(pais)) pais FROM view_cas_mestdi2f
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + cast(zonadist as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod, horultimod) lastmodifydate, compania, cast(cast(zonadist as int) as varchar(20)) zonadist, replace(replace(desczona, char(13), ''), char(10), '') desczona, cast(cast(supervisor as int) as varchar(20)) supervisor, cast(cast(discendiis as int) as varchar(20)) discendiis, cast(cast(qclizona as int) as varchar(20)) qclizona, stszona, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod, rtrim(ltrim(sucursal)) sucursal, regvent, cast(cast(cvecuotad as int) as varchar(20)) cvecuotad, canal, subregvent, rtrim(ltrim(pais)) pais FROM view_cas_mestdi2f
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Rows returned: 70
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Columns: 21
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 70 rows
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç Processing chunk 1 with 70 rows
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç Thread 0 - Processing chunk 1 with 70 rows - process_guid: 36096af9-b2c4-4797-bbb2-fe8050d5901d
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/view_cas_mestdi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_367b1580.parquet","timestamp":"2025-10-11 12:10:03,860-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/view_cas_mestdi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_367b1580.parquet","timestamp":"2025-10-11 12:10:03,938-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG is_incremental: False
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç DEBUG should_track: False
2025-10-11 12:10:03 - core.orchestrator - INFO - üîç No watermark to save
2025-10-11 12:10:03 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla M_ZONA
2025-10-11 12:10:03 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:03 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
2025-10-11 12:10:03 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:03 - __main__ - INFO - üÜî Process GUID: 36096af9-b2c4-4797-bbb2-fe8050d5901d
2025-10-11 12:10:03 - __main__ - INFO - üìä Records: 70
2025-10-11 12:10:03 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:03 - __main__ - INFO - ‚è±Ô∏è Time: 0.17s
2025-10-11 12:10:03 - __main__ - INFO - üéØ Strategy: fullload
2025-10-11 12:10:03 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO... 
2025-10-11 12:10:04 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:04 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:04 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:04 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:05 - __main__ - INFO - üÜî Process GUID generado: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:05 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:05 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:05 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:05 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:05 - __main__ - INFO - ================================================================================
2025-10-11 12:10:05 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:05 - __main__ - INFO - ================================================================================
2025-10-11 12:10:05 - __main__ - INFO - üÜî Process GUID: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:05 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO
2025-10-11 12:10:05 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:05 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:05 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:05 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:05 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:05 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:05 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:05 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:05 - __main__ - INFO - ================================================================================
2025-10-11 12:10:05 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:05 - __main__ - INFO - ================================================================================
2025-10-11 12:10:05 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:05 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:05 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:05 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:05 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:05 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:05 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:05 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:05,206-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:05,206-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:05,459-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:05,459-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:05 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:05 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:05,719-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:05 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:05 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido'
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - Checking source_table: 'thpedi1f'
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago'
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:05 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:05 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:05 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO process_guid: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:05 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO
2025-10-11 12:10:05 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:05 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:05 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:05 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:05 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:05 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:05 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO process_guid: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:05 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:05,938-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:06,000-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:06 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO -    Partition column: fecpedido
2025-10-11 12:10:06 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:06 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:06 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.thpedi1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.thpedi1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.thpedi1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.05s
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç MIN/MAX results: min=7517, max=739534
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç Generating 1 partitioned queries - Range: 732017, Increment: 732017
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç Generated partitioned query: Range 7517-739535
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç Executing 1 partitioned queries in parallel - process_guid: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:06 - core.orchestrator - INFO - üîç DEBUG: Starting _execute_partition_query for thread 0
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Extraction mode: CHUNKED
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Order by: fecpedido
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - CHUNKED QUERY EXECUTION
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Order by: fecpedido
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Chunk #1: offset=0, size=50,000
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:06 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Execution time: 2.92s
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Columns: 49
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Chunk #1 returned 50,000 rows
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 1 with 50,000 rows
2025-10-11 12:10:09 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 1 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8ce623e9.parquet","timestamp":"2025-10-11 12:10:09,642-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8ce623e9.parquet","timestamp":"2025-10-11 12:10:09,860-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:09 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8ce623e9.parquet', 'file_name': 'data_thread_0_0_chunk_0_8ce623e9.parquet', 'file_size_bytes': 2084255, 'file_size_mb': Decimal('1.988'), 'records_count': 50000, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:09.860942', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.641'), 'upload_duration_seconds': Decimal('0.219'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:09 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_8ce623e9.parquet', 'file_name': 'data_thread_0_0_chunk_0_8ce623e9.parquet', 'file_size_bytes': 2084255, 'file_size_mb': Decimal('1.988'), 'records_count': 50000, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:09.860942', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.641'), 'upload_duration_seconds': Decimal('0.219'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')} | Size: 0MB | Records: 50,000 | Columns: 49
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Chunk #2: offset=50,000, size=50,000
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 50000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:09 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 50000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - Execution time: 2.98s
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - Columns: 49
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - Chunk #2 returned 50,000 rows
2025-10-11 12:10:12 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 2 with 50,000 rows
2025-10-11 12:10:12 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 2 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_ba1be164.parquet","timestamp":"2025-10-11 12:10:13,549-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_ba1be164.parquet","timestamp":"2025-10-11 12:10:13,658-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:13 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_ba1be164.parquet', 'file_name': 'data_thread_0_1_chunk_1_ba1be164.parquet', 'file_size_bytes': 2036598, 'file_size_mb': Decimal('1.942'), 'records_count': 50000, 'thread_id': '0_1', 'chunk_id': 1, 'partition_index': None, 'created_at': '2025-10-11T12:10:13.674063', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.671'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:13 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_ba1be164.parquet', 'file_name': 'data_thread_0_1_chunk_1_ba1be164.parquet', 'file_size_bytes': 2036598, 'file_size_mb': Decimal('1.942'), 'records_count': 50000, 'thread_id': '0_1', 'chunk_id': 1, 'partition_index': None, 'created_at': '2025-10-11T12:10:13.674063', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.671'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')} | Size: 0MB | Records: 50,000 | Columns: 49
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - Chunk #3: offset=100,000, size=50,000
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:13 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.01s
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - Columns: 49
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - Chunk #3 returned 50,000 rows
2025-10-11 12:10:16 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 3 with 50,000 rows
2025-10-11 12:10:16 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 3 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_a37dc12a.parquet","timestamp":"2025-10-11 12:10:17,377-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_a37dc12a.parquet","timestamp":"2025-10-11 12:10:17,498-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:17 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_a37dc12a.parquet', 'file_name': 'data_thread_0_2_chunk_2_a37dc12a.parquet', 'file_size_bytes': 2103812, 'file_size_mb': Decimal('2.006'), 'records_count': 50000, 'thread_id': '0_2', 'chunk_id': 2, 'partition_index': None, 'created_at': '2025-10-11T12:10:17.498042', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.657'), 'upload_duration_seconds': Decimal('0.121'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:17 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_a37dc12a.parquet', 'file_name': 'data_thread_0_2_chunk_2_a37dc12a.parquet', 'file_size_bytes': 2103812, 'file_size_mb': Decimal('2.006'), 'records_count': 50000, 'thread_id': '0_2', 'chunk_id': 2, 'partition_index': None, 'created_at': '2025-10-11T12:10:17.498042', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.657'), 'upload_duration_seconds': Decimal('0.121'), 'columns_count': 49, 'estimated_memory_mb': Decimal('18.692')} | Size: 0MB | Records: 50,000 | Columns: 49
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - Chunk #4: offset=150,000, size=50,000
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:17 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(compania)) + '|' + rtrim(ltrim(sucursal)) + '|' + rtrim(ltrim(emisor)) + '|' + rtrim(ltrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(20)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(20)) nropedido, origpedido,cast(cast(nropediori as bigint) as varchar(20)) nropediori, fecpedido, tcajped, stspedido,cast(cast(discendist as int) as varchar(20)) discendist,cast(cast(zonadist as int) as varchar(20)) zonadist,cast(cast(vendedor as int) as varchar(20)) vendedor,cast(cast(ruta as int) as varchar(20)) ruta,cast(cast(modulo as int) as varchar(20)) modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom,cast(cast(codfvtas as int) as varchar(20)) codfvtas, tvta, fordvisit, fecentrega,cast(cast(aprobadop as int) as varchar(20)) aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda,cast(null as varchar(4)) term_negoci, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago FROM dbo.thpedi1f WHERE fecpedido >= 7517 AND fecpedido < 739535 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Execution time: 1.52s
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Rows returned: 10,683
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Columns: 49
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Chunk #4 returned 10,683 rows
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 4 with 10,683 rows
2025-10-11 12:10:19 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 4 with 10683 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_283be9eb.parquet","timestamp":"2025-10-11 12:10:19,205-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_283be9eb.parquet","timestamp":"2025-10-11 12:10:19,299-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:19 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_283be9eb.parquet', 'file_name': 'data_thread_0_3_chunk_3_283be9eb.parquet', 'file_size_bytes': 491198, 'file_size_mb': Decimal('0.468'), 'records_count': 10683, 'thread_id': '0_3', 'chunk_id': 3, 'partition_index': None, 'created_at': '2025-10-11T12:10:19.299719', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 49, 'estimated_memory_mb': Decimal('3.994')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:19 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi1f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_283be9eb.parquet', 'file_name': 'data_thread_0_3_chunk_3_283be9eb.parquet', 'file_size_bytes': 491198, 'file_size_mb': Decimal('0.468'), 'records_count': 10683, 'thread_id': '0_3', 'chunk_id': 3, 'partition_index': None, 'created_at': '2025-10-11T12:10:19.299719', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 49, 'estimated_memory_mb': Decimal('3.994')} | Size: 0MB | Records: 10,683 | Columns: 49
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Last chunk received (10,683 < 50,000), stopping pagination
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - CHUNKED EXECUTION COMPLETED - Total chunks: 4
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - Chunked extraction completed - Total chunks yielded: 4
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:19 - core.orchestrator - INFO - ‚úÖ Thread 0 completed: 160,683 records, 4 files, 0.00MB total
2025-10-11 12:10:19 - core.orchestrator - INFO - üìä Extraction Summary - Files: 4, Total Size: 0.00MB, Avg Size: 0.00MB
2025-10-11 12:10:19 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla T_DOCUMENTO_PEDIDO
2025-10-11 12:10:19 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:19 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:19 - __main__ - INFO - ================================================================================
2025-10-11 12:10:19 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:19 - __main__ - INFO - üÜî Process GUID: b159557a-6586-42cf-bc13-b08664e64cf6
2025-10-11 12:10:19 - __main__ - INFO - üìä Records: 160,683
2025-10-11 12:10:19 - __main__ - INFO - üìÅ Files: 4
2025-10-11 12:10:19 - __main__ - INFO - ‚è±Ô∏è Time: 13.36s
2025-10-11 12:10:19 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:19 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_ADES... 
2025-10-11 12:10:20 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:20 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:20 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:20 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:20 - __main__ - INFO - üÜî Process GUID generado: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:20 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:20 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:20 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:20 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:20 - __main__ - INFO - ================================================================================
2025-10-11 12:10:20 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:20 - __main__ - INFO - ================================================================================
2025-10-11 12:10:20 - __main__ - INFO - üÜî Process GUID: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:20 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_ADES
2025-10-11 12:10:20 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:20 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:20 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:20 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:20 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:20 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:20 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:20 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:20 - __main__ - INFO - ================================================================================
2025-10-11 12:10:20 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:20 - __main__ - INFO - ================================================================================
2025-10-11 12:10:20 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:20 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:20 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:20 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:20 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:20 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:20 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:20 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_ADES', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:20,635-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:20,635-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:20,907-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:20,907-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:20 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:20 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:21,205-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:21 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:21 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_ADES
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_ades'
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Checking source_table: 'tpedid1f'
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(100)) nropedido, origpedido, nropediori, fecpedido, tcajped, stspedido, discendist, zonadist, vendedor, ruta, modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom, codfvtas, tvta, fordvisit, fecentrega, aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago,cast(null as varchar(4)) proveedor,cast(null as varchar(4)) codigogln'
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:21 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:21 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_ADES process_guid: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:21 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_ADES
2025-10-11 12:10:21 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:21 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:21 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:21 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:21 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:21 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:21 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_ADES process_guid: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:21 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:21,423-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:21,486-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:21 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_ADES
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -    Partition column: fecpedido
2025-10-11 12:10:21 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:21 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:21 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.tpedid1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.tpedid1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(fecpedido) as min_val, MAX(fecpedido) as max_val FROM dbo.tpedid1f WHERE fecpedido <> 0 AND compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç MIN/MAX results: min=739341, max=739535
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç Generating 1 partitioned queries - Range: 194, Increment: 194
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç Generated partitioned query: Range 739341-739536
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç Executing 1 partitioned queries in parallel - process_guid: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç DEBUG: Starting _execute_partition_query for thread 0
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Extraction mode: CHUNKED
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Order by: fecpedido
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(sucursal)) + '|' + ltrim(rtrim(emisor)) + '|' + ltrim(rtrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(100)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(100)) nropedido, origpedido, nropediori, fecpedido, tcajped, stspedido, discendist, zonadist, vendedor, ruta, modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom, codfvtas, tvta, fordvisit, fecentrega, aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago,cast(null as varchar(4)) proveedor,cast(null as varchar(4)) codigogln FROM dbo.tpedid1f WHERE fecpedido >= 739341 AND fecpedido < 739536 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - CHUNKED QUERY EXECUTION
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Order by: fecpedido
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Chunk #1: offset=0, size=50,000
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - 
                SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(sucursal)) + '|' + ltrim(rtrim(emisor)) + '|' + ltrim(rtrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(100)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(100)) nropedido, origpedido, nropediori, fecpedido, tcajped, stspedido, discendist, zonadist, vendedor, ruta, modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom, codfvtas, tvta, fordvisit, fecentrega, aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago,cast(null as varchar(4)) proveedor,cast(null as varchar(4)) codigogln FROM dbo.tpedid1f WHERE fecpedido >= 739341 AND fecpedido < 739536 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT ltrim(rtrim(compania)) + '|' + ltrim(rtrim(sucursal)) + '|' + ltrim(rtrim(emisor)) + '|' + ltrim(rtrim(docupedido)) + '|' + cast(cast(nropedido as bigint) as varchar(100)) as id, dbo.func_cas_todatetime(fecultimod,horultimod) lastmodifydate, compania,rtrim(ltrim(sucursal)) sucursal,rtrim(ltrim(emisor)) emisor,rtrim(ltrim(docupedido)) docupedido,cast(cast(nropedido as bigint) as varchar(100)) nropedido, origpedido, nropediori, fecpedido, tcajped, stspedido, discendist, zonadist, vendedor, ruta, modulo, stspederr,case when procesan = 0x46 then 'F' when procesan = 0x54 then 'T' end procesan, feccreacio, horcreacio, usuacreac, fecultimod, horultimod, usuaulmod,rtrim(ltrim(docucomalm)) docucomalm, nrocomalm, numordcom, codfvtas, tvta, fordvisit, fecentrega, aprobadop, fecaprobac, horaprobac, desaprobp,case when flgdesapro = 0x46 then 'F' when flgdesapro = 0x54 then 'T' end flgdesapro, tipoped, fecrecojo, formpago, horentrega, ordcompra,rtrim(ltrim(moneda)) moneda, termnegoc,cast(null as varchar(4)) jefevta,cast(null as varchar(4)) supervisor,cast(null as varchar(4)) idestcom,cast(null as varchar(4)) medpago,cast(null as varchar(4)) proveedor,cast(null as varchar(4)) codigogln FROM dbo.tpedid1f WHERE fecpedido >= 739341 AND fecpedido < 739536 AND (compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Rows returned: 104
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Columns: 50
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Chunk #1 returned 104 rows
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 1 with 104 rows
2025-10-11 12:10:21 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 1 with 104 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d4a5937e.parquet","timestamp":"2025-10-11 12:10:21,533-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d4a5937e.parquet","timestamp":"2025-10-11 12:10:21,611-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:21 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d4a5937e.parquet', 'file_name': 'data_thread_0_0_chunk_0_d4a5937e.parquet', 'file_size_bytes': 32059, 'file_size_mb': Decimal('0.031'), 'records_count': 104, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:21.611319', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.016'), 'upload_duration_seconds': Decimal('0.078'), 'columns_count': 50, 'estimated_memory_mb': Decimal('0.04')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:21 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid1f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_d4a5937e.parquet', 'file_name': 'data_thread_0_0_chunk_0_d4a5937e.parquet', 'file_size_bytes': 32059, 'file_size_mb': Decimal('0.031'), 'records_count': 104, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:21.611319', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.016'), 'upload_duration_seconds': Decimal('0.078'), 'columns_count': 50, 'estimated_memory_mb': Decimal('0.04')} | Size: 0MB | Records: 104 | Columns: 50
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Last chunk received (104 < 50,000), stopping pagination
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - CHUNKED EXECUTION COMPLETED - Total chunks: 1
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - Chunked extraction completed - Total chunks yielded: 1
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:21 - core.orchestrator - INFO - ‚úÖ Thread 0 completed: 104 records, 1 files, 0.00MB total
2025-10-11 12:10:21 - core.orchestrator - INFO - üìä Extraction Summary - Files: 1, Total Size: 0.00MB, Avg Size: 0.00MB
2025-10-11 12:10:21 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla T_DOCUMENTO_PEDIDO_ADES
2025-10-11 12:10:21 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:21 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:21 - __main__ - INFO - ================================================================================
2025-10-11 12:10:21 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:21 - __main__ - INFO - üÜî Process GUID: f94cf08d-d532-496e-8f57-fca7767e3276
2025-10-11 12:10:21 - __main__ - INFO - üìä Records: 104
2025-10-11 12:10:21 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:21 - __main__ - INFO - ‚è±Ô∏è Time: 0.19s
2025-10-11 12:10:21 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:21 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_ADES_APROBACION... 
2025-10-11 12:10:22 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:22 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:22 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:22 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:22 - __main__ - INFO - üÜî Process GUID generado: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:22 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:22 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:22 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:22 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:22 - __main__ - INFO - ================================================================================
2025-10-11 12:10:22 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:22 - __main__ - INFO - ================================================================================
2025-10-11 12:10:22 - __main__ - INFO - üÜî Process GUID: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:22 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_ADES_APROBACION
2025-10-11 12:10:22 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:22 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:22 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:22 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:22 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:22 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:22 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:22 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:22 - __main__ - INFO - ================================================================================
2025-10-11 12:10:22 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:22 - __main__ - INFO - ================================================================================
2025-10-11 12:10:22 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:22 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:22 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:22 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:22 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:22 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:22 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:22 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_ADES_APROBACION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:23,006-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:23,006-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:23,241-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:23,242-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:23 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:23,501-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:23 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:23 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_APROBACION
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_ades_aprobacion'
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Checking source_table: 'tpedid7f t2'
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t2.compprog compprog,t2.sucuprog sucuprog,t2.emisprog emisprog,t.fecpedido fecpedido,t2.fechapedid fechapedid,t2.fechaprog fechaprog,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qcajprog qcajprog,t2.qbotprog qbotprog,t2.qcajaten qcajaten,t2.qbotaten qbotaten,t2.flgatend flgatend,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.qcajsaldo qcajsaldo,t2.qbotsaldo qbotsaldo,case when t2.flgpagado = 0x46 then 'F' when t2.flgpagado = 0x54 then 'T' end flgpagado,t2.zonadist zonadist,t2.ruta ruta,t2.modulo modulo,t2.vendedor vendedor,t2.listprec listprec,t2.tdscto tdscto,t2.formpago formpago,t2.impprecaj impprecaj,t2.tipoped tipoped,rtrim(ltrim(t2.docucomvtaade)) docucomvtaade,t2.nrocomvtaade nrocomvtaade,t2.importe importe,t2.saldo saldo,t2.liquidado liquidado,t2.flgprogentreg flgprogentreg,t2.fechaentrega fechaentrega,case when t2.flgcancelado = 0x46 then 'F' when t2.flgcancelado = 0x54 then 'T' end flgcancelado,t2.qcajcanc qcajcanc,t2.qbotcanc qbotcanc,t2.usuacancela usuacancela,t2.fechacancela fechacancela,t2.leadtime leadtime,cast(null as varchar(4)) articuloant,cast(null as varchar(4)) medpago,cast(null as varchar(4)) flgfacorig'
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:23 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:23 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_ADES_APROBACION process_guid: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:23 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_ADES_APROBACION
2025-10-11 12:10:23 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:23 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:23 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:23 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:23 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:23 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:23 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_ADES_APROBACION process_guid: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:23 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:23,720-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:23,783-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:23 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_APROBACION
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - üìé Table with JOIN: dbo.tpedid7f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -    Partition column: t.fecpedido
2025-10-11 12:10:23 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:23 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:23 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid7f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:23 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:23 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid7f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid7f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:23 - core.orchestrator - WARNING - ‚ö†Ô∏è No valid data found for partitioning (MIN/MAX returned None). Skipping table.
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid7f/year=2025/month=10/day=11/data_thread_0_chunk_0_eb04a0f7.parquet","timestamp":"2025-10-11 12:10:23,814-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid7f/year=2025/month=10/day=11/data_thread_0_chunk_0_eb04a0f7.parquet","timestamp":"2025-10-11 12:10:23,876-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:23 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table T_DOCUMENTO_PEDIDO_ADES_APROBACION
2025-10-11 12:10:23 - bigmagic-monitor - WARNING - Advertencia procesando tabla T_DOCUMENTO_PEDIDO_ADES_APROBACION: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:10:23 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:23 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:10:23 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:23 - __main__ - INFO - ================================================================================
2025-10-11 12:10:23 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:23 - __main__ - INFO - üÜî Process GUID: 41f3b7ed-6c99-4424-a89b-6c766edf5faa
2025-10-11 12:10:23 - __main__ - INFO - üìä Records: 0
2025-10-11 12:10:23 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:23 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:10:23 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:23 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_ADES_DESPACHO... 
2025-10-11 12:10:24 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:24 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:24 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:24 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:24 - __main__ - INFO - üÜî Process GUID generado: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:25 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:25 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:25 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:25 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:25 - __main__ - INFO - ================================================================================
2025-10-11 12:10:25 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:25 - __main__ - INFO - ================================================================================
2025-10-11 12:10:25 - __main__ - INFO - üÜî Process GUID: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:25 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_ADES_DESPACHO
2025-10-11 12:10:25 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:25 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:25 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:25 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:25 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:25 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:25 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:25 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:25 - __main__ - INFO - ================================================================================
2025-10-11 12:10:25 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:25 - __main__ - INFO - ================================================================================
2025-10-11 12:10:25 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:25 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:25 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:25 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:25 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:25 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:25 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:25 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_ADES_DESPACHO', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:25,171-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:25,171-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:25,431-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:25,432-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:25 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:25 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:25,721-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:25 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:25 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_DESPACHO
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_ades_despacho'
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - Checking source_table: 'tpedid8f t2'
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t.fecpedido fecpedido,t2.fechaprog fechaprog,t2.compaten compaten,t2.sucuaten sucuaten,t2.emisaten emisaten,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.fechadoc fechadoc,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qcajaten qcajaten,t2.qbotaten qbotaten,t2.qcajsaldo qcajsaldo,t2.qbotsaldo qbotsaldo,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.estado estado,t2.stspedido stspedido,t2.importe importe,t2.fechaentrega fechaentrega,t2.fechaaten fechaaten,cast(null as varchar(4)) idcita,cast(null as varchar(4)) fechacita,cast(null as varchar(4)) horacita,cast(null as varchar(4)) flgfacorig,cast(null as varchar(4)) proccomalm'
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:25 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:25 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:25 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_ADES_DESPACHO process_guid: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:25 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_ADES_DESPACHO
2025-10-11 12:10:25 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:25 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:25 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:25 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:25 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:25 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:25 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_ADES_DESPACHO process_guid: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:25 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:25,939-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:26,002-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:26 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_DESPACHO
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - üìé Table with JOIN: dbo.tpedid8f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO -    Partition column: t.fecpedido
2025-10-11 12:10:26 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:26 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:26 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid8f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:26 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:26 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid8f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid8f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:26 - core.orchestrator - WARNING - ‚ö†Ô∏è No valid data found for partitioning (MIN/MAX returned None). Skipping table.
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid8f/year=2025/month=10/day=11/data_thread_0_chunk_0_56235f95.parquet","timestamp":"2025-10-11 12:10:26,033-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid8f/year=2025/month=10/day=11/data_thread_0_chunk_0_56235f95.parquet","timestamp":"2025-10-11 12:10:26,096-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:26 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table T_DOCUMENTO_PEDIDO_ADES_DESPACHO
2025-10-11 12:10:26 - bigmagic-monitor - WARNING - Advertencia procesando tabla T_DOCUMENTO_PEDIDO_ADES_DESPACHO: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:10:26 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:26 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:10:26 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:26 - __main__ - INFO - ================================================================================
2025-10-11 12:10:26 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:26 - __main__ - INFO - üÜî Process GUID: 4bdd667e-34dc-44ad-ac4f-13fff989bb8e
2025-10-11 12:10:26 - __main__ - INFO - üìä Records: 0
2025-10-11 12:10:26 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:26 - __main__ - INFO - ‚è±Ô∏è Time: 0.16s
2025-10-11 12:10:26 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:26 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_ADES_DETALLE... 
2025-10-11 12:10:27 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:27 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:27 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:27 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:27 - __main__ - INFO - üÜî Process GUID generado: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:27 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:27 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:27 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:27 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:27 - __main__ - INFO - ================================================================================
2025-10-11 12:10:27 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:27 - __main__ - INFO - ================================================================================
2025-10-11 12:10:27 - __main__ - INFO - üÜî Process GUID: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:27 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_ADES_DETALLE
2025-10-11 12:10:27 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:27 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:27 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:27 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:27 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:27 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:27 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:27 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:27 - __main__ - INFO - ================================================================================
2025-10-11 12:10:27 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:27 - __main__ - INFO - ================================================================================
2025-10-11 12:10:27 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:27 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:27 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:27 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:27 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:27 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:27 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:27 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_ADES_DETALLE', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:27,446-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:27,446-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:27,677-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:27,677-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:27 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:27,955-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:27 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:27 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_DETALLE
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_ades_detalle'
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - Checking source_table: 'tpedid2f t2'
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t.fecpedido fecpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,t2.discendist discendist,t2.zonadist zonadist,t2.ruta ruta,t2.modulo modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm'
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:27 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:27 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:27 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_ADES_DETALLE process_guid: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:27 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_ADES_DETALLE
2025-10-11 12:10:28 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:28 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:28 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:28 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:28 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:28 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:28 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_ADES_DETALLE process_guid: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:28 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:28,158-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:28,236-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:28 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_DETALLE
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - üìé Table with JOIN: dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO -    Partition column: t.fecpedido
2025-10-11 12:10:28 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:28 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:28 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.14s
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç MIN/MAX results: min=739341, max=739535
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç Generating 1 partitioned queries - Range: 194, Increment: 194
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç Generated partitioned query: Range 739341-739536
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç Executing 1 partitioned queries in parallel - process_guid: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç DEBUG: Starting _execute_partition_query for thread 0
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Extraction mode: CHUNKED
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Order by: t.fecpedido
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - SELECT ltrim(rtrim(t2.compania)) + '|' + ltrim(rtrim(t2.sucursal)) + '|' + ltrim(rtrim(t2.emisor)) + '|' + ltrim(rtrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(100)) + '|' + cast(cast(t2.cliente as bigint) as varchar(100)) + '|' + cast(cast(t2.articulo as bigint) as varchar(100)) + '|' + ltrim(rtrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(100)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t.fecpedido fecpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,t2.discendist discendist,t2.zonadist zonadist,t2.ruta ruta,t2.modulo modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 739341 AND t.fecpedido < 739536 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - CHUNKED QUERY EXECUTION
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Order by: t.fecpedido
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Chunk #1: offset=0, size=50,000
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - 
                SELECT ltrim(rtrim(t2.compania)) + '|' + ltrim(rtrim(t2.sucursal)) + '|' + ltrim(rtrim(t2.emisor)) + '|' + ltrim(rtrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(100)) + '|' + cast(cast(t2.cliente as bigint) as varchar(100)) + '|' + cast(cast(t2.articulo as bigint) as varchar(100)) + '|' + ltrim(rtrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(100)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t.fecpedido fecpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,t2.discendist discendist,t2.zonadist zonadist,t2.ruta ruta,t2.modulo modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 739341 AND t.fecpedido < 739536 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT ltrim(rtrim(t2.compania)) + '|' + ltrim(rtrim(t2.sucursal)) + '|' + ltrim(rtrim(t2.emisor)) + '|' + ltrim(rtrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(100)) + '|' + cast(cast(t2.cliente as bigint) as varchar(100)) + '|' + cast(cast(t2.articulo as bigint) as varchar(100)) + '|' + ltrim(rtrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(100)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t2.procpedido procpedido,t.fecpedido fecpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,t2.discendist discendist,t2.zonadist zonadist,t2.ruta ruta,t2.modulo modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm FROM dbo.tpedid2f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 739341 AND t.fecpedido < 739536 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.39s
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Rows returned: 6,113
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Chunk #1 returned 6,113 rows
2025-10-11 12:10:28 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 1 with 6,113 rows
2025-10-11 12:10:28 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 1 with 6113 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_516270db.parquet","timestamp":"2025-10-11 12:10:28,940-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_516270db.parquet","timestamp":"2025-10-11 12:10:29,065-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:29 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_516270db.parquet', 'file_name': 'data_thread_0_0_chunk_0_516270db.parquet', 'file_size_bytes': 153562, 'file_size_mb': Decimal('0.146'), 'records_count': 6113, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:29.065013', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.156'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('3.545')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:10:29 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_516270db.parquet', 'file_name': 'data_thread_0_0_chunk_0_516270db.parquet', 'file_size_bytes': 153562, 'file_size_mb': Decimal('0.146'), 'records_count': 6113, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:10:29.065013', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('0.156'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('3.545')} | Size: 0MB | Records: 6,113 | Columns: 76
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - Last chunk received (6,113 < 50,000), stopping pagination
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - CHUNKED EXECUTION COMPLETED - Total chunks: 1
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - Chunked extraction completed - Total chunks yielded: 1
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:29 - core.orchestrator - INFO - ‚úÖ Thread 0 completed: 6,113 records, 1 files, 0.00MB total
2025-10-11 12:10:29 - core.orchestrator - INFO - üìä Extraction Summary - Files: 1, Total Size: 0.00MB, Avg Size: 0.00MB
2025-10-11 12:10:29 - bigmagic-monitor - INFO - Procesamiento exitoso de tabla T_DOCUMENTO_PEDIDO_ADES_DETALLE
2025-10-11 12:10:29 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:29 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:29 - __main__ - INFO - ================================================================================
2025-10-11 12:10:29 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:29 - __main__ - INFO - üÜî Process GUID: c06306e9-f806-4245-9678-8864ababecd4
2025-10-11 12:10:29 - __main__ - INFO - üìä Records: 6,113
2025-10-11 12:10:29 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:29 - __main__ - INFO - ‚è±Ô∏è Time: 0.92s
2025-10-11 12:10:29 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:29 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION... 
2025-10-11 12:10:30 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:30 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:30 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:30 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:30 - __main__ - INFO - üÜî Process GUID generado: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:30 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:30 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:30 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:30 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:30 - __main__ - INFO - ================================================================================
2025-10-11 12:10:30 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:30 - __main__ - INFO - ================================================================================
2025-10-11 12:10:30 - __main__ - INFO - üÜî Process GUID: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:30 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION
2025-10-11 12:10:30 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:30 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:30 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:30 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:30 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:30 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:30 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:30 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:30 - __main__ - INFO - ================================================================================
2025-10-11 12:10:30 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:30 - __main__ - INFO - ================================================================================
2025-10-11 12:10:30 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:30 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:30 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:30 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:30 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:30 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:30 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:30 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:30,408-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:30,408-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:30,626-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:30,626-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:30 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:30 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:30,893-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:30 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:30 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_ades_programacion'
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - Checking source_table: 'tpedid12f t2'
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(100)) nropedido,cast(cast(t2.articulo as bigint) as varchar(100)) articulo,cast(cast(t2.cliente as bigint) as varchar(100)) cliente,t.fecpedido fecpedido,t2.procpedido procpedido,t2.fechaentrega fechaentrega,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qcajcron qcajcron,t2.qbotcron qbotcron,t2.estado estado,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod'
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:30 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:30 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:30 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION process_guid: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:30 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION
2025-10-11 12:10:31 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:31 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:31 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:31 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:31 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:31 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:31 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION process_guid: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:31 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:31,111-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:31,174-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:31 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - üìé Table with JOIN: dbo.tpedid12f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO -    Partition column: t.fecpedido
2025-10-11 12:10:31 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:31 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:31 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid12f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:31 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:31 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid12f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.tpedid12f t2 inner join dbo.tpedid1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Execution time: 0.02s
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:31 - core.orchestrator - WARNING - ‚ö†Ô∏è No valid data found for partitioning (MIN/MAX returned None). Skipping table.
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid12f/year=2025/month=10/day=11/data_thread_0_chunk_0_67a403ad.parquet","timestamp":"2025-10-11 12:10:31,205-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/tpedid12f/year=2025/month=10/day=11/data_thread_0_chunk_0_67a403ad.parquet","timestamp":"2025-10-11 12:10:31,252-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:31 - core.orchestrator - WARNING - ‚ö†Ô∏è No records extracted for table T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION
2025-10-11 12:10:31 - bigmagic-monitor - WARNING - Advertencia procesando tabla T_DOCUMENTO_PEDIDO_ADES_PROGRAMACION: No data extracted - Table is empty or no records match filter criteria
2025-10-11 12:10:31 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:31 - bigmagic-dynamodb-monitor - WARNING - Warning registrado
2025-10-11 12:10:31 - extract.extractors.sql_server_extractor - INFO - üîí PyMSSQL connection closed
2025-10-11 12:10:31 - __main__ - INFO - ================================================================================
2025-10-11 12:10:31 - __main__ - INFO - üéâ EXTRACTION COMPLETED SUCCESSFULLY
2025-10-11 12:10:31 - __main__ - INFO - üÜî Process GUID: c5975d0a-4ccf-4944-bfff-ab13b2596587
2025-10-11 12:10:31 - __main__ - INFO - üìä Records: 0
2025-10-11 12:10:31 - __main__ - INFO - üìÅ Files: 1
2025-10-11 12:10:31 - __main__ - INFO - ‚è±Ô∏è Time: 0.14s
2025-10-11 12:10:31 - __main__ - INFO - üéØ Strategy: timerange
2025-10-11 12:10:31 - __main__ - INFO - ================================================================================
[s†b. 11/10/2025 12:05:27.39] Procesando tabla T_DOCUMENTO_PEDIDO_DETALLE... 
2025-10-11 12:10:32 - strategies.registry.strategy_registry - INFO - Registering strategy: full -> FullLoadStrategy
2025-10-11 12:10:32 - strategies.registry.strategy_registry - INFO - Registering strategy: incremental -> IncrementalStrategy
2025-10-11 12:10:32 - strategies.registry.strategy_registry - INFO - Registering strategy: time_range -> TimeRangeStrategy
2025-10-11 12:10:32 - strategies.registry.strategy_registry - INFO - All default strategies registered successfully
2025-10-11 12:10:32 - __main__ - INFO - üÜî Process GUID generado: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:32 - datalake-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:32 - datalake-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:32 - __main__ - INFO - üöÄ Starting Data Extraction Process
2025-10-11 12:10:32 - __main__ - INFO - ‚úÖ Environment validation passed
2025-10-11 12:10:32 - __main__ - INFO - ================================================================================
2025-10-11 12:10:32 - __main__ - INFO - üìã DATA EXTRACTION CONFIGURATION SUMMARY
2025-10-11 12:10:32 - __main__ - INFO - ================================================================================
2025-10-11 12:10:32 - __main__ - INFO - üÜî Process GUID: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:32 - __main__ - INFO - üìä Table: T_DOCUMENTO_PEDIDO_DETALLE
2025-10-11 12:10:32 - __main__ - INFO - üë• Team: apdayc
2025-10-11 12:10:32 - __main__ - INFO - üì° Source: bigmagic
2025-10-11 12:10:32 - __main__ - INFO - üîå Endpoint: PEBDDATA
2025-10-11 12:10:32 - __main__ - INFO - üåç Environment: DEV
2025-10-11 12:10:32 - __main__ - INFO - üÜï Load Mode: INITIAL
2025-10-11 12:10:32 - __main__ - INFO - üìÅ Format: parquet
2025-10-11 12:10:32 - __main__ - INFO - üßµ Threads: 1
2025-10-11 12:10:32 - __main__ - INFO - üì¶ Chunk Size: 50,000
2025-10-11 12:10:32 - __main__ - INFO - ================================================================================
2025-10-11 12:10:32 - __main__ - INFO - ‚ÑπÔ∏è  Primera carga - Extrae TODO y guarda watermark
2025-10-11 12:10:32 - __main__ - INFO - ================================================================================
2025-10-11 12:10:32 - core.orchestrator - INFO - üÜî Orchestrator initialized with process_guid: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:32 - core.orchestrator - INFO - === BUILDING TABLE CONFIG ===
2025-10-11 12:10:32 - core.orchestrator - INFO - Raw CSV row LOAD_TYPE: 'time_range'
2025-10-11 12:10:32 - core.orchestrator - INFO - After strip - load_type: 'time_range'
2025-10-11 12:10:32 - core.orchestrator - INFO - Before force_full_load check - load_type: 'time_range'
2025-10-11 12:10:32 - core.orchestrator - INFO - force_full_load setting: False
2025-10-11 12:10:32 - core.orchestrator - INFO - Final load_type: 'time_range'
2025-10-11 12:10:32 - core.orchestrator - INFO - === END BUILDING TABLE CONFIG ===
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': None, 'owner': None, 'auto_detect_env': True, 'force_local_mode': False}
SUCCESS: aws_lambda_powertools imported successfully in logger.py
üìù Created log file: ./logs\extract_data_20251011.log
‚úÖ Loaded .env file from: D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\.env
‚úÖ AWS Session configured with profile: prod-compliance-admin, region: us-east-1
üéØ Load Mode: INITIAL
DataLakeLogger global config updated: {'log_level': 20, 'log_directory': './logs', 'service_name': 'extract_data', 'correlation_id': 'apdayc-bigmagic-extract_data-T_DOCUMENTO_PEDIDO_DETALLE', 'owner': 'apdayc', 'auto_detect_env': True, 'force_local_mode': False}
üìù Created log file: ./logs\extract_data_20251011.log
============================================================
DATALAKE LOGGING ENVIRONMENT INFO
============================================================
Platform: Windows 2022Server
Python: 3.12.7
AWS Environment Detected: False
PowerTools Available: True
Force Local Mode: False
Log Level: INFO
Log Directory: ./logs
Service Name: extract_data
AWS Environment Variables:
  AWS_EXECUTION_ENV: Not Set
  AWS_REGION: Not Set
  GLUE_VERSION: Not Set
  AWS_DEFAULT_REGION: Not Set
============================================================
{"level":"INFO","location":"__init__:23","message":"Inicializando SecretsHelper para el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:32,595-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:31","message":"Intentando obtener el secreto: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:32,595-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:35","message":"Secreto obtenido con √©xito: dev/datalake/apdayc/bigmagic","timestamp":"2025-10-11 12:10:32,825-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"get_secret_value:43","message":"Retornando valor para la clave espec√≠fica: password","timestamp":"2025-10-11 12:10:32,825-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ESTABLISHING DATABASE CONNECTION (PyMSSQL)
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - Server: 172.16.0.7
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - Database: BDDATA
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - User: usr_datalake
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - Port: 1433
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ‚úÖ PyMSSQL connection established
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:32 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Database connection test successful (PyMSSQL)
2025-10-11 12:10:32 - core.orchestrator - INFO - Watermark storage not needed for this strategy
{"level":"INFO","location":"__init__:34","message":"Configured helper for S3 bucket: sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:33,096-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:33 - bigmagic-monitor - INFO - DynamoDBLogger inicializado - Tabla: sofia-dev-datalake-logs-ddb, SNS: True
2025-10-11 12:10:33 - bigmagic-dynamodb-monitor - INFO - DynamoDBMonitor inicializado usando DynamoDBLogger
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - === STRATEGY FACTORY ===
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Table: T_DOCUMENTO_PEDIDO_DETALLE
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Load type from config: 'time_range'
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Detected time range configuration for 'time_range' - using TIME_RANGE strategy
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Determined strategy type: time_range
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Creating strategy instance: TimeRangeStrategy
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY VALIDATION ===
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Checking stage_table_name: 't_documento_pedido_detalle'
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -   ‚úÖ stage_table_name is valid
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Checking source_schema: 'dbo'
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -   ‚úÖ source_schema is valid
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Checking source_table: 'thpedi2f t2'
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -   ‚úÖ source_table is valid
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Checking columns: 'dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido'
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -   ‚úÖ columns is valid
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - ‚úÖ ALL VALIDATION CHECKS PASSED
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - === END VALIDATION ===
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - Strategy instance created and wrapped in adapter successfully
2025-10-11 12:10:33 - strategies.strategy_factory - INFO - === END STRATEGY FACTORY ===
2025-10-11 12:10:33 - core.orchestrator - INFO - üöÄ Starting extraction - table: T_DOCUMENTO_PEDIDO_DETALLE process_guid: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:33 - bigmagic-monitor - INFO - Iniciando procesamiento de tabla T_DOCUMENTO_PEDIDO_DETALLE
2025-10-11 12:10:33 - bigmagic-monitor - INFO - Log registrado en DynamoDB
2025-10-11 12:10:33 - bigmagic-dynamodb-monitor - INFO - Inicio de extracci√≥n registrado
2025-10-11 12:10:33 - core.orchestrator - INFO - === STARTING CONFIGURATION VALIDATION ===
2025-10-11 12:10:33 - core.orchestrator - INFO - Validating strategy configuration...
2025-10-11 12:10:33 - core.orchestrator - INFO - ‚úÖ Strategy validation passed
2025-10-11 12:10:33 - core.orchestrator - INFO - === CONFIGURATION VALIDATION COMPLETED ===
2025-10-11 12:10:33 - core.orchestrator - INFO - üìä Executing timerange strategy - table: T_DOCUMENTO_PEDIDO_DETALLE process_guid: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:33 - core.orchestrator - INFO - timerange strategy - deleting existing files
{"level":"INFO","location":"list_objects:495","message":"Listing objects in bucket sofia-dev-datalake-510543735161-us-east-1-raw-s3","timestamp":"2025-10-11 12:10:33,330-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"list_objects:526","message":"Found 0 objects across 1 pages","timestamp":"2025-10-11 12:10:33,392-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:10:33 - strategies.adapters.strategy_adapter - INFO - === STRATEGY ADAPTER - Generating Queries ===
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - === TIME RANGE STRATEGY - Building Params ===
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Table: T_DOCUMENTO_PEDIDO_DETALLE
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - Load Mode: initial
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - üÜï INITIAL mode detected - Loading ALL historical data
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - üîß Building INITIAL load params (historical data)
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - üìä Transactional table detected - will use MIN/MAX partitioning
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - üîß Building PARTITIONED INITIAL load params
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - üìé Table with JOIN: dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - ‚ûï Basic filter: t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO - ‚úÖ Partitioned INITIAL params built - will load ALL historical data
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -    Partition column: t.fecpedido
2025-10-11 12:10:33 - strategies.implementations.time_range - INFO -    Total filters: 1 (NO date filters)
2025-10-11 12:10:33 - strategies.adapters.strategy_adapter - INFO - Partitioned load detected - returning min/max query
2025-10-11 12:10:33 - strategies.adapters.strategy_adapter - INFO - Generated Min/Max query: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:33 - core.orchestrator - INFO - üîç Thread 0 - Starting query execution - process_guid: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:10:33 - core.orchestrator - INFO - üîç Handling MIN/MAX query for partitioned load
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - Extraction mode: SINGLE QUERY
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:10:33 - extract.extractors.sql_server_extractor - INFO - Query preview: SELECT MIN(t.fecpedido) as min_val, MAX(t.fecpedido) as max_val FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido <> 0 AND t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a')
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Execution time: 27.31s
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Rows returned: 1
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Columns: 2
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Yielding single result with 1 rows
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION COMPLETED
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - core.orchestrator - INFO - üîç MIN/MAX results: min=7517, max=739534
2025-10-11 12:11:00 - core.orchestrator - INFO - üîç Generating 1 partitioned queries - Range: 732017, Increment: 732017
2025-10-11 12:11:00 - core.orchestrator - INFO - üîç Generated partitioned query: Range 7517-739535
2025-10-11 12:11:00 - core.orchestrator - INFO - üîç Executing 1 partitioned queries in parallel - process_guid: cdd06a63-cd3a-4ba6-b626-2e95084ed338
2025-10-11 12:11:00 - core.orchestrator - INFO - üîç DEBUG: Starting _execute_partition_query for thread 0
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - DATA EXTRACTION STARTED
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Extraction mode: CHUNKED
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Order by: t.fecpedido
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - CHUNKED QUERY EXECUTION
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - ================================================================================
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Chunk size: 50,000
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Order by: t.fecpedido
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Chunk #1: offset=0, size=50,000
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:00 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 0 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - Execution time: 2.92s
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - Chunk #1 returned 50,000 rows
2025-10-11 12:11:03 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 1 with 50,000 rows
2025-10-11 12:11:03 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 1 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec340011.parquet","timestamp":"2025-10-11 12:11:04,753-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec340011.parquet","timestamp":"2025-10-11 12:11:05,159-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:05 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec340011.parquet', 'file_name': 'data_thread_0_0_chunk_0_ec340011.parquet', 'file_size_bytes': 1217237, 'file_size_mb': Decimal('1.161'), 'records_count': 50000, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:11:05.159613', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.406'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:05 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_0_chunk_0_ec340011.parquet', 'file_name': 'data_thread_0_0_chunk_0_ec340011.parquet', 'file_size_bytes': 1217237, 'file_size_mb': Decimal('1.161'), 'records_count': 50000, 'thread_id': '0_0', 'chunk_id': 0, 'partition_index': None, 'created_at': '2025-10-11T12:11:05.159613', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.406'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - Chunk #2: offset=50,000, size=50,000
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 50000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:05 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 50000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - Execution time: 2.92s
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - Chunk #2 returned 50,000 rows
2025-10-11 12:11:08 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 2 with 50,000 rows
2025-10-11 12:11:08 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 2 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_0894b749.parquet","timestamp":"2025-10-11 12:11:09,222-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_0894b749.parquet","timestamp":"2025-10-11 12:11:09,362-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:09 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_0894b749.parquet', 'file_name': 'data_thread_0_1_chunk_1_0894b749.parquet', 'file_size_bytes': 1243033, 'file_size_mb': Decimal('1.185'), 'records_count': 50000, 'thread_id': '0_1', 'chunk_id': 1, 'partition_index': None, 'created_at': '2025-10-11T12:11:09.362868', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.156'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:09 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_1_chunk_1_0894b749.parquet', 'file_name': 'data_thread_0_1_chunk_1_0894b749.parquet', 'file_size_bytes': 1243033, 'file_size_mb': Decimal('1.185'), 'records_count': 50000, 'thread_id': '0_1', 'chunk_id': 1, 'partition_index': None, 'created_at': '2025-10-11T12:11:09.362868', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.156'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - Chunk #3: offset=100,000, size=50,000
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:09 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - Execution time: 13.20s
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - Chunk #3 returned 50,000 rows
2025-10-11 12:11:22 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 3 with 50,000 rows
2025-10-11 12:11:22 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 3 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_d6da8160.parquet","timestamp":"2025-10-11 12:11:23,691-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_d6da8160.parquet","timestamp":"2025-10-11 12:11:24,050-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:24 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_d6da8160.parquet', 'file_name': 'data_thread_0_2_chunk_2_d6da8160.parquet', 'file_size_bytes': 1292010, 'file_size_mb': Decimal('1.232'), 'records_count': 50000, 'thread_id': '0_2', 'chunk_id': 2, 'partition_index': None, 'created_at': '2025-10-11T12:11:24.050821', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:24 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_2_chunk_2_d6da8160.parquet', 'file_name': 'data_thread_0_2_chunk_2_d6da8160.parquet', 'file_size_bytes': 1292010, 'file_size_mb': Decimal('1.232'), 'records_count': 50000, 'thread_id': '0_2', 'chunk_id': 2, 'partition_index': None, 'created_at': '2025-10-11T12:11:24.050821', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - Chunk #4: offset=150,000, size=50,000
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:24 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.02s
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - Chunk #4 returned 50,000 rows
2025-10-11 12:11:27 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 4 with 50,000 rows
2025-10-11 12:11:27 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 4 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_94e14c92.parquet","timestamp":"2025-10-11 12:11:28,175-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_94e14c92.parquet","timestamp":"2025-10-11 12:11:28,285-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:28 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_94e14c92.parquet', 'file_name': 'data_thread_0_3_chunk_3_94e14c92.parquet', 'file_size_bytes': 1094206, 'file_size_mb': Decimal('1.044'), 'records_count': 50000, 'thread_id': '0_3', 'chunk_id': 3, 'partition_index': None, 'created_at': '2025-10-11T12:11:28.285333', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:28 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_3_chunk_3_94e14c92.parquet', 'file_name': 'data_thread_0_3_chunk_3_94e14c92.parquet', 'file_size_bytes': 1094206, 'file_size_mb': Decimal('1.044'), 'records_count': 50000, 'thread_id': '0_3', 'chunk_id': 3, 'partition_index': None, 'created_at': '2025-10-11T12:11:28.285333', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - Chunk #5: offset=200,000, size=50,000
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:28 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.09s
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - Chunk #5 returned 50,000 rows
2025-10-11 12:11:31 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 5 with 50,000 rows
2025-10-11 12:11:31 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 5 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_4_chunk_4_ec0e37ae.parquet","timestamp":"2025-10-11 12:11:32,566-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_4_chunk_4_ec0e37ae.parquet","timestamp":"2025-10-11 12:11:32,769-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:32 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_4_chunk_4_ec0e37ae.parquet', 'file_name': 'data_thread_0_4_chunk_4_ec0e37ae.parquet', 'file_size_bytes': 1041832, 'file_size_mb': Decimal('0.994'), 'records_count': 50000, 'thread_id': '0_4', 'chunk_id': 4, 'partition_index': None, 'created_at': '2025-10-11T12:11:32.769849', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.203'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:32 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_4_chunk_4_ec0e37ae.parquet', 'file_name': 'data_thread_0_4_chunk_4_ec0e37ae.parquet', 'file_size_bytes': 1041832, 'file_size_mb': Decimal('0.994'), 'records_count': 50000, 'thread_id': '0_4', 'chunk_id': 4, 'partition_index': None, 'created_at': '2025-10-11T12:11:32.769849', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.203'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - Chunk #6: offset=250,000, size=50,000
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:32 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.11s
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - Chunk #6 returned 50,000 rows
2025-10-11 12:11:35 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 6 with 50,000 rows
2025-10-11 12:11:35 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 6 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_5_chunk_5_83782798.parquet","timestamp":"2025-10-11 12:11:37,066-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_5_chunk_5_83782798.parquet","timestamp":"2025-10-11 12:11:37,285-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:37 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_5_chunk_5_83782798.parquet', 'file_name': 'data_thread_0_5_chunk_5_83782798.parquet', 'file_size_bytes': 1094707, 'file_size_mb': Decimal('1.044'), 'records_count': 50000, 'thread_id': '0_5', 'chunk_id': 5, 'partition_index': None, 'created_at': '2025-10-11T12:11:37.285614', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.219'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:37 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_5_chunk_5_83782798.parquet', 'file_name': 'data_thread_0_5_chunk_5_83782798.parquet', 'file_size_bytes': 1094707, 'file_size_mb': Decimal('1.044'), 'records_count': 50000, 'thread_id': '0_5', 'chunk_id': 5, 'partition_index': None, 'created_at': '2025-10-11T12:11:37.285614', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.219'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - Chunk #7: offset=300,000, size=50,000
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:37 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.20s
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - Chunk #7 returned 50,000 rows
2025-10-11 12:11:40 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 7 with 50,000 rows
2025-10-11 12:11:40 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 7 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_6_chunk_6_8e48a11a.parquet","timestamp":"2025-10-11 12:11:41,645-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_6_chunk_6_8e48a11a.parquet","timestamp":"2025-10-11 12:11:41,770-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:41 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_6_chunk_6_8e48a11a.parquet', 'file_name': 'data_thread_0_6_chunk_6_8e48a11a.parquet', 'file_size_bytes': 1065129, 'file_size_mb': Decimal('1.016'), 'records_count': 50000, 'thread_id': '0_6', 'chunk_id': 6, 'partition_index': None, 'created_at': '2025-10-11T12:11:41.770131', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:41 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_6_chunk_6_8e48a11a.parquet', 'file_name': 'data_thread_0_6_chunk_6_8e48a11a.parquet', 'file_size_bytes': 1065129, 'file_size_mb': Decimal('1.016'), 'records_count': 50000, 'thread_id': '0_6', 'chunk_id': 6, 'partition_index': None, 'created_at': '2025-10-11T12:11:41.770131', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - Chunk #8: offset=350,000, size=50,000
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:41 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.20s
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - Chunk #8 returned 50,000 rows
2025-10-11 12:11:44 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 8 with 50,000 rows
2025-10-11 12:11:45 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 8 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_7_chunk_7_cfa78352.parquet","timestamp":"2025-10-11 12:11:46,239-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_7_chunk_7_cfa78352.parquet","timestamp":"2025-10-11 12:11:46,426-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:46 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_7_chunk_7_cfa78352.parquet', 'file_name': 'data_thread_0_7_chunk_7_cfa78352.parquet', 'file_size_bytes': 1089775, 'file_size_mb': Decimal('1.039'), 'records_count': 50000, 'thread_id': '0_7', 'chunk_id': 7, 'partition_index': None, 'created_at': '2025-10-11T12:11:46.426529', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.219'), 'upload_duration_seconds': Decimal('0.188'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:46 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_7_chunk_7_cfa78352.parquet', 'file_name': 'data_thread_0_7_chunk_7_cfa78352.parquet', 'file_size_bytes': 1089775, 'file_size_mb': Decimal('1.039'), 'records_count': 50000, 'thread_id': '0_7', 'chunk_id': 7, 'partition_index': None, 'created_at': '2025-10-11T12:11:46.426529', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.219'), 'upload_duration_seconds': Decimal('0.188'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - Chunk #9: offset=400,000, size=50,000
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:46 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.25s
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - Chunk #9 returned 50,000 rows
2025-10-11 12:11:49 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 9 with 50,000 rows
2025-10-11 12:11:49 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 9 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_8_chunk_8_87e09b84.parquet","timestamp":"2025-10-11 12:11:50,832-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_8_chunk_8_87e09b84.parquet","timestamp":"2025-10-11 12:11:50,911-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:50 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_8_chunk_8_87e09b84.parquet', 'file_name': 'data_thread_0_8_chunk_8_87e09b84.parquet', 'file_size_bytes': 1078430, 'file_size_mb': Decimal('1.028'), 'records_count': 50000, 'thread_id': '0_8', 'chunk_id': 8, 'partition_index': None, 'created_at': '2025-10-11T12:11:50.911040', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.078'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:50 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_8_chunk_8_87e09b84.parquet', 'file_name': 'data_thread_0_8_chunk_8_87e09b84.parquet', 'file_size_bytes': 1078430, 'file_size_mb': Decimal('1.028'), 'records_count': 50000, 'thread_id': '0_8', 'chunk_id': 8, 'partition_index': None, 'created_at': '2025-10-11T12:11:50.911040', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.078'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - Chunk #10: offset=450,000, size=50,000
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:50 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.28s
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - Chunk #10 returned 50,000 rows
2025-10-11 12:11:54 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 10 with 50,000 rows
2025-10-11 12:11:54 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 10 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_9_chunk_9_bea2ee1a.parquet","timestamp":"2025-10-11 12:11:55,364-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_9_chunk_9_bea2ee1a.parquet","timestamp":"2025-10-11 12:11:55,458-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:11:55 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_9_chunk_9_bea2ee1a.parquet', 'file_name': 'data_thread_0_9_chunk_9_bea2ee1a.parquet', 'file_size_bytes': 1043427, 'file_size_mb': Decimal('0.995'), 'records_count': 50000, 'thread_id': '0_9', 'chunk_id': 9, 'partition_index': None, 'created_at': '2025-10-11T12:11:55.458061', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:11:55 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_9_chunk_9_bea2ee1a.parquet', 'file_name': 'data_thread_0_9_chunk_9_bea2ee1a.parquet', 'file_size_bytes': 1043427, 'file_size_mb': Decimal('0.995'), 'records_count': 50000, 'thread_id': '0_9', 'chunk_id': 9, 'partition_index': None, 'created_at': '2025-10-11T12:11:55.458061', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - Chunk #11: offset=500,000, size=50,000
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:11:55 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.42s
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - Chunk #11 returned 50,000 rows
2025-10-11 12:11:58 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 11 with 50,000 rows
2025-10-11 12:11:58 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 11 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_10_chunk_10_40b7ea29.parquet","timestamp":"2025-10-11 12:12:00,077-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_10_chunk_10_40b7ea29.parquet","timestamp":"2025-10-11 12:12:00,203-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:00 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_10_chunk_10_40b7ea29.parquet', 'file_name': 'data_thread_0_10_chunk_10_40b7ea29.parquet', 'file_size_bytes': 1037991, 'file_size_mb': Decimal('0.99'), 'records_count': 50000, 'thread_id': '0_10', 'chunk_id': 10, 'partition_index': None, 'created_at': '2025-10-11T12:12:00.203586', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.166'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:00 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_10_chunk_10_40b7ea29.parquet', 'file_name': 'data_thread_0_10_chunk_10_40b7ea29.parquet', 'file_size_bytes': 1037991, 'file_size_mb': Decimal('0.99'), 'records_count': 50000, 'thread_id': '0_10', 'chunk_id': 10, 'partition_index': None, 'created_at': '2025-10-11T12:12:00.203586', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.166'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - Chunk #12: offset=550,000, size=50,000
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:00 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.49s
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - Chunk #12 returned 50,000 rows
2025-10-11 12:12:03 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 12 with 50,000 rows
2025-10-11 12:12:03 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 12 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_11_chunk_11_a1d8d0d7.parquet","timestamp":"2025-10-11 12:12:04,912-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_11_chunk_11_a1d8d0d7.parquet","timestamp":"2025-10-11 12:12:05,020-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:05 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_11_chunk_11_a1d8d0d7.parquet', 'file_name': 'data_thread_0_11_chunk_11_a1d8d0d7.parquet', 'file_size_bytes': 1060437, 'file_size_mb': Decimal('1.011'), 'records_count': 50000, 'thread_id': '0_11', 'chunk_id': 11, 'partition_index': None, 'created_at': '2025-10-11T12:12:05.020504', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.181'), 'upload_duration_seconds': Decimal('0.108'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:05 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_11_chunk_11_a1d8d0d7.parquet', 'file_name': 'data_thread_0_11_chunk_11_a1d8d0d7.parquet', 'file_size_bytes': 1060437, 'file_size_mb': Decimal('1.011'), 'records_count': 50000, 'thread_id': '0_11', 'chunk_id': 11, 'partition_index': None, 'created_at': '2025-10-11T12:12:05.020504', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.181'), 'upload_duration_seconds': Decimal('0.108'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - Chunk #13: offset=600,000, size=50,000
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:05 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.67s
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - Chunk #13 returned 50,000 rows
2025-10-11 12:12:08 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 13 with 50,000 rows
2025-10-11 12:12:08 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 13 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_12_chunk_12_c1fcba21.parquet","timestamp":"2025-10-11 12:12:09,848-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_12_chunk_12_c1fcba21.parquet","timestamp":"2025-10-11 12:12:09,957-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:09 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_12_chunk_12_c1fcba21.parquet', 'file_name': 'data_thread_0_12_chunk_12_c1fcba21.parquet', 'file_size_bytes': 1180521, 'file_size_mb': Decimal('1.126'), 'records_count': 50000, 'thread_id': '0_12', 'chunk_id': 12, 'partition_index': None, 'created_at': '2025-10-11T12:12:09.957937', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:09 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_12_chunk_12_c1fcba21.parquet', 'file_name': 'data_thread_0_12_chunk_12_c1fcba21.parquet', 'file_size_bytes': 1180521, 'file_size_mb': Decimal('1.126'), 'records_count': 50000, 'thread_id': '0_12', 'chunk_id': 12, 'partition_index': None, 'created_at': '2025-10-11T12:12:09.957937', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - Chunk #14: offset=650,000, size=50,000
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:09 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.44s
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - Chunk #14 returned 50,000 rows
2025-10-11 12:12:13 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 14 with 50,000 rows
2025-10-11 12:12:13 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 14 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_13_chunk_13_7df1d4e9.parquet","timestamp":"2025-10-11 12:12:14,583-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_13_chunk_13_7df1d4e9.parquet","timestamp":"2025-10-11 12:12:14,676-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:14 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_13_chunk_13_7df1d4e9.parquet', 'file_name': 'data_thread_0_13_chunk_13_7df1d4e9.parquet', 'file_size_bytes': 1149740, 'file_size_mb': Decimal('1.096'), 'records_count': 50000, 'thread_id': '0_13', 'chunk_id': 13, 'partition_index': None, 'created_at': '2025-10-11T12:12:14.676849', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.156'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:14 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_13_chunk_13_7df1d4e9.parquet', 'file_name': 'data_thread_0_13_chunk_13_7df1d4e9.parquet', 'file_size_bytes': 1149740, 'file_size_mb': Decimal('1.096'), 'records_count': 50000, 'thread_id': '0_13', 'chunk_id': 13, 'partition_index': None, 'created_at': '2025-10-11T12:12:14.676849', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.156'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - Chunk #15: offset=700,000, size=50,000
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:14 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.60s
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - Chunk #15 returned 50,000 rows
2025-10-11 12:12:18 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 15 with 50,000 rows
2025-10-11 12:12:18 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 15 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_14_chunk_14_6f8a5cbe.parquet","timestamp":"2025-10-11 12:12:19,458-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_14_chunk_14_6f8a5cbe.parquet","timestamp":"2025-10-11 12:12:19,599-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:19 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_14_chunk_14_6f8a5cbe.parquet', 'file_name': 'data_thread_0_14_chunk_14_6f8a5cbe.parquet', 'file_size_bytes': 1168084, 'file_size_mb': Decimal('1.114'), 'records_count': 50000, 'thread_id': '0_14', 'chunk_id': 14, 'partition_index': None, 'created_at': '2025-10-11T12:12:19.599915', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.144'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:19 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_14_chunk_14_6f8a5cbe.parquet', 'file_name': 'data_thread_0_14_chunk_14_6f8a5cbe.parquet', 'file_size_bytes': 1168084, 'file_size_mb': Decimal('1.114'), 'records_count': 50000, 'thread_id': '0_14', 'chunk_id': 14, 'partition_index': None, 'created_at': '2025-10-11T12:12:19.599915', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.144'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - Chunk #16: offset=750,000, size=50,000
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:19 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.68s
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - Chunk #16 returned 50,000 rows
2025-10-11 12:12:23 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 16 with 50,000 rows
2025-10-11 12:12:23 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 16 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_15_chunk_15_0d4e2f7b.parquet","timestamp":"2025-10-11 12:12:24,533-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_15_chunk_15_0d4e2f7b.parquet","timestamp":"2025-10-11 12:12:24,652-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:24 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_15_chunk_15_0d4e2f7b.parquet', 'file_name': 'data_thread_0_15_chunk_15_0d4e2f7b.parquet', 'file_size_bytes': 1229047, 'file_size_mb': Decimal('1.172'), 'records_count': 50000, 'thread_id': '0_15', 'chunk_id': 15, 'partition_index': None, 'created_at': '2025-10-11T12:12:24.652848', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.215'), 'upload_duration_seconds': Decimal('0.119'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:24 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_15_chunk_15_0d4e2f7b.parquet', 'file_name': 'data_thread_0_15_chunk_15_0d4e2f7b.parquet', 'file_size_bytes': 1229047, 'file_size_mb': Decimal('1.172'), 'records_count': 50000, 'thread_id': '0_15', 'chunk_id': 15, 'partition_index': None, 'created_at': '2025-10-11T12:12:24.652848', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.215'), 'upload_duration_seconds': Decimal('0.119'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - Chunk #17: offset=800,000, size=50,000
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:24 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.68s
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - Chunk #17 returned 50,000 rows
2025-10-11 12:12:28 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 17 with 50,000 rows
2025-10-11 12:12:28 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 17 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_16_chunk_16_6d08c0ee.parquet","timestamp":"2025-10-11 12:12:29,540-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_16_chunk_16_6d08c0ee.parquet","timestamp":"2025-10-11 12:12:29,739-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:29 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_16_chunk_16_6d08c0ee.parquet', 'file_name': 'data_thread_0_16_chunk_16_6d08c0ee.parquet', 'file_size_bytes': 1129066, 'file_size_mb': Decimal('1.077'), 'records_count': 50000, 'thread_id': '0_16', 'chunk_id': 16, 'partition_index': None, 'created_at': '2025-10-11T12:12:29.739994', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.17'), 'upload_duration_seconds': Decimal('0.2'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:29 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_16_chunk_16_6d08c0ee.parquet', 'file_name': 'data_thread_0_16_chunk_16_6d08c0ee.parquet', 'file_size_bytes': 1129066, 'file_size_mb': Decimal('1.077'), 'records_count': 50000, 'thread_id': '0_16', 'chunk_id': 16, 'partition_index': None, 'created_at': '2025-10-11T12:12:29.739994', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.17'), 'upload_duration_seconds': Decimal('0.2'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - Chunk #18: offset=850,000, size=50,000
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:29 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.66s
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - Chunk #18 returned 50,000 rows
2025-10-11 12:12:33 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 18 with 50,000 rows
2025-10-11 12:12:33 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 18 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_17_chunk_17_fef4297d.parquet","timestamp":"2025-10-11 12:12:34,572-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_17_chunk_17_fef4297d.parquet","timestamp":"2025-10-11 12:12:34,684-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:34 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_17_chunk_17_fef4297d.parquet', 'file_name': 'data_thread_0_17_chunk_17_fef4297d.parquet', 'file_size_bytes': 1164827, 'file_size_mb': Decimal('1.111'), 'records_count': 50000, 'thread_id': '0_17', 'chunk_id': 17, 'partition_index': None, 'created_at': '2025-10-11T12:12:34.684937', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.145'), 'upload_duration_seconds': Decimal('0.112'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:34 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_17_chunk_17_fef4297d.parquet', 'file_name': 'data_thread_0_17_chunk_17_fef4297d.parquet', 'file_size_bytes': 1164827, 'file_size_mb': Decimal('1.111'), 'records_count': 50000, 'thread_id': '0_17', 'chunk_id': 17, 'partition_index': None, 'created_at': '2025-10-11T12:12:34.684937', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.145'), 'upload_duration_seconds': Decimal('0.112'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - Chunk #19: offset=900,000, size=50,000
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:34 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.93s
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - Chunk #19 returned 50,000 rows
2025-10-11 12:12:38 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 19 with 50,000 rows
2025-10-11 12:12:38 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 19 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_18_chunk_18_1e6a3dc3.parquet","timestamp":"2025-10-11 12:12:39,819-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_18_chunk_18_1e6a3dc3.parquet","timestamp":"2025-10-11 12:12:39,942-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:39 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_18_chunk_18_1e6a3dc3.parquet', 'file_name': 'data_thread_0_18_chunk_18_1e6a3dc3.parquet', 'file_size_bytes': 1067814, 'file_size_mb': Decimal('1.018'), 'records_count': 50000, 'thread_id': '0_18', 'chunk_id': 18, 'partition_index': None, 'created_at': '2025-10-11T12:12:39.942717', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.173'), 'upload_duration_seconds': Decimal('0.123'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:39 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_18_chunk_18_1e6a3dc3.parquet', 'file_name': 'data_thread_0_18_chunk_18_1e6a3dc3.parquet', 'file_size_bytes': 1067814, 'file_size_mb': Decimal('1.018'), 'records_count': 50000, 'thread_id': '0_18', 'chunk_id': 18, 'partition_index': None, 'created_at': '2025-10-11T12:12:39.942717', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.173'), 'upload_duration_seconds': Decimal('0.123'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - Chunk #20: offset=950,000, size=50,000
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:39 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.78s
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - Chunk #20 returned 50,000 rows
2025-10-11 12:12:43 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 20 with 50,000 rows
2025-10-11 12:12:43 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 20 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_19_chunk_19_4959ab3f.parquet","timestamp":"2025-10-11 12:12:44,893-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_19_chunk_19_4959ab3f.parquet","timestamp":"2025-10-11 12:12:45,019-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:45 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_19_chunk_19_4959ab3f.parquet', 'file_name': 'data_thread_0_19_chunk_19_4959ab3f.parquet', 'file_size_bytes': 1018892, 'file_size_mb': Decimal('0.972'), 'records_count': 50000, 'thread_id': '0_19', 'chunk_id': 19, 'partition_index': None, 'created_at': '2025-10-11T12:12:45.020573', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.132'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:45 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_19_chunk_19_4959ab3f.parquet', 'file_name': 'data_thread_0_19_chunk_19_4959ab3f.parquet', 'file_size_bytes': 1018892, 'file_size_mb': Decimal('0.972'), 'records_count': 50000, 'thread_id': '0_19', 'chunk_id': 19, 'partition_index': None, 'created_at': '2025-10-11T12:12:45.020573', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.132'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - Chunk #21: offset=1,000,000, size=50,000
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:45 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.94s
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - Chunk #21 returned 50,000 rows
2025-10-11 12:12:48 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 21 with 50,000 rows
2025-10-11 12:12:48 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 21 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_20_chunk_20_2c5feb21.parquet","timestamp":"2025-10-11 12:12:50,151-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_20_chunk_20_2c5feb21.parquet","timestamp":"2025-10-11 12:12:50,287-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:50 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_20_chunk_20_2c5feb21.parquet', 'file_name': 'data_thread_0_20_chunk_20_2c5feb21.parquet', 'file_size_bytes': 948411, 'file_size_mb': Decimal('0.904'), 'records_count': 50000, 'thread_id': '0_20', 'chunk_id': 20, 'partition_index': None, 'created_at': '2025-10-11T12:12:50.287961', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.156'), 'upload_duration_seconds': Decimal('0.137'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:50 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_20_chunk_20_2c5feb21.parquet', 'file_name': 'data_thread_0_20_chunk_20_2c5feb21.parquet', 'file_size_bytes': 948411, 'file_size_mb': Decimal('0.904'), 'records_count': 50000, 'thread_id': '0_20', 'chunk_id': 20, 'partition_index': None, 'created_at': '2025-10-11T12:12:50.287961', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.156'), 'upload_duration_seconds': Decimal('0.137'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - Chunk #22: offset=1,050,000, size=50,000
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:50 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - Execution time: 3.84s
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - Chunk #22 returned 50,000 rows
2025-10-11 12:12:54 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 22 with 50,000 rows
2025-10-11 12:12:54 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 22 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_21_chunk_21_b893ebec.parquet","timestamp":"2025-10-11 12:12:55,329-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_21_chunk_21_b893ebec.parquet","timestamp":"2025-10-11 12:12:55,537-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:12:55 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_21_chunk_21_b893ebec.parquet', 'file_name': 'data_thread_0_21_chunk_21_b893ebec.parquet', 'file_size_bytes': 976243, 'file_size_mb': Decimal('0.931'), 'records_count': 50000, 'thread_id': '0_21', 'chunk_id': 21, 'partition_index': None, 'created_at': '2025-10-11T12:12:55.537701', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.166'), 'upload_duration_seconds': Decimal('0.209'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:12:55 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_21_chunk_21_b893ebec.parquet', 'file_name': 'data_thread_0_21_chunk_21_b893ebec.parquet', 'file_size_bytes': 976243, 'file_size_mb': Decimal('0.931'), 'records_count': 50000, 'thread_id': '0_21', 'chunk_id': 21, 'partition_index': None, 'created_at': '2025-10-11T12:12:55.537701', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.166'), 'upload_duration_seconds': Decimal('0.209'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - Chunk #23: offset=1,100,000, size=50,000
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:12:55 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.07s
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - Chunk #23 returned 50,000 rows
2025-10-11 12:12:59 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 23 with 50,000 rows
2025-10-11 12:12:59 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 23 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_22_chunk_22_a7eccefb.parquet","timestamp":"2025-10-11 12:13:00,771-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_22_chunk_22_a7eccefb.parquet","timestamp":"2025-10-11 12:13:00,912-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:00 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_22_chunk_22_a7eccefb.parquet', 'file_name': 'data_thread_0_22_chunk_22_a7eccefb.parquet', 'file_size_bytes': 1056594, 'file_size_mb': Decimal('1.008'), 'records_count': 50000, 'thread_id': '0_22', 'chunk_id': 22, 'partition_index': None, 'created_at': '2025-10-11T12:13:00.912935', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.139'), 'upload_duration_seconds': Decimal('0.143'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:00 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_22_chunk_22_a7eccefb.parquet', 'file_name': 'data_thread_0_22_chunk_22_a7eccefb.parquet', 'file_size_bytes': 1056594, 'file_size_mb': Decimal('1.008'), 'records_count': 50000, 'thread_id': '0_22', 'chunk_id': 22, 'partition_index': None, 'created_at': '2025-10-11T12:13:00.912935', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.139'), 'upload_duration_seconds': Decimal('0.143'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - Chunk #24: offset=1,150,000, size=50,000
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:00 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.01s
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - Chunk #24 returned 50,000 rows
2025-10-11 12:13:04 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 24 with 50,000 rows
2025-10-11 12:13:04 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 24 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_23_chunk_23_5c23bf1d.parquet","timestamp":"2025-10-11 12:13:06,116-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_23_chunk_23_5c23bf1d.parquet","timestamp":"2025-10-11 12:13:06,209-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:06 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_23_chunk_23_5c23bf1d.parquet', 'file_name': 'data_thread_0_23_chunk_23_5c23bf1d.parquet', 'file_size_bytes': 1006543, 'file_size_mb': Decimal('0.96'), 'records_count': 50000, 'thread_id': '0_23', 'chunk_id': 23, 'partition_index': None, 'created_at': '2025-10-11T12:13:06.209906', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.133'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:06 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_23_chunk_23_5c23bf1d.parquet', 'file_name': 'data_thread_0_23_chunk_23_5c23bf1d.parquet', 'file_size_bytes': 1006543, 'file_size_mb': Decimal('0.96'), 'records_count': 50000, 'thread_id': '0_23', 'chunk_id': 23, 'partition_index': None, 'created_at': '2025-10-11T12:13:06.209906', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.133'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - Chunk #25: offset=1,200,000, size=50,000
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:06 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.08s
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - Chunk #25 returned 50,000 rows
2025-10-11 12:13:10 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 25 with 50,000 rows
2025-10-11 12:13:10 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 25 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_24_chunk_24_1b973833.parquet","timestamp":"2025-10-11 12:13:11,460-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_24_chunk_24_1b973833.parquet","timestamp":"2025-10-11 12:13:11,587-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:11 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_24_chunk_24_1b973833.parquet', 'file_name': 'data_thread_0_24_chunk_24_1b973833.parquet', 'file_size_bytes': 961866, 'file_size_mb': Decimal('0.917'), 'records_count': 50000, 'thread_id': '0_24', 'chunk_id': 24, 'partition_index': None, 'created_at': '2025-10-11T12:13:11.587069', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.134'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:11 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_24_chunk_24_1b973833.parquet', 'file_name': 'data_thread_0_24_chunk_24_1b973833.parquet', 'file_size_bytes': 961866, 'file_size_mb': Decimal('0.917'), 'records_count': 50000, 'thread_id': '0_24', 'chunk_id': 24, 'partition_index': None, 'created_at': '2025-10-11T12:13:11.587069', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.134'), 'upload_duration_seconds': Decimal('0.127'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - Chunk #26: offset=1,250,000, size=50,000
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:11 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.05s
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - Chunk #26 returned 50,000 rows
2025-10-11 12:13:15 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 26 with 50,000 rows
2025-10-11 12:13:15 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 26 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_25_chunk_25_c00cd1b5.parquet","timestamp":"2025-10-11 12:13:16,788-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_25_chunk_25_c00cd1b5.parquet","timestamp":"2025-10-11 12:13:16,938-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:16 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_25_chunk_25_c00cd1b5.parquet', 'file_name': 'data_thread_0_25_chunk_25_c00cd1b5.parquet', 'file_size_bytes': 990614, 'file_size_mb': Decimal('0.945'), 'records_count': 50000, 'thread_id': '0_25', 'chunk_id': 25, 'partition_index': None, 'created_at': '2025-10-11T12:13:16.938497', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.114'), 'upload_duration_seconds': Decimal('0.15'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:16 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_25_chunk_25_c00cd1b5.parquet', 'file_name': 'data_thread_0_25_chunk_25_c00cd1b5.parquet', 'file_size_bytes': 990614, 'file_size_mb': Decimal('0.945'), 'records_count': 50000, 'thread_id': '0_25', 'chunk_id': 25, 'partition_index': None, 'created_at': '2025-10-11T12:13:16.938497', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.114'), 'upload_duration_seconds': Decimal('0.15'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - Chunk #27: offset=1,300,000, size=50,000
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:16 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.08s
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - Chunk #27 returned 50,000 rows
2025-10-11 12:13:21 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 27 with 50,000 rows
2025-10-11 12:13:21 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 27 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_26_chunk_26_9cf71a56.parquet","timestamp":"2025-10-11 12:13:22,179-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_26_chunk_26_9cf71a56.parquet","timestamp":"2025-10-11 12:13:22,319-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:22 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_26_chunk_26_9cf71a56.parquet', 'file_name': 'data_thread_0_26_chunk_26_9cf71a56.parquet', 'file_size_bytes': 915855, 'file_size_mb': Decimal('0.873'), 'records_count': 50000, 'thread_id': '0_26', 'chunk_id': 26, 'partition_index': None, 'created_at': '2025-10-11T12:13:22.319554', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.123'), 'upload_duration_seconds': Decimal('0.14'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:22 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_26_chunk_26_9cf71a56.parquet', 'file_name': 'data_thread_0_26_chunk_26_9cf71a56.parquet', 'file_size_bytes': 915855, 'file_size_mb': Decimal('0.873'), 'records_count': 50000, 'thread_id': '0_26', 'chunk_id': 26, 'partition_index': None, 'created_at': '2025-10-11T12:13:22.319554', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.123'), 'upload_duration_seconds': Decimal('0.14'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - Chunk #28: offset=1,350,000, size=50,000
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:22 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.13s
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - Chunk #28 returned 50,000 rows
2025-10-11 12:13:26 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 28 with 50,000 rows
2025-10-11 12:13:26 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 28 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_27_chunk_27_cf3c75f3.parquet","timestamp":"2025-10-11 12:13:27,616-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_27_chunk_27_cf3c75f3.parquet","timestamp":"2025-10-11 12:13:27,726-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:27 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_27_chunk_27_cf3c75f3.parquet', 'file_name': 'data_thread_0_27_chunk_27_cf3c75f3.parquet', 'file_size_bytes': 910363, 'file_size_mb': Decimal('0.868'), 'records_count': 50000, 'thread_id': '0_27', 'chunk_id': 27, 'partition_index': None, 'created_at': '2025-10-11T12:13:27.726379', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.13'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:27 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_27_chunk_27_cf3c75f3.parquet', 'file_name': 'data_thread_0_27_chunk_27_cf3c75f3.parquet', 'file_size_bytes': 910363, 'file_size_mb': Decimal('0.868'), 'records_count': 50000, 'thread_id': '0_27', 'chunk_id': 27, 'partition_index': None, 'created_at': '2025-10-11T12:13:27.726379', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.13'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - Chunk #29: offset=1,400,000, size=50,000
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:27 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.17s
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - Chunk #29 returned 50,000 rows
2025-10-11 12:13:31 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 29 with 50,000 rows
2025-10-11 12:13:31 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 29 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_28_chunk_28_3b9ea791.parquet","timestamp":"2025-10-11 12:13:33,056-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_28_chunk_28_3b9ea791.parquet","timestamp":"2025-10-11 12:13:33,164-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:33 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_28_chunk_28_3b9ea791.parquet', 'file_name': 'data_thread_0_28_chunk_28_3b9ea791.parquet', 'file_size_bytes': 932998, 'file_size_mb': Decimal('0.89'), 'records_count': 50000, 'thread_id': '0_28', 'chunk_id': 28, 'partition_index': None, 'created_at': '2025-10-11T12:13:33.164193', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.107'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:33 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_28_chunk_28_3b9ea791.parquet', 'file_name': 'data_thread_0_28_chunk_28_3b9ea791.parquet', 'file_size_bytes': 932998, 'file_size_mb': Decimal('0.89'), 'records_count': 50000, 'thread_id': '0_28', 'chunk_id': 28, 'partition_index': None, 'created_at': '2025-10-11T12:13:33.164193', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.107'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - Chunk #30: offset=1,450,000, size=50,000
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:33 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.25s
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - Chunk #30 returned 50,000 rows
2025-10-11 12:13:37 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 30 with 50,000 rows
2025-10-11 12:13:37 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 30 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_29_chunk_29_b548a2dd.parquet","timestamp":"2025-10-11 12:13:38,523-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_29_chunk_29_b548a2dd.parquet","timestamp":"2025-10-11 12:13:38,711-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:38 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_29_chunk_29_b548a2dd.parquet', 'file_name': 'data_thread_0_29_chunk_29_b548a2dd.parquet', 'file_size_bytes': 925499, 'file_size_mb': Decimal('0.883'), 'records_count': 50000, 'thread_id': '0_29', 'chunk_id': 29, 'partition_index': None, 'created_at': '2025-10-11T12:13:38.711429', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.188'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:38 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_29_chunk_29_b548a2dd.parquet', 'file_name': 'data_thread_0_29_chunk_29_b548a2dd.parquet', 'file_size_bytes': 925499, 'file_size_mb': Decimal('0.883'), 'records_count': 50000, 'thread_id': '0_29', 'chunk_id': 29, 'partition_index': None, 'created_at': '2025-10-11T12:13:38.711429', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.188'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - Chunk #31: offset=1,500,000, size=50,000
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:38 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.13s
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - Chunk #31 returned 50,000 rows
2025-10-11 12:13:42 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 31 with 50,000 rows
2025-10-11 12:13:42 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 31 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_30_chunk_30_b930b6f6.parquet","timestamp":"2025-10-11 12:13:43,977-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_30_chunk_30_b930b6f6.parquet","timestamp":"2025-10-11 12:13:44,133-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:44 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_30_chunk_30_b930b6f6.parquet', 'file_name': 'data_thread_0_30_chunk_30_b930b6f6.parquet', 'file_size_bytes': 860939, 'file_size_mb': Decimal('0.821'), 'records_count': 50000, 'thread_id': '0_30', 'chunk_id': 30, 'partition_index': None, 'created_at': '2025-10-11T12:13:44.133473', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.156'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:44 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_30_chunk_30_b930b6f6.parquet', 'file_name': 'data_thread_0_30_chunk_30_b930b6f6.parquet', 'file_size_bytes': 860939, 'file_size_mb': Decimal('0.821'), 'records_count': 50000, 'thread_id': '0_30', 'chunk_id': 30, 'partition_index': None, 'created_at': '2025-10-11T12:13:44.133473', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.156'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - Chunk #32: offset=1,550,000, size=50,000
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:44 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.28s
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - Chunk #32 returned 50,000 rows
2025-10-11 12:13:48 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 32 with 50,000 rows
2025-10-11 12:13:48 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 32 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_31_chunk_31_06a78245.parquet","timestamp":"2025-10-11 12:13:49,523-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_31_chunk_31_06a78245.parquet","timestamp":"2025-10-11 12:13:49,664-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:49 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_31_chunk_31_06a78245.parquet', 'file_name': 'data_thread_0_31_chunk_31_06a78245.parquet', 'file_size_bytes': 950790, 'file_size_mb': Decimal('0.907'), 'records_count': 50000, 'thread_id': '0_31', 'chunk_id': 31, 'partition_index': None, 'created_at': '2025-10-11T12:13:49.664235', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:49 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_31_chunk_31_06a78245.parquet', 'file_name': 'data_thread_0_31_chunk_31_06a78245.parquet', 'file_size_bytes': 950790, 'file_size_mb': Decimal('0.907'), 'records_count': 50000, 'thread_id': '0_31', 'chunk_id': 31, 'partition_index': None, 'created_at': '2025-10-11T12:13:49.664235', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - Chunk #33: offset=1,600,000, size=50,000
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:49 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.40s
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - Chunk #33 returned 50,000 rows
2025-10-11 12:13:54 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 33 with 50,000 rows
2025-10-11 12:13:54 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 33 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_32_chunk_32_31f98a48.parquet","timestamp":"2025-10-11 12:13:55,203-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_32_chunk_32_31f98a48.parquet","timestamp":"2025-10-11 12:13:55,289-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:13:55 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_32_chunk_32_31f98a48.parquet', 'file_name': 'data_thread_0_32_chunk_32_31f98a48.parquet', 'file_size_bytes': 930686, 'file_size_mb': Decimal('0.888'), 'records_count': 50000, 'thread_id': '0_32', 'chunk_id': 32, 'partition_index': None, 'created_at': '2025-10-11T12:13:55.289721', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.088'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:13:55 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_32_chunk_32_31f98a48.parquet', 'file_name': 'data_thread_0_32_chunk_32_31f98a48.parquet', 'file_size_bytes': 930686, 'file_size_mb': Decimal('0.888'), 'records_count': 50000, 'thread_id': '0_32', 'chunk_id': 32, 'partition_index': None, 'created_at': '2025-10-11T12:13:55.289721', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.088'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - Chunk #34: offset=1,650,000, size=50,000
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:13:55 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.39s
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - Chunk #34 returned 50,000 rows
2025-10-11 12:13:59 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 34 with 50,000 rows
2025-10-11 12:13:59 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 34 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_33_chunk_33_6ff7a326.parquet","timestamp":"2025-10-11 12:14:00,829-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_33_chunk_33_6ff7a326.parquet","timestamp":"2025-10-11 12:14:00,983-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:00 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_33_chunk_33_6ff7a326.parquet', 'file_name': 'data_thread_0_33_chunk_33_6ff7a326.parquet', 'file_size_bytes': 947627, 'file_size_mb': Decimal('0.904'), 'records_count': 50000, 'thread_id': '0_33', 'chunk_id': 33, 'partition_index': None, 'created_at': '2025-10-11T12:14:00.983200', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.108'), 'upload_duration_seconds': Decimal('0.154'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:00 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_33_chunk_33_6ff7a326.parquet', 'file_name': 'data_thread_0_33_chunk_33_6ff7a326.parquet', 'file_size_bytes': 947627, 'file_size_mb': Decimal('0.904'), 'records_count': 50000, 'thread_id': '0_33', 'chunk_id': 33, 'partition_index': None, 'created_at': '2025-10-11T12:14:00.983200', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.108'), 'upload_duration_seconds': Decimal('0.154'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - Chunk #35: offset=1,700,000, size=50,000
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:00 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.41s
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - Chunk #35 returned 50,000 rows
2025-10-11 12:14:05 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 35 with 50,000 rows
2025-10-11 12:14:05 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 35 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_34_chunk_34_c89194f9.parquet","timestamp":"2025-10-11 12:14:06,524-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_34_chunk_34_c89194f9.parquet","timestamp":"2025-10-11 12:14:06,662-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:06 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_34_chunk_34_c89194f9.parquet', 'file_name': 'data_thread_0_34_chunk_34_c89194f9.parquet', 'file_size_bytes': 889598, 'file_size_mb': Decimal('0.848'), 'records_count': 50000, 'thread_id': '0_34', 'chunk_id': 34, 'partition_index': None, 'created_at': '2025-10-11T12:14:06.662811', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.093'), 'upload_duration_seconds': Decimal('0.138'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:06 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_34_chunk_34_c89194f9.parquet', 'file_name': 'data_thread_0_34_chunk_34_c89194f9.parquet', 'file_size_bytes': 889598, 'file_size_mb': Decimal('0.848'), 'records_count': 50000, 'thread_id': '0_34', 'chunk_id': 34, 'partition_index': None, 'created_at': '2025-10-11T12:14:06.662811', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.093'), 'upload_duration_seconds': Decimal('0.138'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - Chunk #36: offset=1,750,000, size=50,000
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:06 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.53s
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - Chunk #36 returned 50,000 rows
2025-10-11 12:14:11 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 36 with 50,000 rows
2025-10-11 12:14:11 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 36 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_35_chunk_35_146f90f1.parquet","timestamp":"2025-10-11 12:14:12,399-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_35_chunk_35_146f90f1.parquet","timestamp":"2025-10-11 12:14:12,540-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:12 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_35_chunk_35_146f90f1.parquet', 'file_name': 'data_thread_0_35_chunk_35_146f90f1.parquet', 'file_size_bytes': 891366, 'file_size_mb': Decimal('0.85'), 'records_count': 50000, 'thread_id': '0_35', 'chunk_id': 35, 'partition_index': None, 'created_at': '2025-10-11T12:14:12.540368', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.172'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:12 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_35_chunk_35_146f90f1.parquet', 'file_name': 'data_thread_0_35_chunk_35_146f90f1.parquet', 'file_size_bytes': 891366, 'file_size_mb': Decimal('0.85'), 'records_count': 50000, 'thread_id': '0_35', 'chunk_id': 35, 'partition_index': None, 'created_at': '2025-10-11T12:14:12.540368', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.172'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - Chunk #37: offset=1,800,000, size=50,000
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:12 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.68s
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - Chunk #37 returned 50,000 rows
2025-10-11 12:14:17 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 37 with 50,000 rows
2025-10-11 12:14:17 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 37 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_36_chunk_36_c094f73f.parquet","timestamp":"2025-10-11 12:14:18,397-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_36_chunk_36_c094f73f.parquet","timestamp":"2025-10-11 12:14:18,493-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:18 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_36_chunk_36_c094f73f.parquet', 'file_name': 'data_thread_0_36_chunk_36_c094f73f.parquet', 'file_size_bytes': 894147, 'file_size_mb': Decimal('0.853'), 'records_count': 50000, 'thread_id': '0_36', 'chunk_id': 36, 'partition_index': None, 'created_at': '2025-10-11T12:14:18.493146', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.139'), 'upload_duration_seconds': Decimal('0.095'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:18 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_36_chunk_36_c094f73f.parquet', 'file_name': 'data_thread_0_36_chunk_36_c094f73f.parquet', 'file_size_bytes': 894147, 'file_size_mb': Decimal('0.853'), 'records_count': 50000, 'thread_id': '0_36', 'chunk_id': 36, 'partition_index': None, 'created_at': '2025-10-11T12:14:18.493146', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.139'), 'upload_duration_seconds': Decimal('0.095'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - Chunk #38: offset=1,850,000, size=50,000
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:18 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.54s
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - Chunk #38 returned 50,000 rows
2025-10-11 12:14:23 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 38 with 50,000 rows
2025-10-11 12:14:23 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 38 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_37_chunk_37_b4a32ef7.parquet","timestamp":"2025-10-11 12:14:24,165-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_37_chunk_37_b4a32ef7.parquet","timestamp":"2025-10-11 12:14:24,276-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:24 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_37_chunk_37_b4a32ef7.parquet', 'file_name': 'data_thread_0_37_chunk_37_b4a32ef7.parquet', 'file_size_bytes': 906154, 'file_size_mb': Decimal('0.864'), 'records_count': 50000, 'thread_id': '0_37', 'chunk_id': 37, 'partition_index': None, 'created_at': '2025-10-11T12:14:24.276538', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.096'), 'upload_duration_seconds': Decimal('0.111'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:24 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_37_chunk_37_b4a32ef7.parquet', 'file_name': 'data_thread_0_37_chunk_37_b4a32ef7.parquet', 'file_size_bytes': 906154, 'file_size_mb': Decimal('0.864'), 'records_count': 50000, 'thread_id': '0_37', 'chunk_id': 37, 'partition_index': None, 'created_at': '2025-10-11T12:14:24.276538', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.096'), 'upload_duration_seconds': Decimal('0.111'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - Chunk #39: offset=1,900,000, size=50,000
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:24 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.62s
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - Chunk #39 returned 50,000 rows
2025-10-11 12:14:28 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 39 with 50,000 rows
2025-10-11 12:14:28 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 39 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_38_chunk_38_1accab62.parquet","timestamp":"2025-10-11 12:14:30,009-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_38_chunk_38_1accab62.parquet","timestamp":"2025-10-11 12:14:30,134-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:30 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_38_chunk_38_1accab62.parquet', 'file_name': 'data_thread_0_38_chunk_38_1accab62.parquet', 'file_size_bytes': 926877, 'file_size_mb': Decimal('0.884'), 'records_count': 50000, 'thread_id': '0_38', 'chunk_id': 38, 'partition_index': None, 'created_at': '2025-10-11T12:14:30.134757', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:30 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_38_chunk_38_1accab62.parquet', 'file_name': 'data_thread_0_38_chunk_38_1accab62.parquet', 'file_size_bytes': 926877, 'file_size_mb': Decimal('0.884'), 'records_count': 50000, 'thread_id': '0_38', 'chunk_id': 38, 'partition_index': None, 'created_at': '2025-10-11T12:14:30.134757', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - Chunk #40: offset=1,950,000, size=50,000
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:30 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 1950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.52s
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - Chunk #40 returned 50,000 rows
2025-10-11 12:14:34 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 40 with 50,000 rows
2025-10-11 12:14:34 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 40 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_39_chunk_39_196e21ad.parquet","timestamp":"2025-10-11 12:14:35,775-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_39_chunk_39_196e21ad.parquet","timestamp":"2025-10-11 12:14:35,900-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:35 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_39_chunk_39_196e21ad.parquet', 'file_name': 'data_thread_0_39_chunk_39_196e21ad.parquet', 'file_size_bytes': 943953, 'file_size_mb': Decimal('0.9'), 'records_count': 50000, 'thread_id': '0_39', 'chunk_id': 39, 'partition_index': None, 'created_at': '2025-10-11T12:14:35.900567', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:35 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_39_chunk_39_196e21ad.parquet', 'file_name': 'data_thread_0_39_chunk_39_196e21ad.parquet', 'file_size_bytes': 943953, 'file_size_mb': Decimal('0.9'), 'records_count': 50000, 'thread_id': '0_39', 'chunk_id': 39, 'partition_index': None, 'created_at': '2025-10-11T12:14:35.900567', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - Chunk #41: offset=2,000,000, size=50,000
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:35 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.53s
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - Chunk #41 returned 50,000 rows
2025-10-11 12:14:40 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 41 with 50,000 rows
2025-10-11 12:14:40 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 41 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_40_chunk_40_59d1849f.parquet","timestamp":"2025-10-11 12:14:41,557-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_40_chunk_40_59d1849f.parquet","timestamp":"2025-10-11 12:14:41,697-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:41 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_40_chunk_40_59d1849f.parquet', 'file_name': 'data_thread_0_40_chunk_40_59d1849f.parquet', 'file_size_bytes': 916910, 'file_size_mb': Decimal('0.874'), 'records_count': 50000, 'thread_id': '0_40', 'chunk_id': 40, 'partition_index': None, 'created_at': '2025-10-11T12:14:41.697627', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:41 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_40_chunk_40_59d1849f.parquet', 'file_name': 'data_thread_0_40_chunk_40_59d1849f.parquet', 'file_size_bytes': 916910, 'file_size_mb': Decimal('0.874'), 'records_count': 50000, 'thread_id': '0_40', 'chunk_id': 40, 'partition_index': None, 'created_at': '2025-10-11T12:14:41.697627', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.141'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - Chunk #42: offset=2,050,000, size=50,000
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:41 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.63s
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - Chunk #42 returned 50,000 rows
2025-10-11 12:14:46 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 42 with 50,000 rows
2025-10-11 12:14:46 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 42 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_41_chunk_41_7dfc57fd.parquet","timestamp":"2025-10-11 12:14:47,447-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_41_chunk_41_7dfc57fd.parquet","timestamp":"2025-10-11 12:14:47,541-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:47 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_41_chunk_41_7dfc57fd.parquet', 'file_name': 'data_thread_0_41_chunk_41_7dfc57fd.parquet', 'file_size_bytes': 940846, 'file_size_mb': Decimal('0.897'), 'records_count': 50000, 'thread_id': '0_41', 'chunk_id': 41, 'partition_index': None, 'created_at': '2025-10-11T12:14:47.541567', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:47 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_41_chunk_41_7dfc57fd.parquet', 'file_name': 'data_thread_0_41_chunk_41_7dfc57fd.parquet', 'file_size_bytes': 940846, 'file_size_mb': Decimal('0.897'), 'records_count': 50000, 'thread_id': '0_41', 'chunk_id': 41, 'partition_index': None, 'created_at': '2025-10-11T12:14:47.541567', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - Chunk #43: offset=2,100,000, size=50,000
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:47 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.69s
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - Chunk #43 returned 50,000 rows
2025-10-11 12:14:52 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 43 with 50,000 rows
2025-10-11 12:14:52 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 43 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_42_chunk_42_56ebd967.parquet","timestamp":"2025-10-11 12:14:53,338-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_42_chunk_42_56ebd967.parquet","timestamp":"2025-10-11 12:14:53,448-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:53 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_42_chunk_42_56ebd967.parquet', 'file_name': 'data_thread_0_42_chunk_42_56ebd967.parquet', 'file_size_bytes': 937689, 'file_size_mb': Decimal('0.894'), 'records_count': 50000, 'thread_id': '0_42', 'chunk_id': 42, 'partition_index': None, 'created_at': '2025-10-11T12:14:53.448006', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:53 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_42_chunk_42_56ebd967.parquet', 'file_name': 'data_thread_0_42_chunk_42_56ebd967.parquet', 'file_size_bytes': 937689, 'file_size_mb': Decimal('0.894'), 'records_count': 50000, 'thread_id': '0_42', 'chunk_id': 42, 'partition_index': None, 'created_at': '2025-10-11T12:14:53.448006', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - Chunk #44: offset=2,150,000, size=50,000
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:53 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.75s
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - Chunk #44 returned 50,000 rows
2025-10-11 12:14:58 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 44 with 50,000 rows
2025-10-11 12:14:58 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 44 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_43_chunk_43_5b919ea5.parquet","timestamp":"2025-10-11 12:14:59,323-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_43_chunk_43_5b919ea5.parquet","timestamp":"2025-10-11 12:14:59,432-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:14:59 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_43_chunk_43_5b919ea5.parquet', 'file_name': 'data_thread_0_43_chunk_43_5b919ea5.parquet', 'file_size_bytes': 931979, 'file_size_mb': Decimal('0.889'), 'records_count': 50000, 'thread_id': '0_43', 'chunk_id': 43, 'partition_index': None, 'created_at': '2025-10-11T12:14:59.432577', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:14:59 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_43_chunk_43_5b919ea5.parquet', 'file_name': 'data_thread_0_43_chunk_43_5b919ea5.parquet', 'file_size_bytes': 931979, 'file_size_mb': Decimal('0.889'), 'records_count': 50000, 'thread_id': '0_43', 'chunk_id': 43, 'partition_index': None, 'created_at': '2025-10-11T12:14:59.432577', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.109'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - Chunk #45: offset=2,200,000, size=50,000
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:14:59 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.75s
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - Chunk #45 returned 50,000 rows
2025-10-11 12:15:04 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 45 with 50,000 rows
2025-10-11 12:15:04 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 45 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_44_chunk_44_532af40f.parquet","timestamp":"2025-10-11 12:15:05,339-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_44_chunk_44_532af40f.parquet","timestamp":"2025-10-11 12:15:05,432-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:05 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_44_chunk_44_532af40f.parquet', 'file_name': 'data_thread_0_44_chunk_44_532af40f.parquet', 'file_size_bytes': 925130, 'file_size_mb': Decimal('0.882'), 'records_count': 50000, 'thread_id': '0_44', 'chunk_id': 44, 'partition_index': None, 'created_at': '2025-10-11T12:15:05.432762', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:05 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_44_chunk_44_532af40f.parquet', 'file_name': 'data_thread_0_44_chunk_44_532af40f.parquet', 'file_size_bytes': 925130, 'file_size_mb': Decimal('0.882'), 'records_count': 50000, 'thread_id': '0_44', 'chunk_id': 44, 'partition_index': None, 'created_at': '2025-10-11T12:15:05.432762', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.094'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - Chunk #46: offset=2,250,000, size=50,000
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:05 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.86s
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - Chunk #46 returned 50,000 rows
2025-10-11 12:15:10 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 46 with 50,000 rows
2025-10-11 12:15:10 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 46 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_45_chunk_45_d48a4b2d.parquet","timestamp":"2025-10-11 12:15:11,464-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_45_chunk_45_d48a4b2d.parquet","timestamp":"2025-10-11 12:15:11,886-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:11 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_45_chunk_45_d48a4b2d.parquet', 'file_name': 'data_thread_0_45_chunk_45_d48a4b2d.parquet', 'file_size_bytes': 970108, 'file_size_mb': Decimal('0.925'), 'records_count': 50000, 'thread_id': '0_45', 'chunk_id': 45, 'partition_index': None, 'created_at': '2025-10-11T12:15:11.886112', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.422'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:11 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_45_chunk_45_d48a4b2d.parquet', 'file_name': 'data_thread_0_45_chunk_45_d48a4b2d.parquet', 'file_size_bytes': 970108, 'file_size_mb': Decimal('0.925'), 'records_count': 50000, 'thread_id': '0_45', 'chunk_id': 45, 'partition_index': None, 'created_at': '2025-10-11T12:15:11.886112', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.141'), 'upload_duration_seconds': Decimal('0.422'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - Chunk #47: offset=2,300,000, size=50,000
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:11 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.86s
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - Chunk #47 returned 50,000 rows
2025-10-11 12:15:16 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 47 with 50,000 rows
2025-10-11 12:15:16 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 47 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_46_chunk_46_dfe825be.parquet","timestamp":"2025-10-11 12:15:17,886-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_46_chunk_46_dfe825be.parquet","timestamp":"2025-10-11 12:15:18,011-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:18 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_46_chunk_46_dfe825be.parquet', 'file_name': 'data_thread_0_46_chunk_46_dfe825be.parquet', 'file_size_bytes': 901738, 'file_size_mb': Decimal('0.86'), 'records_count': 50000, 'thread_id': '0_46', 'chunk_id': 46, 'partition_index': None, 'created_at': '2025-10-11T12:15:18.011293', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:18 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_46_chunk_46_dfe825be.parquet', 'file_name': 'data_thread_0_46_chunk_46_dfe825be.parquet', 'file_size_bytes': 901738, 'file_size_mb': Decimal('0.86'), 'records_count': 50000, 'thread_id': '0_46', 'chunk_id': 46, 'partition_index': None, 'created_at': '2025-10-11T12:15:18.011293', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.125'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - Chunk #48: offset=2,350,000, size=50,000
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:18 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.91s
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - Chunk #48 returned 50,000 rows
2025-10-11 12:15:22 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 48 with 50,000 rows
2025-10-11 12:15:22 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 48 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_47_chunk_47_b91c4ed3.parquet","timestamp":"2025-10-11 12:15:24,058-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_47_chunk_47_b91c4ed3.parquet","timestamp":"2025-10-11 12:15:24,449-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:24 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_47_chunk_47_b91c4ed3.parquet', 'file_name': 'data_thread_0_47_chunk_47_b91c4ed3.parquet', 'file_size_bytes': 888712, 'file_size_mb': Decimal('0.848'), 'records_count': 50000, 'thread_id': '0_47', 'chunk_id': 47, 'partition_index': None, 'created_at': '2025-10-11T12:15:24.449026', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.391'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:24 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_47_chunk_47_b91c4ed3.parquet', 'file_name': 'data_thread_0_47_chunk_47_b91c4ed3.parquet', 'file_size_bytes': 888712, 'file_size_mb': Decimal('0.848'), 'records_count': 50000, 'thread_id': '0_47', 'chunk_id': 47, 'partition_index': None, 'created_at': '2025-10-11T12:15:24.449026', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.391'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - Chunk #49: offset=2,400,000, size=50,000
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:24 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - Execution time: 4.94s
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - Chunk #49 returned 50,000 rows
2025-10-11 12:15:29 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 49 with 50,000 rows
2025-10-11 12:15:29 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 49 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_48_chunk_48_f959c2fa.parquet","timestamp":"2025-10-11 12:15:30,542-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_48_chunk_48_f959c2fa.parquet","timestamp":"2025-10-11 12:15:30,980-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:30 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_48_chunk_48_f959c2fa.parquet', 'file_name': 'data_thread_0_48_chunk_48_f959c2fa.parquet', 'file_size_bytes': 828627, 'file_size_mb': Decimal('0.79'), 'records_count': 50000, 'thread_id': '0_48', 'chunk_id': 48, 'partition_index': None, 'created_at': '2025-10-11T12:15:30.980458', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.438'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:30 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_48_chunk_48_f959c2fa.parquet', 'file_name': 'data_thread_0_48_chunk_48_f959c2fa.parquet', 'file_size_bytes': 828627, 'file_size_mb': Decimal('0.79'), 'records_count': 50000, 'thread_id': '0_48', 'chunk_id': 48, 'partition_index': None, 'created_at': '2025-10-11T12:15:30.980458', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.438'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - Chunk #50: offset=2,450,000, size=50,000
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:30 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2450000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.06s
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - Chunk #50 returned 50,000 rows
2025-10-11 12:15:36 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 50 with 50,000 rows
2025-10-11 12:15:36 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 50 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_49_chunk_49_6ab17891.parquet","timestamp":"2025-10-11 12:15:37,168-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_49_chunk_49_6ab17891.parquet","timestamp":"2025-10-11 12:15:37,496-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:37 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_49_chunk_49_6ab17891.parquet', 'file_name': 'data_thread_0_49_chunk_49_6ab17891.parquet', 'file_size_bytes': 835873, 'file_size_mb': Decimal('0.797'), 'records_count': 50000, 'thread_id': '0_49', 'chunk_id': 49, 'partition_index': None, 'created_at': '2025-10-11T12:15:37.496293', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.328'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:37 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_49_chunk_49_6ab17891.parquet', 'file_name': 'data_thread_0_49_chunk_49_6ab17891.parquet', 'file_size_bytes': 835873, 'file_size_mb': Decimal('0.797'), 'records_count': 50000, 'thread_id': '0_49', 'chunk_id': 49, 'partition_index': None, 'created_at': '2025-10-11T12:15:37.496293', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.328'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - Chunk #51: offset=2,500,000, size=50,000
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:37 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2500000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.11s
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - Chunk #51 returned 50,000 rows
2025-10-11 12:15:42 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 51 with 50,000 rows
2025-10-11 12:15:42 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 51 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_50_chunk_50_2d01ea7d.parquet","timestamp":"2025-10-11 12:15:43,730-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_50_chunk_50_2d01ea7d.parquet","timestamp":"2025-10-11 12:15:44,105-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:44 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_50_chunk_50_2d01ea7d.parquet', 'file_name': 'data_thread_0_50_chunk_50_2d01ea7d.parquet', 'file_size_bytes': 850056, 'file_size_mb': Decimal('0.811'), 'records_count': 50000, 'thread_id': '0_50', 'chunk_id': 50, 'partition_index': None, 'created_at': '2025-10-11T12:15:44.105872', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:44 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_50_chunk_50_2d01ea7d.parquet', 'file_name': 'data_thread_0_50_chunk_50_2d01ea7d.parquet', 'file_size_bytes': 850056, 'file_size_mb': Decimal('0.811'), 'records_count': 50000, 'thread_id': '0_50', 'chunk_id': 50, 'partition_index': None, 'created_at': '2025-10-11T12:15:44.105872', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - Chunk #52: offset=2,550,000, size=50,000
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:44 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2550000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.22s
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - Chunk #52 returned 50,000 rows
2025-10-11 12:15:49 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 52 with 50,000 rows
2025-10-11 12:15:49 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 52 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_51_chunk_51_c0f0f9eb.parquet","timestamp":"2025-10-11 12:15:50,434-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_51_chunk_51_c0f0f9eb.parquet","timestamp":"2025-10-11 12:15:50,809-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:50 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_51_chunk_51_c0f0f9eb.parquet', 'file_name': 'data_thread_0_51_chunk_51_c0f0f9eb.parquet', 'file_size_bytes': 809452, 'file_size_mb': Decimal('0.772'), 'records_count': 50000, 'thread_id': '0_51', 'chunk_id': 51, 'partition_index': None, 'created_at': '2025-10-11T12:15:50.809228', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:50 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_51_chunk_51_c0f0f9eb.parquet', 'file_name': 'data_thread_0_51_chunk_51_c0f0f9eb.parquet', 'file_size_bytes': 809452, 'file_size_mb': Decimal('0.772'), 'records_count': 50000, 'thread_id': '0_51', 'chunk_id': 51, 'partition_index': None, 'created_at': '2025-10-11T12:15:50.809228', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - Chunk #53: offset=2,600,000, size=50,000
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:50 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2600000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.19s
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - Chunk #53 returned 50,000 rows
2025-10-11 12:15:55 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 53 with 50,000 rows
2025-10-11 12:15:56 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 53 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_52_chunk_52_3fdc75a2.parquet","timestamp":"2025-10-11 12:15:57,153-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_52_chunk_52_3fdc75a2.parquet","timestamp":"2025-10-11 12:15:57,512-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:15:57 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_52_chunk_52_3fdc75a2.parquet', 'file_name': 'data_thread_0_52_chunk_52_3fdc75a2.parquet', 'file_size_bytes': 804057, 'file_size_mb': Decimal('0.767'), 'records_count': 50000, 'thread_id': '0_52', 'chunk_id': 52, 'partition_index': None, 'created_at': '2025-10-11T12:15:57.512554', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:15:57 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_52_chunk_52_3fdc75a2.parquet', 'file_name': 'data_thread_0_52_chunk_52_3fdc75a2.parquet', 'file_size_bytes': 804057, 'file_size_mb': Decimal('0.767'), 'records_count': 50000, 'thread_id': '0_52', 'chunk_id': 52, 'partition_index': None, 'created_at': '2025-10-11T12:15:57.512554', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - Chunk #54: offset=2,650,000, size=50,000
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:15:57 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2650000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.23s
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - Chunk #54 returned 50,000 rows
2025-10-11 12:16:02 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 54 with 50,000 rows
2025-10-11 12:16:02 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 54 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_53_chunk_53_e5db2424.parquet","timestamp":"2025-10-11 12:16:03,903-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_53_chunk_53_e5db2424.parquet","timestamp":"2025-10-11 12:16:04,387-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:04 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_53_chunk_53_e5db2424.parquet', 'file_name': 'data_thread_0_53_chunk_53_e5db2424.parquet', 'file_size_bytes': 805112, 'file_size_mb': Decimal('0.768'), 'records_count': 50000, 'thread_id': '0_53', 'chunk_id': 53, 'partition_index': None, 'created_at': '2025-10-11T12:16:04.387775', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.484'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:04 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_53_chunk_53_e5db2424.parquet', 'file_name': 'data_thread_0_53_chunk_53_e5db2424.parquet', 'file_size_bytes': 805112, 'file_size_mb': Decimal('0.768'), 'records_count': 50000, 'thread_id': '0_53', 'chunk_id': 53, 'partition_index': None, 'created_at': '2025-10-11T12:16:04.387775', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.484'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - Chunk #55: offset=2,700,000, size=50,000
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:04 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2700000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.33s
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - Chunk #55 returned 50,000 rows
2025-10-11 12:16:09 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 55 with 50,000 rows
2025-10-11 12:16:09 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 55 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_54_chunk_54_5b962723.parquet","timestamp":"2025-10-11 12:16:10,903-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_54_chunk_54_5b962723.parquet","timestamp":"2025-10-11 12:16:11,231-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:11 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_54_chunk_54_5b962723.parquet', 'file_name': 'data_thread_0_54_chunk_54_5b962723.parquet', 'file_size_bytes': 831004, 'file_size_mb': Decimal('0.793'), 'records_count': 50000, 'thread_id': '0_54', 'chunk_id': 54, 'partition_index': None, 'created_at': '2025-10-11T12:16:11.231739', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.328'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:11 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_54_chunk_54_5b962723.parquet', 'file_name': 'data_thread_0_54_chunk_54_5b962723.parquet', 'file_size_bytes': 831004, 'file_size_mb': Decimal('0.793'), 'records_count': 50000, 'thread_id': '0_54', 'chunk_id': 54, 'partition_index': None, 'created_at': '2025-10-11T12:16:11.231739', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.328'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - Chunk #56: offset=2,750,000, size=50,000
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:11 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2750000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.30s
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - Chunk #56 returned 50,000 rows
2025-10-11 12:16:16 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 56 with 50,000 rows
2025-10-11 12:16:16 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 56 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_55_chunk_55_1eba366c.parquet","timestamp":"2025-10-11 12:16:17,685-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_55_chunk_55_1eba366c.parquet","timestamp":"2025-10-11 12:16:18,060-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:18 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_55_chunk_55_1eba366c.parquet', 'file_name': 'data_thread_0_55_chunk_55_1eba366c.parquet', 'file_size_bytes': 794538, 'file_size_mb': Decimal('0.758'), 'records_count': 50000, 'thread_id': '0_55', 'chunk_id': 55, 'partition_index': None, 'created_at': '2025-10-11T12:16:18.060083', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:18 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_55_chunk_55_1eba366c.parquet', 'file_name': 'data_thread_0_55_chunk_55_1eba366c.parquet', 'file_size_bytes': 794538, 'file_size_mb': Decimal('0.758'), 'records_count': 50000, 'thread_id': '0_55', 'chunk_id': 55, 'partition_index': None, 'created_at': '2025-10-11T12:16:18.060083', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - Chunk #57: offset=2,800,000, size=50,000
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:18 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2800000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.36s
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - Chunk #57 returned 50,000 rows
2025-10-11 12:16:23 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 57 with 50,000 rows
2025-10-11 12:16:23 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 57 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_56_chunk_56_e3de372d.parquet","timestamp":"2025-10-11 12:16:24,544-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_56_chunk_56_e3de372d.parquet","timestamp":"2025-10-11 12:16:24,904-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:24 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_56_chunk_56_e3de372d.parquet', 'file_name': 'data_thread_0_56_chunk_56_e3de372d.parquet', 'file_size_bytes': 793423, 'file_size_mb': Decimal('0.757'), 'records_count': 50000, 'thread_id': '0_56', 'chunk_id': 56, 'partition_index': None, 'created_at': '2025-10-11T12:16:24.904047', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:24 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_56_chunk_56_e3de372d.parquet', 'file_name': 'data_thread_0_56_chunk_56_e3de372d.parquet', 'file_size_bytes': 793423, 'file_size_mb': Decimal('0.757'), 'records_count': 50000, 'thread_id': '0_56', 'chunk_id': 56, 'partition_index': None, 'created_at': '2025-10-11T12:16:24.904047', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - Chunk #58: offset=2,850,000, size=50,000
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:24 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2850000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.36s
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - Chunk #58 returned 50,000 rows
2025-10-11 12:16:30 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 58 with 50,000 rows
2025-10-11 12:16:30 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 58 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_57_chunk_57_2bf0f1ee.parquet","timestamp":"2025-10-11 12:16:31,388-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_57_chunk_57_2bf0f1ee.parquet","timestamp":"2025-10-11 12:16:31,810-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:31 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_57_chunk_57_2bf0f1ee.parquet', 'file_name': 'data_thread_0_57_chunk_57_2bf0f1ee.parquet', 'file_size_bytes': 766286, 'file_size_mb': Decimal('0.731'), 'records_count': 50000, 'thread_id': '0_57', 'chunk_id': 57, 'partition_index': None, 'created_at': '2025-10-11T12:16:31.810524', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.422'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:31 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_57_chunk_57_2bf0f1ee.parquet', 'file_name': 'data_thread_0_57_chunk_57_2bf0f1ee.parquet', 'file_size_bytes': 766286, 'file_size_mb': Decimal('0.731'), 'records_count': 50000, 'thread_id': '0_57', 'chunk_id': 57, 'partition_index': None, 'created_at': '2025-10-11T12:16:31.810524', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.422'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - Chunk #59: offset=2,900,000, size=50,000
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:31 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2900000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.45s
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - Chunk #59 returned 50,000 rows
2025-10-11 12:16:37 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 59 with 50,000 rows
2025-10-11 12:16:37 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 59 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_58_chunk_58_684a6c8d.parquet","timestamp":"2025-10-11 12:16:38,388-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_58_chunk_58_684a6c8d.parquet","timestamp":"2025-10-11 12:16:38,732-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:38 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_58_chunk_58_684a6c8d.parquet', 'file_name': 'data_thread_0_58_chunk_58_684a6c8d.parquet', 'file_size_bytes': 701492, 'file_size_mb': Decimal('0.669'), 'records_count': 50000, 'thread_id': '0_58', 'chunk_id': 58, 'partition_index': None, 'created_at': '2025-10-11T12:16:38.732618', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.344'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:38 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_58_chunk_58_684a6c8d.parquet', 'file_name': 'data_thread_0_58_chunk_58_684a6c8d.parquet', 'file_size_bytes': 701492, 'file_size_mb': Decimal('0.669'), 'records_count': 50000, 'thread_id': '0_58', 'chunk_id': 58, 'partition_index': None, 'created_at': '2025-10-11T12:16:38.732618', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.344'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - Chunk #60: offset=2,950,000, size=50,000
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:38 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 2950000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.44s
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - Chunk #60 returned 50,000 rows
2025-10-11 12:16:44 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 60 with 50,000 rows
2025-10-11 12:16:44 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 60 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_59_chunk_59_32ca0467.parquet","timestamp":"2025-10-11 12:16:45,295-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_59_chunk_59_32ca0467.parquet","timestamp":"2025-10-11 12:16:45,654-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:45 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_59_chunk_59_32ca0467.parquet', 'file_name': 'data_thread_0_59_chunk_59_32ca0467.parquet', 'file_size_bytes': 799453, 'file_size_mb': Decimal('0.762'), 'records_count': 50000, 'thread_id': '0_59', 'chunk_id': 59, 'partition_index': None, 'created_at': '2025-10-11T12:16:45.654711', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:45 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_59_chunk_59_32ca0467.parquet', 'file_name': 'data_thread_0_59_chunk_59_32ca0467.parquet', 'file_size_bytes': 799453, 'file_size_mb': Decimal('0.762'), 'records_count': 50000, 'thread_id': '0_59', 'chunk_id': 59, 'partition_index': None, 'created_at': '2025-10-11T12:16:45.654711', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - Chunk #61: offset=3,000,000, size=50,000
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:45 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3000000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.67s
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - Chunk #61 returned 50,000 rows
2025-10-11 12:16:51 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 61 with 50,000 rows
2025-10-11 12:16:51 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 61 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_60_chunk_60_871b0da3.parquet","timestamp":"2025-10-11 12:16:52,467-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_60_chunk_60_871b0da3.parquet","timestamp":"2025-10-11 12:16:52,826-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:52 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_60_chunk_60_871b0da3.parquet', 'file_name': 'data_thread_0_60_chunk_60_871b0da3.parquet', 'file_size_bytes': 835540, 'file_size_mb': Decimal('0.797'), 'records_count': 50000, 'thread_id': '0_60', 'chunk_id': 60, 'partition_index': None, 'created_at': '2025-10-11T12:16:52.826814', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:52 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_60_chunk_60_871b0da3.parquet', 'file_name': 'data_thread_0_60_chunk_60_871b0da3.parquet', 'file_size_bytes': 835540, 'file_size_mb': Decimal('0.797'), 'records_count': 50000, 'thread_id': '0_60', 'chunk_id': 60, 'partition_index': None, 'created_at': '2025-10-11T12:16:52.826814', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - Chunk #62: offset=3,050,000, size=50,000
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:52 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3050000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.53s
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - Chunk #62 returned 50,000 rows
2025-10-11 12:16:58 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 62 with 50,000 rows
2025-10-11 12:16:58 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 62 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_61_chunk_61_e09915a0.parquet","timestamp":"2025-10-11 12:16:59,498-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_61_chunk_61_e09915a0.parquet","timestamp":"2025-10-11 12:16:59,873-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:16:59 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_61_chunk_61_e09915a0.parquet', 'file_name': 'data_thread_0_61_chunk_61_e09915a0.parquet', 'file_size_bytes': 818532, 'file_size_mb': Decimal('0.781'), 'records_count': 50000, 'thread_id': '0_61', 'chunk_id': 61, 'partition_index': None, 'created_at': '2025-10-11T12:16:59.873913', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:16:59 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_61_chunk_61_e09915a0.parquet', 'file_name': 'data_thread_0_61_chunk_61_e09915a0.parquet', 'file_size_bytes': 818532, 'file_size_mb': Decimal('0.781'), 'records_count': 50000, 'thread_id': '0_61', 'chunk_id': 61, 'partition_index': None, 'created_at': '2025-10-11T12:16:59.873913', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - Chunk #63: offset=3,100,000, size=50,000
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:16:59 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3100000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.58s
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - Chunk #63 returned 50,000 rows
2025-10-11 12:17:05 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 63 with 50,000 rows
2025-10-11 12:17:05 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 63 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_62_chunk_62_b1c50f2c.parquet","timestamp":"2025-10-11 12:17:06,608-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_62_chunk_62_b1c50f2c.parquet","timestamp":"2025-10-11 12:17:06,983-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:06 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_62_chunk_62_b1c50f2c.parquet', 'file_name': 'data_thread_0_62_chunk_62_b1c50f2c.parquet', 'file_size_bytes': 783680, 'file_size_mb': Decimal('0.747'), 'records_count': 50000, 'thread_id': '0_62', 'chunk_id': 62, 'partition_index': None, 'created_at': '2025-10-11T12:17:06.983515', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:06 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_62_chunk_62_b1c50f2c.parquet', 'file_name': 'data_thread_0_62_chunk_62_b1c50f2c.parquet', 'file_size_bytes': 783680, 'file_size_mb': Decimal('0.747'), 'records_count': 50000, 'thread_id': '0_62', 'chunk_id': 62, 'partition_index': None, 'created_at': '2025-10-11T12:17:06.983515', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.109'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - Chunk #64: offset=3,150,000, size=50,000
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:06 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3150000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.56s
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - Chunk #64 returned 50,000 rows
2025-10-11 12:17:12 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 64 with 50,000 rows
2025-10-11 12:17:12 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 64 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_63_chunk_63_d4e09976.parquet","timestamp":"2025-10-11 12:17:13,655-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_63_chunk_63_d4e09976.parquet","timestamp":"2025-10-11 12:17:14,030-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:14 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_63_chunk_63_d4e09976.parquet', 'file_name': 'data_thread_0_63_chunk_63_d4e09976.parquet', 'file_size_bytes': 785096, 'file_size_mb': Decimal('0.749'), 'records_count': 50000, 'thread_id': '0_63', 'chunk_id': 63, 'partition_index': None, 'created_at': '2025-10-11T12:17:14.030614', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:14 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_63_chunk_63_d4e09976.parquet', 'file_name': 'data_thread_0_63_chunk_63_d4e09976.parquet', 'file_size_bytes': 785096, 'file_size_mb': Decimal('0.749'), 'records_count': 50000, 'thread_id': '0_63', 'chunk_id': 63, 'partition_index': None, 'created_at': '2025-10-11T12:17:14.030614', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.078'), 'upload_duration_seconds': Decimal('0.375'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - Chunk #65: offset=3,200,000, size=50,000
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:14 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3200000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.63s
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - Chunk #65 returned 50,000 rows
2025-10-11 12:17:19 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 65 with 50,000 rows
2025-10-11 12:17:19 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 65 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_64_chunk_64_00768afc.parquet","timestamp":"2025-10-11 12:17:20,780-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_64_chunk_64_00768afc.parquet","timestamp":"2025-10-11 12:17:21,140-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:21 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_64_chunk_64_00768afc.parquet', 'file_name': 'data_thread_0_64_chunk_64_00768afc.parquet', 'file_size_bytes': 774471, 'file_size_mb': Decimal('0.739'), 'records_count': 50000, 'thread_id': '0_64', 'chunk_id': 64, 'partition_index': None, 'created_at': '2025-10-11T12:17:21.140214', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:21 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_64_chunk_64_00768afc.parquet', 'file_name': 'data_thread_0_64_chunk_64_00768afc.parquet', 'file_size_bytes': 774471, 'file_size_mb': Decimal('0.739'), 'records_count': 50000, 'thread_id': '0_64', 'chunk_id': 64, 'partition_index': None, 'created_at': '2025-10-11T12:17:21.140214', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - Chunk #66: offset=3,250,000, size=50,000
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:21 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3250000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.66s
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - Chunk #66 returned 50,000 rows
2025-10-11 12:17:26 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 66 with 50,000 rows
2025-10-11 12:17:26 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 66 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_65_chunk_65_a8eb5721.parquet","timestamp":"2025-10-11 12:17:27,968-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_65_chunk_65_a8eb5721.parquet","timestamp":"2025-10-11 12:17:28,327-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:28 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_65_chunk_65_a8eb5721.parquet', 'file_name': 'data_thread_0_65_chunk_65_a8eb5721.parquet', 'file_size_bytes': 801862, 'file_size_mb': Decimal('0.765'), 'records_count': 50000, 'thread_id': '0_65', 'chunk_id': 65, 'partition_index': None, 'created_at': '2025-10-11T12:17:28.327943', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:28 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_65_chunk_65_a8eb5721.parquet', 'file_name': 'data_thread_0_65_chunk_65_a8eb5721.parquet', 'file_size_bytes': 801862, 'file_size_mb': Decimal('0.765'), 'records_count': 50000, 'thread_id': '0_65', 'chunk_id': 65, 'partition_index': None, 'created_at': '2025-10-11T12:17:28.327943', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.125'), 'upload_duration_seconds': Decimal('0.359'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - Chunk #67: offset=3,300,000, size=50,000
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:28 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3300000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.75s
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - Chunk #67 returned 50,000 rows
2025-10-11 12:17:34 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 67 with 50,000 rows
2025-10-11 12:17:34 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 67 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_66_chunk_66_e662ac16.parquet","timestamp":"2025-10-11 12:17:35,203-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_66_chunk_66_e662ac16.parquet","timestamp":"2025-10-11 12:17:35,593-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:35 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_66_chunk_66_e662ac16.parquet', 'file_name': 'data_thread_0_66_chunk_66_e662ac16.parquet', 'file_size_bytes': 828731, 'file_size_mb': Decimal('0.79'), 'records_count': 50000, 'thread_id': '0_66', 'chunk_id': 66, 'partition_index': None, 'created_at': '2025-10-11T12:17:35.593797', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.391'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:35 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_66_chunk_66_e662ac16.parquet', 'file_name': 'data_thread_0_66_chunk_66_e662ac16.parquet', 'file_size_bytes': 828731, 'file_size_mb': Decimal('0.79'), 'records_count': 50000, 'thread_id': '0_66', 'chunk_id': 66, 'partition_index': None, 'created_at': '2025-10-11T12:17:35.593797', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.094'), 'upload_duration_seconds': Decimal('0.391'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - Chunk #68: offset=3,350,000, size=50,000
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:35 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3350000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - ‚úÖ Query executed successfully
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - Execution time: 5.82s
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - Rows returned: 50,000
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - Columns: 76
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - Chunk #68 returned 50,000 rows
2025-10-11 12:17:41 - extract.extractors.sql_server_extractor - INFO - Yielding chunk 68 with 50,000 rows
2025-10-11 12:17:41 - core.orchestrator - INFO - üîç DEBUG: Processing chunk 68 with 50000 rows
{"level":"INFO","location":"put_object:222","message":"Putting object to S3: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_67_chunk_67_65418423.parquet","timestamp":"2025-10-11 12:17:42,618-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
{"level":"INFO","location":"put_object:235","message":"Object put successfully: s3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_67_chunk_67_65418423.parquet","timestamp":"2025-10-11 12:17:42,984-0500","service":"service_undefined","name":"aje_libs.common.helpers.secrets_helper"}
2025-10-11 12:17:42 - core.orchestrator - WARNING - No se pudo obtener tama√±o de archivo {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_67_chunk_67_65418423.parquet', 'file_name': 'data_thread_0_67_chunk_67_65418423.parquet', 'file_size_bytes': 813347, 'file_size_mb': Decimal('0.776'), 'records_count': 50000, 'thread_id': '0_67', 'chunk_id': 67, 'partition_index': None, 'created_at': '2025-10-11T12:17:42.984604', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.17'), 'upload_duration_seconds': Decimal('0.367'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')}: 'dict' object has no attribute 'startswith'
2025-10-11 12:17:42 - core.orchestrator - INFO - üìÅ File created: {'file_path': 's3://sofia-dev-datalake-510543735161-us-east-1-raw-s3/apdayc/bigmagic/PEBDDATA/thpedi2f/year=2025/month=10/day=11/data_thread_0_67_chunk_67_65418423.parquet', 'file_name': 'data_thread_0_67_chunk_67_65418423.parquet', 'file_size_bytes': 813347, 'file_size_mb': Decimal('0.776'), 'records_count': 50000, 'thread_id': '0_67', 'chunk_id': 67, 'partition_index': None, 'created_at': '2025-10-11T12:17:42.984604', 'compression': 'snappy', 'format': 'parquet', 'extraction_duration_seconds': Decimal('1.17'), 'upload_duration_seconds': Decimal('0.367'), 'columns_count': 76, 'estimated_memory_mb': Decimal('28.992')} | Size: 0MB | Records: 50,000 | Columns: 76
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - Chunk #69: offset=3,400,000, size=50,000
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - SQL Query:
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - --------------------------------------------------------------------------------
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - üîç Query Attempt 1/3
2025-10-11 12:17:42 - extract.extractors.sql_server_extractor - INFO - Query preview: 
                SELECT rtrim(ltrim(t2.compania)) + '|' + rtrim(ltrim(t2.sucursal)) + '|' + rtrim(ltrim(t2.emisor)) + '|' + rtrim(ltrim(t2.docupedido)) + '|' + cast(cast(t2.nropedido as bigint) as varchar(20)) + '|' + cast(cast(t2.cliente as int) as varchar(20)) + '|' + cast(cast(t2.articulo as bigint) as varchar(20)) + '|' + rtrim(ltrim(t2.procpedido)) + '|' + cast(t2.idregla as varchar(20)) as id, dbo.func_cas_todatetime(t2.fecultimod,t2.horultimod) lastmodifydate,t2.compania compania,rtrim(ltrim(t2.sucursal)) sucursal,rtrim(ltrim(t2.emisor)) emisor,rtrim(ltrim(t2.docupedido)) docupedido,cast(cast(t2.nropedido as bigint) as varchar(20)) nropedido,cast(cast(t2.articulo as bigint) as varchar(20)) articulo,cast(cast(t2.cliente as int) as varchar(20)) cliente,t2.procpedido procpedido,t2.qcajpedid qcajpedid,t2.qbotpedid qbotpedid,t2.qbotadici qbotadici,t2.flgbolfac flgbolfac,t2.qcajasigp qcajasigp,t2.qbotasigp qbotasigp,t2.flgasignac flgasignac,cast(cast(t2.discendist as int) as varchar(20)) discendist,cast(cast(t2.zonadist as int) as varchar(20)) zonadist,cast(cast(t2.ruta as int) as varchar(20)) ruta,cast(cast(t2.modulo as int) as varchar(20)) modulo,t2.listprec listprec,t2.tdscto tdscto,t2.mondscto mondscto,t2.stspederr stspederr,t2.feccreacio feccreacio,t2.horcreacio horcreacio,t2.usuacreac usuacreac,t2.fecultimod fecultimod,t2.horultimod horultimod,t2.usuaulmod usuaulmod,t2.sercomvta sercomvta,t2.nropricovt nropricovt,t2.fordvisit fordvisit,t2.impprecaj impprecaj,t2.impcob impcob,t2.idregla idregla,rtrim(ltrim(t2.docucomalm)) docucomalm,t2.nrocomalm nrocomalm,t2.escala escala,t2.segmento segmento,t2.canal canal,t2.stspedido stspedido,case when t2.aprobacion = 0x46 then 'F' when t2.aprobacion = 0x54 then 'T' end aprobacion,t2.secdist secdist,t2.impvalv impvalv,t2.impbim1 impbim1,t2.prcim1 prcim1,t2.impim1 impim1,t2.impbim2 impbim2,t2.prcim2 prcim2,t2.impim2 impim2,t2.impbim3 impbim3,t2.prcim3 prcim3,t2.impim3 impim3,t2.impbim4 impbim4,t2.prcim4 prcim4,t2.impim4 impim4,t2.impbim5 impbim5,t2.prcim5 prcim5,t2.impim5 impim5,t2.impbim6 impbim6,t2.prcim6 prcim6,t2.impim6 impim6,t2.impbim7 impbim7,t2.prcim7 prcim7,t2.impim7 impim7,cast(null as varchar(4)) consignee,cast(null as varchar(4)) consigdir,cast(null as varchar(4)) flgsustapl,cast(null as varchar(4)) idestcom, '' idpedsforce,case when t2.aprobacion = 0x46 then '70' when t2.aprobacion = 0x54 then '84' end flgextrta,cast(null as varchar(4)) flgprepag,cast(null as varchar(4)) idpedecomm,t.fecpedido fecpedido FROM dbo.thpedi2f t2 inner join dbo.thpedi1f(nolock) t on t.compania = t2.compania and t.sucursal = t2.sucursal and t.emisor = t2.emisor and t.docupedido = t2.docupedido and t.nropedido = t2.nropedido WHERE t.fecpedido >= 7517 AND t.fecpedido < 739535 AND (t2.compania in (select compania from dbo.mcompa1f b where b.flgbi = 'a'))
                ORDER BY t.fecpedido
                OFFSET 3400000 ROWS FETCH NEXT 50000 ROWS ONLY
                
D:\WORKSPACE-GIT\VALORX\cdk-datalake-ingest-bigmagic\utils\extract_data_v2\extract\extractors\sql_server_extractor.py:163: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  df = pd.read_sql(query, self.connection)
